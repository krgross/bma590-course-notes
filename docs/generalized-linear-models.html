<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Generalized linear models | bookdown-demo</title>
  <meta name="description" content="" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Generalized linear models | bookdown-demo" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Generalized linear models | bookdown-demo" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="hierarchical-models.html"/>

<script src="libs/header-attrs-2.9/header-attrs.js"></script>
<script src="libs/jquery-3.5.1/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.10.0/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="maximum-likelihood-estimation.html"><a href="maximum-likelihood-estimation.html"><i class="fa fa-check"></i><b>1</b> Maximum likelihood estimation</a>
<ul>
<li class="chapter" data-level="1.1" data-path="maximum-likelihood-estimation.html"><a href="maximum-likelihood-estimation.html#a-very-simple-example-with-a-single-observation"><i class="fa fa-check"></i><b>1.1</b> A very simple example with a single observation</a></li>
<li class="chapter" data-level="1.2" data-path="maximum-likelihood-estimation.html"><a href="maximum-likelihood-estimation.html#horse-kick-data"><i class="fa fa-check"></i><b>1.2</b> Horse-kick data</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="maximum-likelihood-estimation.html"><a href="maximum-likelihood-estimation.html#calculate-and-plot-the-log-likelihood-function"><i class="fa fa-check"></i><b>1.2.1</b> Calculate and plot the log-likelihood function</a></li>
<li class="chapter" data-level="1.2.2" data-path="maximum-likelihood-estimation.html"><a href="maximum-likelihood-estimation.html#find-the-mle-numerically-using-optimize"><i class="fa fa-check"></i><b>1.2.2</b> Find the MLE numerically using ‘optimize’</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="maximum-likelihood-estimation.html"><a href="maximum-likelihood-estimation.html#myxomatosis-data"><i class="fa fa-check"></i><b>1.3</b> Myxomatosis data</a></li>
<li class="chapter" data-level="1.4" data-path="maximum-likelihood-estimation.html"><a href="maximum-likelihood-estimation.html#tadpole-data"><i class="fa fa-check"></i><b>1.4</b> Tadpole data</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html"><i class="fa fa-check"></i><b>2</b> Beyond the MLE: Confidence regions and hypothesis tests using the likelihood function</a>
<ul>
<li class="chapter" data-level="2.1" data-path="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#confidence-intervals-for-single-parameters"><i class="fa fa-check"></i><b>2.1</b> Confidence intervals for single parameters</a></li>
<li class="chapter" data-level="2.2" data-path="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#two-param-mle"><i class="fa fa-check"></i><b>2.2</b> Confidence regions, profile likelihoods, and associated univariate intervals</a></li>
<li class="chapter" data-level="2.3" data-path="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#locally-quadratic-approximations-to-confidence-intervals-and-regions"><i class="fa fa-check"></i><b>2.3</b> Locally quadratic approximations to confidence intervals and regions</a></li>
<li class="chapter" data-level="2.4" data-path="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#comparing-models-likelihood-ratio-test-and-aic"><i class="fa fa-check"></i><b>2.4</b> Comparing models: Likelihood ratio test and AIC</a></li>
<li class="chapter" data-level="2.5" data-path="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#transformable-constraints"><i class="fa fa-check"></i><b>2.5</b> Transformable constraints</a></li>
<li class="chapter" data-level="2.6" data-path="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#the-negative-binomial-distriution-revisited"><i class="fa fa-check"></i><b>2.6</b> The negative binomial distriution, revisited</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="bayesian-computation.html"><a href="bayesian-computation.html"><i class="fa fa-check"></i><b>3</b> Bayesian computation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="bayesian-computation.html"><a href="bayesian-computation.html#computations-with-conjugate-priors"><i class="fa fa-check"></i><b>3.1</b> Computations with conjugate priors</a></li>
<li class="chapter" data-level="3.2" data-path="bayesian-computation.html"><a href="bayesian-computation.html#jags-in-r"><i class="fa fa-check"></i><b>3.2</b> JAGS in R</a></li>
<li class="chapter" data-level="3.3" data-path="bayesian-computation.html"><a href="bayesian-computation.html#rstanarm"><i class="fa fa-check"></i><b>3.3</b> rstanarm</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="smooth-regression.html"><a href="smooth-regression.html"><i class="fa fa-check"></i><b>4</b> Smooth regression</a>
<ul>
<li class="chapter" data-level="4.1" data-path="smooth-regression.html"><a href="smooth-regression.html#loess-smoothers"><i class="fa fa-check"></i><b>4.1</b> Loess smoothers</a></li>
<li class="chapter" data-level="4.2" data-path="smooth-regression.html"><a href="smooth-regression.html#splines"><i class="fa fa-check"></i><b>4.2</b> Splines</a></li>
<li class="chapter" data-level="4.3" data-path="smooth-regression.html"><a href="smooth-regression.html#generalized-additive-models-gams"><i class="fa fa-check"></i><b>4.3</b> Generalized additive models (GAMs)</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="generalized-least-squares.html"><a href="generalized-least-squares.html"><i class="fa fa-check"></i><b>5</b> Generalized Least Squares</a>
<ul>
<li class="chapter" data-level="5.1" data-path="generalized-least-squares.html"><a href="generalized-least-squares.html#heterogeneous-variance"><i class="fa fa-check"></i><b>5.1</b> Heterogeneous variance</a></li>
<li class="chapter" data-level="5.2" data-path="generalized-least-squares.html"><a href="generalized-least-squares.html#temporal-serial-correlation"><i class="fa fa-check"></i><b>5.2</b> Temporal (serial) correlation</a></li>
<li class="chapter" data-level="5.3" data-path="generalized-least-squares.html"><a href="generalized-least-squares.html#spatial-data"><i class="fa fa-check"></i><b>5.3</b> Spatial data</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="hierarchical-models.html"><a href="hierarchical-models.html"><i class="fa fa-check"></i><b>6</b> Hierarchical Models</a>
<ul>
<li class="chapter" data-level="6.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#one-factor-layout-dyestuff-data"><i class="fa fa-check"></i><b>6.1</b> One-factor layout: Dyestuff data</a></li>
<li class="chapter" data-level="6.2" data-path="hierarchical-models.html"><a href="hierarchical-models.html#bayesian-analysis"><i class="fa fa-check"></i><b>6.2</b> Bayesian analysis</a></li>
<li class="chapter" data-level="6.3" data-path="hierarchical-models.html"><a href="hierarchical-models.html#negative-within-group-correlations"><i class="fa fa-check"></i><b>6.3</b> Negative within-group correlations</a></li>
<li class="chapter" data-level="6.4" data-path="hierarchical-models.html"><a href="hierarchical-models.html#random-coefficient-models-rikz-data"><i class="fa fa-check"></i><b>6.4</b> Random coefficient models: RIKZ data</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#analysis-without-beach-level-covariate"><i class="fa fa-check"></i><b>6.4.1</b> Analysis without beach-level covariate</a></li>
<li class="chapter" data-level="6.4.2" data-path="hierarchical-models.html"><a href="hierarchical-models.html#adding-a-beach-level-covariate"><i class="fa fa-check"></i><b>6.4.2</b> Adding a beach-level covariate</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="hierarchical-models.html"><a href="hierarchical-models.html#nested-and-crossed-random-effects"><i class="fa fa-check"></i><b>6.5</b> Nested and crossed random effects</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#nested-random-effects"><i class="fa fa-check"></i><b>6.5.1</b> Nested random effects</a></li>
<li class="chapter" data-level="6.5.2" data-path="hierarchical-models.html"><a href="hierarchical-models.html#crossed-random-effects"><i class="fa fa-check"></i><b>6.5.2</b> Crossed random effects</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html"><i class="fa fa-check"></i><b>7</b> Generalized linear models</a>
<ul>
<li class="chapter" data-level="7.1" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#poisson-regression"><i class="fa fa-check"></i><b>7.1</b> Poisson regression</a></li>
<li class="chapter" data-level="7.2" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#bayesian-interlude"><i class="fa fa-check"></i><b>7.2</b> Bayesian interlude</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#rstanarm-1"><i class="fa fa-check"></i><b>7.2.1</b> rstanarm</a></li>
<li class="chapter" data-level="7.2.2" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#posterior-predictive-checks"><i class="fa fa-check"></i><b>7.2.2</b> Posterior predictive checks</a></li>
<li class="chapter" data-level="7.2.3" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#jags"><i class="fa fa-check"></i><b>7.2.3</b> JAGS</a></li>
<li class="chapter" data-level="7.2.4" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#observation-level-random-effects"><i class="fa fa-check"></i><b>7.2.4</b> Observation-level random effects</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#binary-responses"><i class="fa fa-check"></i><b>7.3</b> Binary responses</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#individual-binary-responses-tb-in-boar"><i class="fa fa-check"></i><b>7.3.1</b> Individual binary responses: TB in boar</a></li>
<li class="chapter" data-level="7.3.2" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#grouped-binary-data-industrial-melanism"><i class="fa fa-check"></i><b>7.3.2</b> Grouped binary data: Industrial melanism</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="generalized-linear-models" class="section level1" number="7">
<h1><span class="header-section-number">Chapter 7</span> Generalized linear models</h1>
<p>Generalized linear modes allow us to extend the machinery of the “general linear model” (regression and ANOVA) to data sets in which the response variable may have a non-Gaussian distribution. Generalized linear models do not encompass all possible distributions for the response variable. Instead, the distribution of the response variable must belong to a group of distributions known as the “exponential family”. (Note that there is also such a thing as an exponential distribution. The exponential distribution is one of the distributions in the exponential family, but it is not the only one.) The exponential family of distributions includes many of the distributions that we encounter in practical data analysis, including Poisson, negative binomial, binomial, gamma, and beta distributions. The Gaussian distribution is included in the exponential family as well. One notable distribution that is not part of the exponential family is the <span class="math inline">\(t\)</span>-distribution. Distributions in the exponential family all give rise to likelihoods that share the same general form, and thus can be handled with a unified fitting scheme.</p>
<p>In practice, logistic regression (with binomial responses) and Poisson regression are far and away the two most common forms of generalized linear models that one encounters.</p>
<div id="poisson-regression" class="section level2" number="7.1">
<h2><span class="header-section-number">7.1</span> Poisson regression</h2>
<p>We will begin with an example of Poisson regression. These data are originally from Poole, Anim. Behav. 37 (1989):842-49, and were analyzed in the second edition of Ramsey &amp; Schafer’s <em>Statistical Sleuth</em>. They describe an observational study of 41 male elephants over 8 years at Amboseli National Park in Kenya. Each record in this data set gives the age of a male elephant at the beginning of a study and the number of successful matings for the elephant over the study’s duration. The number of matings is a count variable. Our goal is to characterize how the number of matings is related to the elephant’s age. We’ll start by fitting a model with the canonical log link.</p>
<div class="sourceCode" id="cb544"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb544-1"><a href="generalized-linear-models.html#cb544-1" aria-hidden="true" tabindex="-1"></a>elephant <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;data/elephant.txt&quot;</span>, <span class="at">head =</span> T)</span>
<span id="cb544-2"><a href="generalized-linear-models.html#cb544-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(elephant)</span></code></pre></div>
<pre><code>##   age matings
## 1  27       0
## 2  28       1
## 3  28       1
## 4  28       1
## 5  28       3
## 6  29       0</code></pre>
<div class="sourceCode" id="cb546"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb546-1"><a href="generalized-linear-models.html#cb546-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(elephant, <span class="fu">plot</span>(matings <span class="sc">~</span> age))</span></code></pre></div>
<p><img src="07-GeneralizedLinearModels_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<div class="sourceCode" id="cb547"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb547-1"><a href="generalized-linear-models.html#cb547-1" aria-hidden="true" tabindex="-1"></a>fm1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(matings <span class="sc">~</span> age, </span>
<span id="cb547-2"><a href="generalized-linear-models.html#cb547-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">&quot;log&quot;</span>), </span>
<span id="cb547-3"><a href="generalized-linear-models.html#cb547-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">data   =</span> elephant)  <span class="co"># log link is the default</span></span>
<span id="cb547-4"><a href="generalized-linear-models.html#cb547-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb547-5"><a href="generalized-linear-models.html#cb547-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fm1)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = matings ~ age, family = poisson(link = &quot;log&quot;), 
##     data = elephant)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -2.80798  -0.86137  -0.08629   0.60087   2.17777  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -1.58201    0.54462  -2.905  0.00368 ** 
## age          0.06869    0.01375   4.997 5.81e-07 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 75.372  on 40  degrees of freedom
## Residual deviance: 51.012  on 39  degrees of freedom
## AIC: 156.46
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<p>Thus the so-called pseudo-<span class="math inline">\(R^2\)</span> for the model with the log link is
<span class="math display">\[
\mathrm{pseudo}-R^2 = 1 - \frac{51.012}{75.372} = 32.3\%
\]</span>
We can visualize the fit by plotting a best-fitting line with a 95% confidence interval. Because the scale parameter is not estimated here, we will use a critical value from a standard normal distribution. Later, when we estimate the scale parameter based on data, we will use a critical value from a <span class="math inline">\(t\)</span>-distribution instead.</p>
<div class="sourceCode" id="cb549"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb549-1"><a href="generalized-linear-models.html#cb549-1" aria-hidden="true" tabindex="-1"></a>new.data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">age =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(elephant<span class="sc">$</span>age),</span>
<span id="cb549-2"><a href="generalized-linear-models.html#cb549-2" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">to   =</span> <span class="fu">max</span>(elephant<span class="sc">$</span>age),</span>
<span id="cb549-3"><a href="generalized-linear-models.html#cb549-3" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">length =</span> <span class="dv">100</span>))</span>
<span id="cb549-4"><a href="generalized-linear-models.html#cb549-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb549-5"><a href="generalized-linear-models.html#cb549-5" aria-hidden="true" tabindex="-1"></a>predict.fm1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(fm1, <span class="at">newdata =</span> new.data, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>, <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb549-6"><a href="generalized-linear-models.html#cb549-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb549-7"><a href="generalized-linear-models.html#cb549-7" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(elephant, <span class="fu">plot</span>(matings <span class="sc">~</span> age))</span>
<span id="cb549-8"><a href="generalized-linear-models.html#cb549-8" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> new.data<span class="sc">$</span>age, <span class="at">y =</span> predict.fm1<span class="sc">$</span>fit, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb549-9"><a href="generalized-linear-models.html#cb549-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb549-10"><a href="generalized-linear-models.html#cb549-10" aria-hidden="true" tabindex="-1"></a><span class="co"># add lines for standard errors</span></span>
<span id="cb549-11"><a href="generalized-linear-models.html#cb549-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb549-12"><a href="generalized-linear-models.html#cb549-12" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x   =</span> new.data<span class="sc">$</span>age, </span>
<span id="cb549-13"><a href="generalized-linear-models.html#cb549-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">y   =</span> predict.fm1<span class="sc">$</span>fit <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> predict.fm1<span class="sc">$</span>se.fit, </span>
<span id="cb549-14"><a href="generalized-linear-models.html#cb549-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb549-15"><a href="generalized-linear-models.html#cb549-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">lty =</span> <span class="st">&quot;dashed&quot;</span>)</span>
<span id="cb549-16"><a href="generalized-linear-models.html#cb549-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb549-17"><a href="generalized-linear-models.html#cb549-17" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x   =</span> new.data<span class="sc">$</span>age, </span>
<span id="cb549-18"><a href="generalized-linear-models.html#cb549-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">y   =</span> predict.fm1<span class="sc">$</span>fit <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> predict.fm1<span class="sc">$</span>se.fit, </span>
<span id="cb549-19"><a href="generalized-linear-models.html#cb549-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb549-20"><a href="generalized-linear-models.html#cb549-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">lty =</span> <span class="st">&quot;dashed&quot;</span>)</span></code></pre></div>
<p><img src="07-GeneralizedLinearModels_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>While the canonical link is a natural starting point, we are free to try other link functions as well. Below, we try the identity link and plot the fit.</p>
<div class="sourceCode" id="cb550"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb550-1"><a href="generalized-linear-models.html#cb550-1" aria-hidden="true" tabindex="-1"></a>fm2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(matings <span class="sc">~</span> age, <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">&quot;identity&quot;</span>), <span class="at">data =</span> elephant)  </span>
<span id="cb550-2"><a href="generalized-linear-models.html#cb550-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb550-3"><a href="generalized-linear-models.html#cb550-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fm2)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = matings ~ age, family = poisson(link = &quot;identity&quot;), 
##     data = elephant)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -2.87228  -0.97171  -0.09509   0.57794   2.07192  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -4.55205    1.33916  -3.399 0.000676 ***
## age          0.20179    0.04023   5.016 5.29e-07 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 75.372  on 40  degrees of freedom
## Residual deviance: 50.058  on 39  degrees of freedom
## AIC: 155.5
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<div class="sourceCode" id="cb552"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb552-1"><a href="generalized-linear-models.html#cb552-1" aria-hidden="true" tabindex="-1"></a>predict.fm2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(fm2, <span class="at">newdata =</span> new.data, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>, <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb552-2"><a href="generalized-linear-models.html#cb552-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb552-3"><a href="generalized-linear-models.html#cb552-3" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(elephant, <span class="fu">plot</span>(matings <span class="sc">~</span> age))</span>
<span id="cb552-4"><a href="generalized-linear-models.html#cb552-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> new.data<span class="sc">$</span>age, <span class="at">y =</span> predict.fm2<span class="sc">$</span>fit, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb552-5"><a href="generalized-linear-models.html#cb552-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb552-6"><a href="generalized-linear-models.html#cb552-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x   =</span> new.data<span class="sc">$</span>age, </span>
<span id="cb552-7"><a href="generalized-linear-models.html#cb552-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">y   =</span> predict.fm2<span class="sc">$</span>fit <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> predict.fm2<span class="sc">$</span>se.fit, </span>
<span id="cb552-8"><a href="generalized-linear-models.html#cb552-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="cb552-9"><a href="generalized-linear-models.html#cb552-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">lty =</span> <span class="st">&quot;dashed&quot;</span>)</span>
<span id="cb552-10"><a href="generalized-linear-models.html#cb552-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb552-11"><a href="generalized-linear-models.html#cb552-11" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x   =</span> new.data<span class="sc">$</span>age, </span>
<span id="cb552-12"><a href="generalized-linear-models.html#cb552-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">y   =</span> predict.fm2<span class="sc">$</span>fit <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> predict.fm2<span class="sc">$</span>se.fit, </span>
<span id="cb552-13"><a href="generalized-linear-models.html#cb552-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="cb552-14"><a href="generalized-linear-models.html#cb552-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">lty =</span> <span class="st">&quot;dashed&quot;</span>)</span></code></pre></div>
<p><img src="07-GeneralizedLinearModels_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>Note that the choice of the link function has a substantial impact on the shape of the fit. The canonical (log) link suggests that the average number of matings increases with age at an accelerating rate, while the identity link suggests that the average number of matings increases steadily with age. The AIC favors the identity link here.</p>
<p>We can also have a look at the residuals to see if they suggest any model deficiencies. In general, we prefer the deviance residuals, so we will look at them.</p>
<div class="sourceCode" id="cb553"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb553-1"><a href="generalized-linear-models.html#cb553-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> elephant<span class="sc">$</span>age, </span>
<span id="cb553-2"><a href="generalized-linear-models.html#cb553-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">y =</span> <span class="fu">residuals</span>(fm2, <span class="at">type =</span> <span class="st">&quot;deviance&quot;</span>),</span>
<span id="cb553-3"><a href="generalized-linear-models.html#cb553-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;age&quot;</span>,</span>
<span id="cb553-4"><a href="generalized-linear-models.html#cb553-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Deviance residuals&quot;</span>)</span>
<span id="cb553-5"><a href="generalized-linear-models.html#cb553-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb553-6"><a href="generalized-linear-models.html#cb553-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="st">&quot;dashed&quot;</span>)</span></code></pre></div>
<p><img src="07-GeneralizedLinearModels_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>The residuals do not suggest any deficiency in the fit.</p>
<p>For this fit, the residual deviance suggests a small amount of overdispersion. To be on the safe side, we can fit a quasi-Poisson model in which the scale (overdispersion) parameter is estimated from the data. Note that when we estimate the overdispersion parameter, the estimates of the model parameters do not change, but their standard errors increase. Consequently, the uncertainty in the fit increases as well. In this case, however, the increase is so slight that it is barely noticeable.</p>
<div class="sourceCode" id="cb554"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb554-1"><a href="generalized-linear-models.html#cb554-1" aria-hidden="true" tabindex="-1"></a>fm3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(matings <span class="sc">~</span> age, <span class="at">family =</span> <span class="fu">quasipoisson</span>(<span class="at">link =</span> <span class="st">&quot;identity&quot;</span>), <span class="at">data =</span> elephant)  </span>
<span id="cb554-2"><a href="generalized-linear-models.html#cb554-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb554-3"><a href="generalized-linear-models.html#cb554-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fm3)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = matings ~ age, family = quasipoisson(link = &quot;identity&quot;), 
##     data = elephant)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -2.87228  -0.97171  -0.09509   0.57794   2.07192  
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -4.55205    1.42164  -3.202  0.00272 ** 
## age          0.20179    0.04271   4.725 2.97e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for quasipoisson family taken to be 1.126975)
## 
##     Null deviance: 75.372  on 40  degrees of freedom
## Residual deviance: 50.058  on 39  degrees of freedom
## AIC: NA
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<div class="sourceCode" id="cb556"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb556-1"><a href="generalized-linear-models.html#cb556-1" aria-hidden="true" tabindex="-1"></a>predict.fm3 <span class="ot">&lt;-</span> <span class="fu">predict</span>(fm3, <span class="at">newdata =</span> new.data, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>, <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb556-2"><a href="generalized-linear-models.html#cb556-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb556-3"><a href="generalized-linear-models.html#cb556-3" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(elephant, <span class="fu">plot</span>(matings <span class="sc">~</span> age))</span>
<span id="cb556-4"><a href="generalized-linear-models.html#cb556-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> new.data<span class="sc">$</span>age, <span class="at">y =</span> predict.fm3<span class="sc">$</span>fit, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb556-5"><a href="generalized-linear-models.html#cb556-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb556-6"><a href="generalized-linear-models.html#cb556-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x   =</span> new.data<span class="sc">$</span>age, </span>
<span id="cb556-7"><a href="generalized-linear-models.html#cb556-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">y   =</span> predict.fm3<span class="sc">$</span>fit <span class="sc">+</span> <span class="fu">qt</span>(<span class="fl">0.025</span>, <span class="at">df =</span> <span class="dv">39</span>) <span class="sc">*</span> predict.fm3<span class="sc">$</span>se.fit, </span>
<span id="cb556-8"><a href="generalized-linear-models.html#cb556-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="cb556-9"><a href="generalized-linear-models.html#cb556-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">lty =</span> <span class="st">&quot;dashed&quot;</span>)</span>
<span id="cb556-10"><a href="generalized-linear-models.html#cb556-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb556-11"><a href="generalized-linear-models.html#cb556-11" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x   =</span> new.data<span class="sc">$</span>age, </span>
<span id="cb556-12"><a href="generalized-linear-models.html#cb556-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">y   =</span> predict.fm3<span class="sc">$</span>fit <span class="sc">+</span> <span class="fu">qt</span>(<span class="fl">0.975</span>, <span class="at">df =</span> <span class="dv">39</span>) <span class="sc">*</span> predict.fm3<span class="sc">$</span>se.fit, </span>
<span id="cb556-13"><a href="generalized-linear-models.html#cb556-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="cb556-14"><a href="generalized-linear-models.html#cb556-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">lty =</span> <span class="st">&quot;dashed&quot;</span>)</span></code></pre></div>
<p><img src="07-GeneralizedLinearModels_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>As an alternative, we could fit a model that uses a negative binomial distribution for the response. Negative binomial distributions belong to the exponential family, so we can fit them using the GLM framework. However, the authors of <code>glm</code> did not include a negative binomial family in their initial code. Venables &amp; Ripley’s <code>MASS</code> package includes a program called <code>glm.nb</code> which is specifically designed for negative binomial responses. <code>MASS::glm.nb</code> uses the parameterization familiar to ecologists, although they use the parameter <span class="math inline">\(\theta\)</span> instead of <span class="math inline">\(k\)</span>. So, in their notation, if <span class="math inline">\(y \sim \mathrm{NB}(\mu, \theta)\)</span>, then <span class="math inline">\(\mathrm{Var}(y) = \mu + \mu^2/\theta\)</span>.</p>
<div class="sourceCode" id="cb557"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb557-1"><a href="generalized-linear-models.html#cb557-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(MASS)</span></code></pre></div>
<pre><code>## Loading required package: MASS</code></pre>
<div class="sourceCode" id="cb559"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb559-1"><a href="generalized-linear-models.html#cb559-1" aria-hidden="true" tabindex="-1"></a>fm4 <span class="ot">&lt;-</span> <span class="fu">glm.nb</span>(matings <span class="sc">~</span> age, <span class="at">link =</span> identity, <span class="at">data =</span> elephant)  </span>
<span id="cb559-2"><a href="generalized-linear-models.html#cb559-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb559-3"><a href="generalized-linear-models.html#cb559-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fm4)</span></code></pre></div>
<pre><code>## 
## Call:
## glm.nb(formula = matings ~ age, data = elephant, link = identity, 
##     init.theta = 15.80269167)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -2.70899  -0.92077  -0.08966   0.54500   1.78248  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -4.56939    1.45770  -3.135  0.00172 ** 
## age          0.20232    0.04428   4.569  4.9e-06 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for Negative Binomial(15.8027) family taken to be 1)
## 
##     Null deviance: 64.836  on 40  degrees of freedom
## Residual deviance: 43.214  on 39  degrees of freedom
## AIC: 156.87
## 
## Number of Fisher Scoring iterations: 1
## 
## 
##               Theta:  15.8 
##           Std. Err.:  23.0 
## 
##  2 x log-likelihood:  -150.872</code></pre>
<div class="sourceCode" id="cb561"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb561-1"><a href="generalized-linear-models.html#cb561-1" aria-hidden="true" tabindex="-1"></a>predict.fm4 <span class="ot">&lt;-</span> <span class="fu">predict</span>(fm4, <span class="at">newdata =</span> new.data, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>, <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb561-2"><a href="generalized-linear-models.html#cb561-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb561-3"><a href="generalized-linear-models.html#cb561-3" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(elephant, <span class="fu">plot</span>(matings <span class="sc">~</span> age))</span>
<span id="cb561-4"><a href="generalized-linear-models.html#cb561-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> new.data<span class="sc">$</span>age, <span class="at">y =</span> predict.fm4<span class="sc">$</span>fit, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb561-5"><a href="generalized-linear-models.html#cb561-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb561-6"><a href="generalized-linear-models.html#cb561-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x   =</span> new.data<span class="sc">$</span>age, </span>
<span id="cb561-7"><a href="generalized-linear-models.html#cb561-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">y   =</span> predict.fm4<span class="sc">$</span>fit <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> predict.fm4<span class="sc">$</span>se.fit, </span>
<span id="cb561-8"><a href="generalized-linear-models.html#cb561-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="cb561-9"><a href="generalized-linear-models.html#cb561-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">lty =</span> <span class="st">&quot;dashed&quot;</span>)</span>
<span id="cb561-10"><a href="generalized-linear-models.html#cb561-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb561-11"><a href="generalized-linear-models.html#cb561-11" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x   =</span> new.data<span class="sc">$</span>age, </span>
<span id="cb561-12"><a href="generalized-linear-models.html#cb561-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">y   =</span> predict.fm4<span class="sc">$</span>fit <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> predict.fm4<span class="sc">$</span>se.fit, </span>
<span id="cb561-13"><a href="generalized-linear-models.html#cb561-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="cb561-14"><a href="generalized-linear-models.html#cb561-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">lty =</span> <span class="st">&quot;dashed&quot;</span>)</span></code></pre></div>
<p><img src="07-GeneralizedLinearModels_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>Notice that <span class="math inline">\(\hat{\theta} = 15.8\)</span>, again indicating that the extra-Poisson variation is mild. Notice also that the error bounds on the fitted curve are ever so slightly larger than the error bounds from the Poisson fit, and nearly identical to the error bounds from the quasi-Poisson fit.</p>
</div>
<div id="bayesian-interlude" class="section level2" number="7.2">
<h2><span class="header-section-number">7.2</span> Bayesian interlude</h2>
<div id="rstanarm-1" class="section level3" number="7.2.1">
<h3><span class="header-section-number">7.2.1</span> rstanarm</h3>
<p>We will take a look at how Poisson regression can be handled from a Bayesian perspective. This interlude will also allow us to introduce a few more Bayesian concepts.</p>
<p>We’ll first fit the Poisson regression with identity link using <code>rstanarm::stan_glm</code>.</p>
<div class="sourceCode" id="cb562"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb562-1"><a href="generalized-linear-models.html#cb562-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(rstanarm)</span></code></pre></div>
<pre><code>## Loading required package: rstanarm</code></pre>
<pre><code>## Loading required package: Rcpp</code></pre>
<pre><code>## This is rstanarm version 2.21.1</code></pre>
<pre><code>## - See https://mc-stan.org/rstanarm/articles/priors for changes to default priors!</code></pre>
<pre><code>## - Default priors may change, so it&#39;s safest to specify priors, even if equivalent to the defaults.</code></pre>
<pre><code>## - For execution on a local, multicore CPU with excess RAM we recommend calling</code></pre>
<pre><code>##   options(mc.cores = parallel::detectCores())</code></pre>
<div class="sourceCode" id="cb570"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb570-1"><a href="generalized-linear-models.html#cb570-1" aria-hidden="true" tabindex="-1"></a>fm5 <span class="ot">&lt;-</span> <span class="fu">stan_glm</span>(matings <span class="sc">~</span> age, </span>
<span id="cb570-2"><a href="generalized-linear-models.html#cb570-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">&quot;identity&quot;</span>), </span>
<span id="cb570-3"><a href="generalized-linear-models.html#cb570-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">data   =</span> elephant,</span>
<span id="cb570-4"><a href="generalized-linear-models.html#cb570-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">seed   =</span> <span class="dv">1</span>)  </span></code></pre></div>
<div class="sourceCode" id="cb571"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb571-1"><a href="generalized-linear-models.html#cb571-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fm5, <span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## stan_glm
##  family:       poisson [identity]
##  formula:      matings ~ age
##  observations: 41
##  predictors:   2
## ------
##             Median MAD_SD
## (Intercept) -4.420  1.358
## age          0.198  0.041
## 
## ------
## * For help interpreting the printed output see ?print.stanreg
## * For info on the priors used see ?prior_summary.stanreg</code></pre>
<p>We can visualize the marginal posterior of the slope using <code>bayesplot::mcmc_areas</code>:</p>
<div class="sourceCode" id="cb573"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb573-1"><a href="generalized-linear-models.html#cb573-1" aria-hidden="true" tabindex="-1"></a>posterior.fm5 <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(fm5)</span>
<span id="cb573-2"><a href="generalized-linear-models.html#cb573-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb573-3"><a href="generalized-linear-models.html#cb573-3" aria-hidden="true" tabindex="-1"></a>bayesplot<span class="sc">::</span><span class="fu">mcmc_areas</span>(posterior.fm5,</span>
<span id="cb573-4"><a href="generalized-linear-models.html#cb573-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">&quot;age&quot;</span>),</span>
<span id="cb573-5"><a href="generalized-linear-models.html#cb573-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">prob =</span> <span class="fl">0.95</span>) </span></code></pre></div>
<p><img src="07-GeneralizedLinearModels_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>Notice that the slope of the fitted regression line is slightly attenuated relative to the ML fit from the frequentist analysis. The reason is that the default priors selected by <code>rstanarm</code> are actually reasonably strong:</p>
<div class="sourceCode" id="cb574"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb574-1"><a href="generalized-linear-models.html#cb574-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prior_summary</span>(fm5)</span></code></pre></div>
<pre><code>## Priors for model &#39;fm5&#39; 
## ------
## Intercept (after predictors centered)
##  ~ normal(location = 0, scale = 2.5)
## 
## Coefficients
##   Specified prior:
##     ~ normal(location = 0, scale = 2.5)
##   Adjusted prior:
##     ~ normal(location = 0, scale = 0.38)
## ------
## See help(&#39;prior_summary.stanreg&#39;) for more details</code></pre>
<p><code>rstanarm</code> parameterizes the normal distribution by its mean and standard deviation. Thus, the prior for the slope has a mean of 0 and standard deviation of 2.5. (I think: I don’t yet understand the difference between the ‘specified prior’ and the ‘adjusted prior’.) This relatively strong prior reflects the views of the developers of <code>rstanarm</code>, who think there is benefit to shrinking most estimated effects slightly towards 0. If we want to override this default and use weaker priors, we can do so as follows.</p>
<div class="sourceCode" id="cb576"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb576-1"><a href="generalized-linear-models.html#cb576-1" aria-hidden="true" tabindex="-1"></a>fm5 <span class="ot">&lt;-</span> <span class="fu">stan_glm</span>(matings <span class="sc">~</span> age, </span>
<span id="cb576-2"><a href="generalized-linear-models.html#cb576-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">&quot;identity&quot;</span>), </span>
<span id="cb576-3"><a href="generalized-linear-models.html#cb576-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">data   =</span> elephant,</span>
<span id="cb576-4"><a href="generalized-linear-models.html#cb576-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">prior  =</span> <span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">100</span>), </span>
<span id="cb576-5"><a href="generalized-linear-models.html#cb576-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">prior_intercept =</span> <span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">100</span>),</span>
<span id="cb576-6"><a href="generalized-linear-models.html#cb576-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">seed   =</span> <span class="dv">1</span>)  </span></code></pre></div>
<div class="sourceCode" id="cb577"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb577-1"><a href="generalized-linear-models.html#cb577-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fm5, <span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## stan_glm
##  family:       poisson [identity]
##  formula:      matings ~ age
##  observations: 41
##  predictors:   2
## ------
##             Median MAD_SD
## (Intercept) -4.588  1.390
## age          0.204  0.042
## 
## ------
## * For help interpreting the printed output see ?print.stanreg
## * For info on the priors used see ?prior_summary.stanreg</code></pre>
<p>Weakening the prior results in a posterior mean for the slope that is closer to the MLE from the frequentist analysis.</p>
<p>We can visualize the fit in the usual way, by plotting sample draws from the MCMC sampler.</p>
<div class="sourceCode" id="cb579"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb579-1"><a href="generalized-linear-models.html#cb579-1" aria-hidden="true" tabindex="-1"></a>mcmc.sims <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(fm5)</span>
<span id="cb579-2"><a href="generalized-linear-models.html#cb579-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb579-3"><a href="generalized-linear-models.html#cb579-3" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(elephant, <span class="fu">plot</span>(matings <span class="sc">~</span> age, <span class="at">type =</span> <span class="st">&quot;n&quot;</span>))</span>
<span id="cb579-4"><a href="generalized-linear-models.html#cb579-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb579-5"><a href="generalized-linear-models.html#cb579-5" aria-hidden="true" tabindex="-1"></a>sample.sims <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(mcmc.sims), <span class="at">size =</span> <span class="dv">100</span>)</span>
<span id="cb579-6"><a href="generalized-linear-models.html#cb579-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> sample.sims) {</span>
<span id="cb579-7"><a href="generalized-linear-models.html#cb579-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">abline</span>(<span class="at">a =</span> mcmc.sims[i, <span class="dv">1</span>], <span class="at">b =</span> mcmc.sims[i, <span class="dv">2</span>], <span class="at">col =</span> <span class="st">&quot;skyblue&quot;</span>)</span>
<span id="cb579-8"><a href="generalized-linear-models.html#cb579-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb579-9"><a href="generalized-linear-models.html#cb579-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb579-10"><a href="generalized-linear-models.html#cb579-10" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a =</span> <span class="fu">coef</span>(fm5)[<span class="st">&#39;(Intercept)&#39;</span>], <span class="at">b =</span> <span class="fu">coef</span>(fm5)[<span class="st">&#39;age&#39;</span>], <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb579-11"><a href="generalized-linear-models.html#cb579-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb579-12"><a href="generalized-linear-models.html#cb579-12" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(elephant, <span class="fu">points</span>(matings <span class="sc">~</span> age, <span class="at">pch =</span> <span class="dv">16</span>))</span></code></pre></div>
<p><img src="07-GeneralizedLinearModels_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
</div>
<div id="posterior-predictive-checks" class="section level3" number="7.2.2">
<h3><span class="header-section-number">7.2.2</span> Posterior predictive checks</h3>
<p>How might we assess the quality of this fit? A Bayesian approach to assessing the quality of fit is to generate posterior predictive distributions. A “posterior predictive” data set is a new data set of hypothetical observations simulated using the parameter values from one of the samples of the MCMC sampler. By creating many such data sets, we can build up a distribution of data sets predicted by the posterior distribution of the model parameters. By comparing the actual observed data to this distribution, we can gain a sense of whether our data are consistent with the posterior fit.</p>
<p>The authors of <code>rstanarm</code> advocate using posterior predictive checks extensively to assess model adequacy. For that reason, they have included a number of tools that make posterior predictive checking simple. For example, the command <code>rstanarm::posterior_predict</code> generates a collection of hypothetical data sets by randomly sampling from the posterior distribution of the parameters. The default behavior is to generate a collection of 1000 such data sets.</p>
<div class="sourceCode" id="cb580"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb580-1"><a href="generalized-linear-models.html#cb580-1" aria-hidden="true" tabindex="-1"></a>post.predict <span class="ot">&lt;-</span> <span class="fu">posterior_predict</span>(fm5)</span></code></pre></div>
<p>For example, we can have a look at a few of these hypothetical data sets.</p>
<div class="sourceCode" id="cb581"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb581-1"><a href="generalized-linear-models.html#cb581-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb581-2"><a href="generalized-linear-models.html#cb581-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb581-3"><a href="generalized-linear-models.html#cb581-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) {</span>
<span id="cb581-4"><a href="generalized-linear-models.html#cb581-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb581-5"><a href="generalized-linear-models.html#cb581-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(elephant, <span class="fu">plot</span>(matings <span class="sc">~</span> age, <span class="at">type =</span> <span class="st">&quot;n&quot;</span>))</span>
<span id="cb581-6"><a href="generalized-linear-models.html#cb581-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(elephant<span class="sc">$</span>age, post.predict[i, ], <span class="at">pch =</span> <span class="dv">1</span>)</span>
<span id="cb581-7"><a href="generalized-linear-models.html#cb581-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="07-GeneralizedLinearModels_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>Our task is to determine if the real data set that we actually observed is consistent with this collection of hypothetical data sets. To do so, we can calculate a summary statistic that captures an interesting feature of each data set, and compare the value of that summary statistic for the real data set to the distribution of values across the simulated data sets.</p>
<p>What summary statistic would you use to compare the real elephant data set to these simulated ones? We’ll use the marginal standard deviation of the number of matings below, but there might be other or better examples that you could think of. Typically, one uses several posterior predictive statistics, not just one. First, we calculate the distribution of marginal standard deviations across the collection of simulated data sets. This R code illustrates the use of the handy R command <code>apply</code>, which applies a function to one of the margins (rows or columns) of an array. Here, because the individual data sets are stored as the rows of <code>post.predict</code>, we will calculate the standard deviation of the contents of each row.</p>
<div class="sourceCode" id="cb582"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb582-1"><a href="generalized-linear-models.html#cb582-1" aria-hidden="true" tabindex="-1"></a>post.predict.sd <span class="ot">&lt;-</span> <span class="fu">apply</span>(post.predict, <span class="dv">1</span>, sd)</span></code></pre></div>
<p>Now we plot a histogram of these standard deviations and compare the distribution to the marginal standard deviation of the real data.</p>
<div class="sourceCode" id="cb583"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb583-1"><a href="generalized-linear-models.html#cb583-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(post.predict.sd, <span class="at">breaks =</span> <span class="dv">20</span>, <span class="at">xlab =</span> <span class="st">&quot;Marginal SD of response&quot;</span>)</span>
<span id="cb583-2"><a href="generalized-linear-models.html#cb583-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="fu">sd</span>(elephant<span class="sc">$</span>matings), <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="07-GeneralizedLinearModels_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>The actual standard deviation, shown by the red line, is consistent with the standard deviations of the simulated data sets, indicating that the model provides a reasonable description of the data, at least with regard to the marginal SD of the response variable. This is consistent with our previous conclusions that the extra-Poisson variation in these data is quite mild.</p>
<p>The authors of <code>rstanarm</code> have provided the function <code>pp_check</code> (for [p]osterior [p]redictive check) to do all of this in one fell swoop.</p>
<div class="sourceCode" id="cb584"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb584-1"><a href="generalized-linear-models.html#cb584-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(fm5, <span class="at">plotfun =</span> <span class="st">&quot;stat&quot;</span>, <span class="at">stat =</span> <span class="st">&quot;sd&quot;</span>, <span class="at">binwidth =</span> .<span class="dv">1</span>)</span></code></pre></div>
<p><img src="07-GeneralizedLinearModels_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
</div>
<div id="jags" class="section level3" number="7.2.3">
<h3><span class="header-section-number">7.2.3</span> JAGS</h3>
<p>We can also code the model up directly in JAGS. Notice that the code here is barely more complicated than OLS regression. The code below shows the JAGS implementation of the elephant GLM with a Poisson distribution for the response and a log link.</p>
<div class="sourceCode" id="cb585"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb585-1"><a href="generalized-linear-models.html#cb585-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(R2jags)</span></code></pre></div>
<pre><code>## Loading required package: R2jags</code></pre>
<pre><code>## Warning: package &#39;R2jags&#39; was built under R version 4.1.1</code></pre>
<pre><code>## Loading required package: rjags</code></pre>
<pre><code>## Warning: package &#39;rjags&#39; was built under R version 4.1.1</code></pre>
<pre><code>## Loading required package: coda</code></pre>
<pre><code>## Linked to JAGS 4.3.0</code></pre>
<pre><code>## Loaded modules: basemod,bugs</code></pre>
<pre><code>## 
## Attaching package: &#39;R2jags&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:coda&#39;:
## 
##     traceplot</code></pre>
<div class="sourceCode" id="cb595"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb595-1"><a href="generalized-linear-models.html#cb595-1" aria-hidden="true" tabindex="-1"></a>elephant.model <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb595-2"><a href="generalized-linear-models.html#cb595-2" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb595-3"><a href="generalized-linear-models.html#cb595-3" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>J) {             <span class="co"># J = number of data points</span></span>
<span id="cb595-4"><a href="generalized-linear-models.html#cb595-4" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb595-5"><a href="generalized-linear-models.html#cb595-5" aria-hidden="true" tabindex="-1"></a>      y[j] <span class="sc">~</span> <span class="fu">dpois</span>(mu[j])      <span class="co"># data model:  the likelihood </span></span>
<span id="cb595-6"><a href="generalized-linear-models.html#cb595-6" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb595-7"><a href="generalized-linear-models.html#cb595-7" aria-hidden="true" tabindex="-1"></a>      mu[j] <span class="ot">&lt;-</span> <span class="fu">exp</span>(eta[j])      <span class="co"># inverse link</span></span>
<span id="cb595-8"><a href="generalized-linear-models.html#cb595-8" aria-hidden="true" tabindex="-1"></a>      eta[j] <span class="ot">&lt;-</span> a <span class="sc">+</span> b <span class="sc">*</span> x[j]  <span class="co"># linear predictor</span></span>
<span id="cb595-9"><a href="generalized-linear-models.html#cb595-9" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb595-10"><a href="generalized-linear-models.html#cb595-10" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb595-11"><a href="generalized-linear-models.html#cb595-11" aria-hidden="true" tabindex="-1"></a>   a <span class="sc">~</span> <span class="fu">dnorm</span> (<span class="fl">0.0</span>, <span class="fl">1E-6</span>)       <span class="co"># prior for intercept</span></span>
<span id="cb595-12"><a href="generalized-linear-models.html#cb595-12" aria-hidden="true" tabindex="-1"></a>   b <span class="sc">~</span> <span class="fu">dnorm</span> (<span class="fl">0.0</span>, <span class="fl">1E-6</span>)       <span class="co"># prior for slope</span></span>
<span id="cb595-13"><a href="generalized-linear-models.html#cb595-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb595-14"><a href="generalized-linear-models.html#cb595-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb595-15"><a href="generalized-linear-models.html#cb595-15" aria-hidden="true" tabindex="-1"></a>jags.data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">y =</span> elephant<span class="sc">$</span>matings, </span>
<span id="cb595-16"><a href="generalized-linear-models.html#cb595-16" aria-hidden="true" tabindex="-1"></a>                  <span class="at">x =</span> elephant<span class="sc">$</span>age,</span>
<span id="cb595-17"><a href="generalized-linear-models.html#cb595-17" aria-hidden="true" tabindex="-1"></a>                  <span class="at">J =</span> <span class="fu">nrow</span>(elephant))</span>
<span id="cb595-18"><a href="generalized-linear-models.html#cb595-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb595-19"><a href="generalized-linear-models.html#cb595-19" aria-hidden="true" tabindex="-1"></a>jags.params <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>)</span>
<span id="cb595-20"><a href="generalized-linear-models.html#cb595-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb595-21"><a href="generalized-linear-models.html#cb595-21" aria-hidden="true" tabindex="-1"></a>jags.inits <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb595-22"><a href="generalized-linear-models.html#cb595-22" aria-hidden="true" tabindex="-1"></a>   <span class="fu">list</span>(<span class="st">&quot;a&quot;</span> <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">1</span>), <span class="st">&quot;b&quot;</span> <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">1</span>))</span>
<span id="cb595-23"><a href="generalized-linear-models.html#cb595-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb595-24"><a href="generalized-linear-models.html#cb595-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb595-25"><a href="generalized-linear-models.html#cb595-25" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb595-26"><a href="generalized-linear-models.html#cb595-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb595-27"><a href="generalized-linear-models.html#cb595-27" aria-hidden="true" tabindex="-1"></a>jagsfit <span class="ot">&lt;-</span> <span class="fu">jags</span>(<span class="at">data               =</span> jags.data, </span>
<span id="cb595-28"><a href="generalized-linear-models.html#cb595-28" aria-hidden="true" tabindex="-1"></a>                <span class="at">inits              =</span> jags.inits, </span>
<span id="cb595-29"><a href="generalized-linear-models.html#cb595-29" aria-hidden="true" tabindex="-1"></a>                <span class="at">parameters.to.save =</span> jags.params,</span>
<span id="cb595-30"><a href="generalized-linear-models.html#cb595-30" aria-hidden="true" tabindex="-1"></a>                <span class="at">model.file         =</span> elephant.model,</span>
<span id="cb595-31"><a href="generalized-linear-models.html#cb595-31" aria-hidden="true" tabindex="-1"></a>                <span class="at">n.chains           =</span> <span class="dv">3</span>,</span>
<span id="cb595-32"><a href="generalized-linear-models.html#cb595-32" aria-hidden="true" tabindex="-1"></a>                <span class="at">n.iter             =</span> <span class="fl">5E4</span>,</span>
<span id="cb595-33"><a href="generalized-linear-models.html#cb595-33" aria-hidden="true" tabindex="-1"></a>                <span class="at">n.thin             =</span> <span class="dv">5</span>)</span></code></pre></div>
<pre><code>## module glm loaded</code></pre>
<p>Let’s have a look at the posterior summaries:</p>
<div class="sourceCode" id="cb597"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb597-1"><a href="generalized-linear-models.html#cb597-1" aria-hidden="true" tabindex="-1"></a>mcmc.output <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(jagsfit<span class="sc">$</span>BUGSoutput<span class="sc">$</span>sims.list)</span>
<span id="cb597-2"><a href="generalized-linear-models.html#cb597-2" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(mcmc.output, <span class="dv">2</span>, mean)</span></code></pre></div>
<pre><code>##            a            b     deviance 
##  -1.59257609   0.06871434 154.47531083</code></pre>
<div class="sourceCode" id="cb599"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb599-1"><a href="generalized-linear-models.html#cb599-1" aria-hidden="true" tabindex="-1"></a><span class="fu">HPDinterval</span>(<span class="fu">as.mcmc</span>(mcmc.output), <span class="at">prob =</span> <span class="fl">0.95</span>)</span></code></pre></div>
<pre><code>##                 lower        upper
## a         -2.64905619  -0.54223141
## b          0.04194793   0.09511553
## deviance 152.45783408 158.39245393
## attr(,&quot;Probability&quot;)
## [1] 0.95</code></pre>
<p>Compare these to the values generated by the <code>glm</code> fit with the log link. We can also visualize the uncertainty in the fit by plotting the fit implied by a random sample of parameters from the posterior:</p>
<div class="sourceCode" id="cb601"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb601-1"><a href="generalized-linear-models.html#cb601-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(matings <span class="sc">~</span> age, <span class="at">data =</span> elephant, <span class="at">type =</span> <span class="st">&quot;n&quot;</span>)</span>
<span id="cb601-2"><a href="generalized-linear-models.html#cb601-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb601-3"><a href="generalized-linear-models.html#cb601-3" aria-hidden="true" tabindex="-1"></a>subset.samples <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(mcmc.output), <span class="at">size =</span> <span class="dv">100</span>)</span>
<span id="cb601-4"><a href="generalized-linear-models.html#cb601-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb601-5"><a href="generalized-linear-models.html#cb601-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> subset.samples) {</span>
<span id="cb601-6"><a href="generalized-linear-models.html#cb601-6" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb601-7"><a href="generalized-linear-models.html#cb601-7" aria-hidden="true" tabindex="-1"></a>   a <span class="ot">&lt;-</span> mcmc.output<span class="sc">$</span>a[i]</span>
<span id="cb601-8"><a href="generalized-linear-models.html#cb601-8" aria-hidden="true" tabindex="-1"></a>   b <span class="ot">&lt;-</span> mcmc.output<span class="sc">$</span>b[i]</span>
<span id="cb601-9"><a href="generalized-linear-models.html#cb601-9" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb601-10"><a href="generalized-linear-models.html#cb601-10" aria-hidden="true" tabindex="-1"></a>   my.fit <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">exp</span>(a <span class="sc">+</span> b <span class="sc">*</span> x)</span>
<span id="cb601-11"><a href="generalized-linear-models.html#cb601-11" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb601-12"><a href="generalized-linear-models.html#cb601-12" aria-hidden="true" tabindex="-1"></a>   <span class="fu">curve</span>(my.fit, </span>
<span id="cb601-13"><a href="generalized-linear-models.html#cb601-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">from =</span> <span class="fu">min</span>(elephant<span class="sc">$</span>age), </span>
<span id="cb601-14"><a href="generalized-linear-models.html#cb601-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">to   =</span> <span class="fu">max</span>(elephant<span class="sc">$</span>age),</span>
<span id="cb601-15"><a href="generalized-linear-models.html#cb601-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">col  =</span> <span class="st">&quot;deepskyblue&quot;</span>, </span>
<span id="cb601-16"><a href="generalized-linear-models.html#cb601-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">lwd  =</span> <span class="dv">1</span>, </span>
<span id="cb601-17"><a href="generalized-linear-models.html#cb601-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">add  =</span> <span class="cn">TRUE</span>)</span>
<span id="cb601-18"><a href="generalized-linear-models.html#cb601-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb601-19"><a href="generalized-linear-models.html#cb601-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb601-20"><a href="generalized-linear-models.html#cb601-20" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(elephant, <span class="fu">points</span>(matings <span class="sc">~</span> age, <span class="at">pch =</span> <span class="dv">16</span>))</span>
<span id="cb601-21"><a href="generalized-linear-models.html#cb601-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb601-22"><a href="generalized-linear-models.html#cb601-22" aria-hidden="true" tabindex="-1"></a>post.means <span class="ot">&lt;-</span> <span class="fu">apply</span>(mcmc.output, <span class="dv">2</span>, mean)</span>
<span id="cb601-23"><a href="generalized-linear-models.html#cb601-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb601-24"><a href="generalized-linear-models.html#cb601-24" aria-hidden="true" tabindex="-1"></a>my.fit <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">exp</span>(post.means[<span class="st">&#39;a&#39;</span>] <span class="sc">+</span> post.means[<span class="st">&#39;b&#39;</span>] <span class="sc">*</span> x)</span>
<span id="cb601-25"><a href="generalized-linear-models.html#cb601-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb601-26"><a href="generalized-linear-models.html#cb601-26" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(my.fit, </span>
<span id="cb601-27"><a href="generalized-linear-models.html#cb601-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">from =</span> <span class="fu">min</span>(elephant<span class="sc">$</span>age), </span>
<span id="cb601-28"><a href="generalized-linear-models.html#cb601-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">to   =</span> <span class="fu">max</span>(elephant<span class="sc">$</span>age),</span>
<span id="cb601-29"><a href="generalized-linear-models.html#cb601-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">col  =</span> <span class="st">&quot;blue&quot;</span>, </span>
<span id="cb601-30"><a href="generalized-linear-models.html#cb601-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">lwd  =</span> <span class="dv">2</span>, </span>
<span id="cb601-31"><a href="generalized-linear-models.html#cb601-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">add  =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="07-GeneralizedLinearModels_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<p>Suppose we wanted to fit this model using JAGS with the identity link, so that the relationship between mean matings and age was linear. To do so, we would have to be careful, because we would have to make sure that the MCMC sampler did not stray into regions that generated negative values for the observation-level mean, <span class="math inline">\(\mu\)</span>. Mathematically, we simply want to construct a likelihood that evaluates to 0 whenever <span class="math inline">\(\mu \leq 0\)</span>. However, as of this writing, I haven’t figured out what the best approach is for implementing such a model in JAGS.</p>
</div>
<div id="observation-level-random-effects" class="section level3" number="7.2.4">
<h3><span class="header-section-number">7.2.4</span> Observation-level random effects</h3>
<p>We use this opportunity to introduce an alternative approach to accommodating overdispersion in models with non-Gaussian responses. This alternative approach entails adding a latent Gaussian-distributed random effect to the linear predictor. Because this random effect takes a unique value for each observation, it is known as a “observation-level random effect”. Observation-level random effects are motivated by the idea that overdispersion is caused by additional inputs or factors that vary among observations and re not included in the model. For example, knowing next to nothing about elephants, we might speculate that there are additional factors that influence a male elephant’s mating success above and beyond age, such as (say) nutrition. The observation-level random effects are meant to capture this additional variation. Importantly, if we use an observation-level random effect, then we have no control on the sign of the linear predictor <span class="math inline">\(\eta\)</span>. Consequently, we must use a link function that maps any value of the linear predictor (<span class="math inline">\(\eta\)</span>) to a valid value of the observation-level mean (<span class="math inline">\(\mu\)</span>). (In other words, we can’t use the identity link for a Poisson response.) For the elephant data, adding an observation-level random effect changes the model to:
<span class="math display">\[\begin{align*}
y_i &amp; \sim \mathrm{Pois}(\mu_i)\\
\mu_i  &amp; = \exp({\eta_i}) \\
\eta_i &amp; \sim \mathcal{N}(a + b x_i, \sigma^2_\eta).
\end{align*}\]</span></p>
<p>Priors on <span class="math inline">\(a\)</span>, <span class="math inline">\(b\)</span>, and <span class="math inline">\(\sigma^2_\eta\)</span> would complete the Bayesian specification. Implemeting the model in JAGS is straightforward:</p>
<div class="sourceCode" id="cb602"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb602-1"><a href="generalized-linear-models.html#cb602-1" aria-hidden="true" tabindex="-1"></a>elephant.model<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb602-2"><a href="generalized-linear-models.html#cb602-2" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb602-3"><a href="generalized-linear-models.html#cb602-3" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>J) {             <span class="co"># J = number of data points</span></span>
<span id="cb602-4"><a href="generalized-linear-models.html#cb602-4" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb602-5"><a href="generalized-linear-models.html#cb602-5" aria-hidden="true" tabindex="-1"></a>      y[j] <span class="sc">~</span> <span class="fu">dpois</span>(mu[j])      <span class="co"># data model:  the likelihood </span></span>
<span id="cb602-6"><a href="generalized-linear-models.html#cb602-6" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb602-7"><a href="generalized-linear-models.html#cb602-7" aria-hidden="true" tabindex="-1"></a>      mu[j] <span class="ot">&lt;-</span> <span class="fu">exp</span>(eta[j])      <span class="co"># inverse link</span></span>
<span id="cb602-8"><a href="generalized-linear-models.html#cb602-8" aria-hidden="true" tabindex="-1"></a>      eta[j] <span class="sc">~</span> <span class="fu">dnorm</span>(a <span class="sc">+</span> b <span class="sc">*</span> x[j], tau_eps)  <span class="co"># linear predictor, includes observation-level random effect</span></span>
<span id="cb602-9"><a href="generalized-linear-models.html#cb602-9" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb602-10"><a href="generalized-linear-models.html#cb602-10" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb602-11"><a href="generalized-linear-models.html#cb602-11" aria-hidden="true" tabindex="-1"></a>   a <span class="sc">~</span> <span class="fu">dnorm</span> (<span class="fl">0.0</span>, <span class="fl">1E-6</span>)       <span class="co"># prior for intercept</span></span>
<span id="cb602-12"><a href="generalized-linear-models.html#cb602-12" aria-hidden="true" tabindex="-1"></a>   b <span class="sc">~</span> <span class="fu">dnorm</span> (<span class="fl">0.0</span>, <span class="fl">1E-6</span>)       <span class="co"># prior for slope</span></span>
<span id="cb602-13"><a href="generalized-linear-models.html#cb602-13" aria-hidden="true" tabindex="-1"></a>   tau_eps <span class="sc">~</span> <span class="fu">dgamma</span> (<span class="fl">0.01</span>, <span class="fl">0.01</span>)</span>
<span id="cb602-14"><a href="generalized-linear-models.html#cb602-14" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb602-15"><a href="generalized-linear-models.html#cb602-15" aria-hidden="true" tabindex="-1"></a>   sd_eps <span class="ot">&lt;-</span> <span class="fu">pow</span>(tau_eps, <span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb602-16"><a href="generalized-linear-models.html#cb602-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb602-17"><a href="generalized-linear-models.html#cb602-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb602-18"><a href="generalized-linear-models.html#cb602-18" aria-hidden="true" tabindex="-1"></a>jags.data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">y =</span> elephant<span class="sc">$</span>matings, </span>
<span id="cb602-19"><a href="generalized-linear-models.html#cb602-19" aria-hidden="true" tabindex="-1"></a>                  <span class="at">x =</span> elephant<span class="sc">$</span>age,</span>
<span id="cb602-20"><a href="generalized-linear-models.html#cb602-20" aria-hidden="true" tabindex="-1"></a>                  <span class="at">J =</span> <span class="fu">nrow</span>(elephant))</span>
<span id="cb602-21"><a href="generalized-linear-models.html#cb602-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb602-22"><a href="generalized-linear-models.html#cb602-22" aria-hidden="true" tabindex="-1"></a>jags.params <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;sd_eps&quot;</span>)</span>
<span id="cb602-23"><a href="generalized-linear-models.html#cb602-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb602-24"><a href="generalized-linear-models.html#cb602-24" aria-hidden="true" tabindex="-1"></a>jags.inits <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb602-25"><a href="generalized-linear-models.html#cb602-25" aria-hidden="true" tabindex="-1"></a>   <span class="fu">list</span>(<span class="st">&quot;a&quot;</span> <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">1</span>), <span class="st">&quot;b&quot;</span> <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">1</span>), <span class="st">&quot;tau_eps&quot;</span> <span class="ot">=</span> <span class="fu">runif</span>(<span class="dv">1</span>))</span>
<span id="cb602-26"><a href="generalized-linear-models.html#cb602-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb602-27"><a href="generalized-linear-models.html#cb602-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb602-28"><a href="generalized-linear-models.html#cb602-28" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb602-29"><a href="generalized-linear-models.html#cb602-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb602-30"><a href="generalized-linear-models.html#cb602-30" aria-hidden="true" tabindex="-1"></a>jagsfit2 <span class="ot">&lt;-</span> <span class="fu">jags</span>(<span class="at">data               =</span> jags.data, </span>
<span id="cb602-31"><a href="generalized-linear-models.html#cb602-31" aria-hidden="true" tabindex="-1"></a>                 <span class="at">inits              =</span> jags.inits, </span>
<span id="cb602-32"><a href="generalized-linear-models.html#cb602-32" aria-hidden="true" tabindex="-1"></a>                 <span class="at">parameters.to.save =</span> jags.params,</span>
<span id="cb602-33"><a href="generalized-linear-models.html#cb602-33" aria-hidden="true" tabindex="-1"></a>                 <span class="at">model.file         =</span> elephant.model<span class="fl">.2</span>,</span>
<span id="cb602-34"><a href="generalized-linear-models.html#cb602-34" aria-hidden="true" tabindex="-1"></a>                 <span class="at">n.chains           =</span> <span class="dv">3</span>,</span>
<span id="cb602-35"><a href="generalized-linear-models.html#cb602-35" aria-hidden="true" tabindex="-1"></a>                 <span class="at">n.iter             =</span> <span class="fl">5E4</span>,</span>
<span id="cb602-36"><a href="generalized-linear-models.html#cb602-36" aria-hidden="true" tabindex="-1"></a>                 <span class="at">n.thin             =</span> <span class="dv">5</span>)</span></code></pre></div>
<p>Again, we can have a look at the posterior summaries, and plot a random sample of fits from the posterior:</p>
<div class="sourceCode" id="cb603"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb603-1"><a href="generalized-linear-models.html#cb603-1" aria-hidden="true" tabindex="-1"></a>mcmc.output <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(jagsfit2<span class="sc">$</span>BUGSoutput<span class="sc">$</span>sims.list)</span>
<span id="cb603-2"><a href="generalized-linear-models.html#cb603-2" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(mcmc.output, <span class="dv">2</span>, mean)</span></code></pre></div>
<pre><code>##            a            b     deviance       sd_eps 
##  -1.65360318   0.06934144 147.14813848   0.27075058</code></pre>
<div class="sourceCode" id="cb605"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb605-1"><a href="generalized-linear-models.html#cb605-1" aria-hidden="true" tabindex="-1"></a><span class="fu">HPDinterval</span>(<span class="fu">as.mcmc</span>(mcmc.output), <span class="at">prob =</span> <span class="fl">0.95</span>)</span></code></pre></div>
<pre><code>##                 lower       upper
## a         -2.85901410  -0.4407061
## b          0.03818321   0.1005042
## deviance 133.86486164 158.2878871
## sd_eps     0.06376511   0.5261329
## attr(,&quot;Probability&quot;)
## [1] 0.95</code></pre>
<div class="sourceCode" id="cb607"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb607-1"><a href="generalized-linear-models.html#cb607-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(matings <span class="sc">~</span> age, <span class="at">data =</span> elephant, <span class="at">type =</span> <span class="st">&quot;n&quot;</span>)</span>
<span id="cb607-2"><a href="generalized-linear-models.html#cb607-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb607-3"><a href="generalized-linear-models.html#cb607-3" aria-hidden="true" tabindex="-1"></a>subset.samples <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(mcmc.output), <span class="at">size =</span> <span class="dv">100</span>)</span>
<span id="cb607-4"><a href="generalized-linear-models.html#cb607-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb607-5"><a href="generalized-linear-models.html#cb607-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> subset.samples) {</span>
<span id="cb607-6"><a href="generalized-linear-models.html#cb607-6" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb607-7"><a href="generalized-linear-models.html#cb607-7" aria-hidden="true" tabindex="-1"></a>   a <span class="ot">&lt;-</span> mcmc.output<span class="sc">$</span>a[i]</span>
<span id="cb607-8"><a href="generalized-linear-models.html#cb607-8" aria-hidden="true" tabindex="-1"></a>   b <span class="ot">&lt;-</span> mcmc.output<span class="sc">$</span>b[i]</span>
<span id="cb607-9"><a href="generalized-linear-models.html#cb607-9" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb607-10"><a href="generalized-linear-models.html#cb607-10" aria-hidden="true" tabindex="-1"></a>   my.fit <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">exp</span>(a <span class="sc">+</span> b <span class="sc">*</span> x)</span>
<span id="cb607-11"><a href="generalized-linear-models.html#cb607-11" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb607-12"><a href="generalized-linear-models.html#cb607-12" aria-hidden="true" tabindex="-1"></a>   <span class="fu">curve</span>(my.fit, </span>
<span id="cb607-13"><a href="generalized-linear-models.html#cb607-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">from =</span> <span class="fu">min</span>(elephant<span class="sc">$</span>age), </span>
<span id="cb607-14"><a href="generalized-linear-models.html#cb607-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">to   =</span> <span class="fu">max</span>(elephant<span class="sc">$</span>age),</span>
<span id="cb607-15"><a href="generalized-linear-models.html#cb607-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">col  =</span> <span class="st">&quot;deepskyblue&quot;</span>, </span>
<span id="cb607-16"><a href="generalized-linear-models.html#cb607-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">lwd  =</span> <span class="dv">1</span>, </span>
<span id="cb607-17"><a href="generalized-linear-models.html#cb607-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">add  =</span> <span class="cn">TRUE</span>)</span>
<span id="cb607-18"><a href="generalized-linear-models.html#cb607-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb607-19"><a href="generalized-linear-models.html#cb607-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb607-20"><a href="generalized-linear-models.html#cb607-20" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(elephant, <span class="fu">points</span>(matings <span class="sc">~</span> age, <span class="at">pch =</span> <span class="dv">16</span>))</span>
<span id="cb607-21"><a href="generalized-linear-models.html#cb607-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb607-22"><a href="generalized-linear-models.html#cb607-22" aria-hidden="true" tabindex="-1"></a>post.means <span class="ot">&lt;-</span> <span class="fu">apply</span>(mcmc.output, <span class="dv">2</span>, mean)</span>
<span id="cb607-23"><a href="generalized-linear-models.html#cb607-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb607-24"><a href="generalized-linear-models.html#cb607-24" aria-hidden="true" tabindex="-1"></a>my.fit <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">exp</span>(post.means[<span class="st">&#39;a&#39;</span>] <span class="sc">+</span> post.means[<span class="st">&#39;b&#39;</span>] <span class="sc">*</span> x)</span>
<span id="cb607-25"><a href="generalized-linear-models.html#cb607-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb607-26"><a href="generalized-linear-models.html#cb607-26" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(my.fit, </span>
<span id="cb607-27"><a href="generalized-linear-models.html#cb607-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">from =</span> <span class="fu">min</span>(elephant<span class="sc">$</span>age), </span>
<span id="cb607-28"><a href="generalized-linear-models.html#cb607-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">to   =</span> <span class="fu">max</span>(elephant<span class="sc">$</span>age),</span>
<span id="cb607-29"><a href="generalized-linear-models.html#cb607-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">col  =</span> <span class="st">&quot;blue&quot;</span>, </span>
<span id="cb607-30"><a href="generalized-linear-models.html#cb607-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">lwd  =</span> <span class="dv">2</span>, </span>
<span id="cb607-31"><a href="generalized-linear-models.html#cb607-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">add  =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="07-GeneralizedLinearModels_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<p>Because the extra-Poisson variation in the elephant data is small, the effect of the observation-level random effect is slight. However, an eagle-eyed observer might notice the following differences. First, the posterior uncertainty in the slope parameter that captures the effect of age has increased slightly. Second, and perhaps more meaningfully, the fitted curve has dropped slightly. This makes sense, as the model with the observation-level random effect doesn’t have to strain quite as hard to accommodate the few elephants with large and positive residuals. Thus, adding an observation-level random effect has had the same effect on the fit as other approaches to accommodating extra-Poisson variaton.</p>
<p>Formally, we can assess the need for the observation-level random effect by comparing the two models with the deviance information criterion (DIC), an information criterion that can be used to compare Bayesian models in the same way that AIC can be used to compare frequentist fits. DIC is provided as a portion to the output from the <code>print</code> command applied to a JAGS model fit.</p>
<div class="sourceCode" id="cb608"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb608-1"><a href="generalized-linear-models.html#cb608-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(jagsfit)</span></code></pre></div>
<pre><code>## Inference for Bugs model at &quot;C:/Users/krgross/AppData/Local/Temp/RtmpGiLYNj/model29e476421391.txt&quot;, fit using jags,
##  3 chains, each with 50000 iterations (first 25000 discarded), n.thin = 5
##  n.sims = 15000 iterations saved
##          mu.vect sd.vect    2.5%     25%     50%     75%   97.5%  Rhat n.eff
## a         -1.593   0.544  -2.656  -1.961  -1.582  -1.223  -0.546 1.001 12000
## b          0.069   0.014   0.042   0.059   0.069   0.078   0.095 1.001  9200
## deviance 154.475   2.737 152.508 153.036 153.848 155.210 159.742 1.001 15000
## 
## For each parameter, n.eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor (at convergence, Rhat=1).
## 
## DIC info (using the rule, pD = var(deviance)/2)
## pD = 3.7 and DIC = 158.2
## DIC is an estimate of expected predictive error (lower deviance is better).</code></pre>
<div class="sourceCode" id="cb610"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb610-1"><a href="generalized-linear-models.html#cb610-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(jagsfit2)</span></code></pre></div>
<pre><code>## Inference for Bugs model at &quot;C:/Users/krgross/AppData/Local/Temp/RtmpGiLYNj/model29e47117bdd.txt&quot;, fit using jags,
##  3 chains, each with 50000 iterations (first 25000 discarded), n.thin = 5
##  n.sims = 15000 iterations saved
##          mu.vect sd.vect    2.5%     25%     50%     75%   97.5%  Rhat n.eff
## a         -1.654   0.622  -2.913  -2.065  -1.640  -1.233  -0.482 1.004   680
## b          0.069   0.016   0.039   0.059   0.069   0.080   0.101 1.003   850
## sd_eps     0.271   0.132   0.081   0.167   0.252   0.352   0.574 1.001 15000
## deviance 147.148   6.377 133.573 142.883 147.837 151.760 158.083 1.001 15000
## 
## For each parameter, n.eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor (at convergence, Rhat=1).
## 
## DIC info (using the rule, pD = var(deviance)/2)
## pD = 20.3 and DIC = 167.5
## DIC is an estimate of expected predictive error (lower deviance is better).</code></pre>
<p>In this case, the DIC favors the model without the observation-level random effect.</p>
<p>Before moving on, it is worth noting that this Poisson regression with an observation-level random effect is the type of model that is much easier to fit from a Bayesian perspective. To approach this model from the frequentist perspective, we would have to write down, and maximize, the likelihood, which is a function of the model’s three parameters: <span class="math inline">\(a\)</span>, <span class="math inline">\(b\)</span>, and <span class="math inline">\(\sigma^2_\eta\)</span>. However, to write down the likelihood, we would have to integrate out the observation-level random effects. For the elephant data, this would correspond to an integral with 41 dimensions! While we could conceivably write this down, for all intents and purposes the likelihood would be impossible to compute, let alone to maximize. From a Bayesian perspective, though, adding latent random effects to a model with a non-normal response is nearly trivial.</p>
<p>The above discussion begs the question of just how programs like <code>lme4::lmer</code> fit mixed-effect models in the first place. It turns out that, with a Gaussian response, the high-dimensional integral in the likelihood can be simplified without having to compute the entire integral numerically. This simplification flows from the fact that Gaussian random variates have a natural multivariate form. With a non-Gaussian response, things become substantially harder. When we study generalized linear mixed models, we will see some ideas for computing these likelihood functions, but all such approaches ultimately rely on computational approximations instead of evaluating the underlying integrals directly.</p>
</div>
</div>
<div id="binary-responses" class="section level2" number="7.3">
<h2><span class="header-section-number">7.3</span> Binary responses</h2>
<p>We generally distinguish between two types of data with binary responses: Data in which each individual record is a separate a binary response, and data in which each record consists of a group of binary observations. The same methods can be used for either type of data. We will begin by studying a data set with individual binary responses, and then use the industrial melanism data to illustrate grouped binary responses.</p>
<div id="individual-binary-responses-tb-in-boar" class="section level3" number="7.3.1">
<h3><span class="header-section-number">7.3.1</span> Individual binary responses: TB in boar</h3>
<p>To illustrate individual binary data, we will use a data set analyzed by Zuur et al. (2009) in their Ch. 10. As explained by Zuur et al., these data describe the incidence of “tuberculosis-like lesions in wild boar <em>Sus scrofa</em>” in southern Spain, and were originally collected by Vicente et al. (2006). The potential explanatory variables in the data set include a measure of the animal’s size, it’s sex, and a grouping into one of four age classes.</p>
<p>Preparatory work:</p>
<div class="sourceCode" id="cb612"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb612-1"><a href="generalized-linear-models.html#cb612-1" aria-hidden="true" tabindex="-1"></a>boar <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;data/boar.txt&quot;</span>, <span class="at">head =</span> T)</span>
<span id="cb612-2"><a href="generalized-linear-models.html#cb612-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb612-3"><a href="generalized-linear-models.html#cb612-3" aria-hidden="true" tabindex="-1"></a><span class="co"># remove incomplete records</span></span>
<span id="cb612-4"><a href="generalized-linear-models.html#cb612-4" aria-hidden="true" tabindex="-1"></a>boar <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(boar)</span>
<span id="cb612-5"><a href="generalized-linear-models.html#cb612-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb612-6"><a href="generalized-linear-models.html#cb612-6" aria-hidden="true" tabindex="-1"></a><span class="co"># convert sex to a factor</span></span>
<span id="cb612-7"><a href="generalized-linear-models.html#cb612-7" aria-hidden="true" tabindex="-1"></a>boar<span class="sc">$</span>SEX <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(boar<span class="sc">$</span>SEX)</span>
<span id="cb612-8"><a href="generalized-linear-models.html#cb612-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb612-9"><a href="generalized-linear-models.html#cb612-9" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(boar) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;tb&quot;</span>, <span class="st">&quot;sex&quot;</span>, <span class="st">&quot;age&quot;</span>, <span class="st">&quot;length&quot;</span>)</span>
<span id="cb612-10"><a href="generalized-linear-models.html#cb612-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(boar)</span></code></pre></div>
<pre><code>##        tb         sex          age            length     
##  Min.   :0.0000   1:206   Min.   :1.000   Min.   : 46.5  
##  1st Qu.:0.0000   2:288   1st Qu.:3.000   1st Qu.:107.0  
##  Median :0.0000           Median :3.000   Median :122.0  
##  Mean   :0.4575           Mean   :3.142   Mean   :117.3  
##  3rd Qu.:1.0000           3rd Qu.:4.000   3rd Qu.:130.4  
##  Max.   :1.0000           Max.   :4.000   Max.   :165.0</code></pre>
<p>We’ll fit the usual logistic regression model first, considering only the animal’s size as a predictor. Size in this case is a measure of the length of the animal, in cm.</p>
<div class="sourceCode" id="cb614"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb614-1"><a href="generalized-linear-models.html#cb614-1" aria-hidden="true" tabindex="-1"></a>fm1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(tb <span class="sc">~</span> length, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>), <span class="at">data =</span> boar)</span>
<span id="cb614-2"><a href="generalized-linear-models.html#cb614-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fm1)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = tb ~ length, family = binomial(link = &quot;logit&quot;), 
##     data = boar)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.6327  -1.1157  -0.6829   1.1263   2.0011  
## 
## Coefficients:
##              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -4.137107   0.695381  -5.949 2.69e-09 ***
## length       0.033531   0.005767   5.814 6.09e-09 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 681.25  on 493  degrees of freedom
## Residual deviance: 641.23  on 492  degrees of freedom
## AIC: 645.23
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<div class="sourceCode" id="cb616"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb616-1"><a href="generalized-linear-models.html#cb616-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(boar, <span class="fu">plot</span>(tb <span class="sc">~</span> length))</span>
<span id="cb616-2"><a href="generalized-linear-models.html#cb616-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb616-3"><a href="generalized-linear-models.html#cb616-3" aria-hidden="true" tabindex="-1"></a><span class="co"># add a line for the fitted probabilities of tb</span></span>
<span id="cb616-4"><a href="generalized-linear-models.html#cb616-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb616-5"><a href="generalized-linear-models.html#cb616-5" aria-hidden="true" tabindex="-1"></a>new.data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">length =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(boar<span class="sc">$</span>length),</span>
<span id="cb616-6"><a href="generalized-linear-models.html#cb616-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">to   =</span> <span class="fu">max</span>(boar<span class="sc">$</span>length),</span>
<span id="cb616-7"><a href="generalized-linear-models.html#cb616-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">length =</span> <span class="dv">100</span>))</span>
<span id="cb616-8"><a href="generalized-linear-models.html#cb616-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb616-9"><a href="generalized-linear-models.html#cb616-9" aria-hidden="true" tabindex="-1"></a>predict.fm1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(fm1, <span class="at">newdata =</span> new.data, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>, <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb616-10"><a href="generalized-linear-models.html#cb616-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb616-11"><a href="generalized-linear-models.html#cb616-11" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> new.data<span class="sc">$</span>length, <span class="at">y =</span> predict.fm1<span class="sc">$</span>fit, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb616-12"><a href="generalized-linear-models.html#cb616-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb616-13"><a href="generalized-linear-models.html#cb616-13" aria-hidden="true" tabindex="-1"></a><span class="co"># add lines for standard errors</span></span>
<span id="cb616-14"><a href="generalized-linear-models.html#cb616-14" aria-hidden="true" tabindex="-1"></a><span class="co"># use critical value from z distribution here because</span></span>
<span id="cb616-15"><a href="generalized-linear-models.html#cb616-15" aria-hidden="true" tabindex="-1"></a><span class="co"># the scale parameter is not estimated</span></span>
<span id="cb616-16"><a href="generalized-linear-models.html#cb616-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb616-17"><a href="generalized-linear-models.html#cb616-17" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x   =</span> new.data<span class="sc">$</span>length, </span>
<span id="cb616-18"><a href="generalized-linear-models.html#cb616-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">y   =</span> predict.fm1<span class="sc">$</span>fit <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> predict.fm1<span class="sc">$</span>se.fit, </span>
<span id="cb616-19"><a href="generalized-linear-models.html#cb616-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb616-20"><a href="generalized-linear-models.html#cb616-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">lty =</span> <span class="st">&quot;dashed&quot;</span>)</span>
<span id="cb616-21"><a href="generalized-linear-models.html#cb616-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb616-22"><a href="generalized-linear-models.html#cb616-22" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x   =</span> new.data<span class="sc">$</span>length, </span>
<span id="cb616-23"><a href="generalized-linear-models.html#cb616-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">y   =</span> predict.fm1<span class="sc">$</span>fit <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> predict.fm1<span class="sc">$</span>se.fit, </span>
<span id="cb616-24"><a href="generalized-linear-models.html#cb616-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb616-25"><a href="generalized-linear-models.html#cb616-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">lty =</span> <span class="st">&quot;dashed&quot;</span>)</span></code></pre></div>
<p><img src="07-GeneralizedLinearModels_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<p>Regression coefficients in logistic regression can be a bit hard to interpret. Gelman et al. (2020) suggest a “divide by 4” rule, meaning that the maximum rate at which the fitted probability increases (which occurs when the fitted probability is one half) equals the estimated regression coefficient divided by 4. In this case, that means that the maximum increase in the probability of TB is 0.0335 / 4 = 0.0084 per cm. Make of that what you will.</p>
<p>Overdispersion is typically not an issue with individual binary response data. Nonetheless, the pseudo-<span class="math inline">\(R^2\)</span> here is fairly low. We can try the probit and complementary log-log links to see if we obtain a better fit:</p>
<div class="sourceCode" id="cb617"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb617-1"><a href="generalized-linear-models.html#cb617-1" aria-hidden="true" tabindex="-1"></a><span class="co"># probit link</span></span>
<span id="cb617-2"><a href="generalized-linear-models.html#cb617-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb617-3"><a href="generalized-linear-models.html#cb617-3" aria-hidden="true" tabindex="-1"></a>fm1a <span class="ot">&lt;-</span> <span class="fu">glm</span>(tb <span class="sc">~</span> length, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;probit&quot;</span>), <span class="at">data =</span> boar)</span>
<span id="cb617-4"><a href="generalized-linear-models.html#cb617-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb617-5"><a href="generalized-linear-models.html#cb617-5" aria-hidden="true" tabindex="-1"></a><span class="co"># complementary log-log link</span></span>
<span id="cb617-6"><a href="generalized-linear-models.html#cb617-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb617-7"><a href="generalized-linear-models.html#cb617-7" aria-hidden="true" tabindex="-1"></a>fm1b <span class="ot">&lt;-</span> <span class="fu">glm</span>(tb <span class="sc">~</span> length, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;cloglog&quot;</span>), <span class="at">data =</span> boar)</span>
<span id="cb617-8"><a href="generalized-linear-models.html#cb617-8" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(fm1, fm1a, fm1b)</span></code></pre></div>
<pre><code>##      df      AIC
## fm1   2 645.2265
## fm1a  2 645.2665
## fm1b  2 645.6100</code></pre>
<div class="sourceCode" id="cb619"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb619-1"><a href="generalized-linear-models.html#cb619-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make a plot to compare the fits with the different links</span></span>
<span id="cb619-2"><a href="generalized-linear-models.html#cb619-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb619-3"><a href="generalized-linear-models.html#cb619-3" aria-hidden="true" tabindex="-1"></a>predict.fm1a <span class="ot">&lt;-</span> <span class="fu">predict</span>(fm1a, <span class="at">newdata =</span> new.data, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>, <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb619-4"><a href="generalized-linear-models.html#cb619-4" aria-hidden="true" tabindex="-1"></a>predict.fm1b <span class="ot">&lt;-</span> <span class="fu">predict</span>(fm1b, <span class="at">newdata =</span> new.data, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>, <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb619-5"><a href="generalized-linear-models.html#cb619-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb619-6"><a href="generalized-linear-models.html#cb619-6" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(boar, <span class="fu">plot</span>(tb <span class="sc">~</span> length))</span>
<span id="cb619-7"><a href="generalized-linear-models.html#cb619-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb619-8"><a href="generalized-linear-models.html#cb619-8" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> new.data<span class="sc">$</span>length, <span class="at">y =</span> predict.fm1<span class="sc">$</span>fit, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb619-9"><a href="generalized-linear-models.html#cb619-9" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> new.data<span class="sc">$</span>length, <span class="at">y =</span> predict.fm1a<span class="sc">$</span>fit, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb619-10"><a href="generalized-linear-models.html#cb619-10" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> new.data<span class="sc">$</span>length, <span class="at">y =</span> predict.fm1b<span class="sc">$</span>fit, <span class="at">col =</span> <span class="st">&quot;forestgreen&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb619-11"><a href="generalized-linear-models.html#cb619-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb619-12"><a href="generalized-linear-models.html#cb619-12" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;left&quot;</span>, </span>
<span id="cb619-13"><a href="generalized-linear-models.html#cb619-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">leg =</span> <span class="fu">c</span>(<span class="st">&quot;logit&quot;</span>, <span class="st">&quot;probit&quot;</span>, <span class="st">&quot;cloglog&quot;</span>), </span>
<span id="cb619-14"><a href="generalized-linear-models.html#cb619-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;forestgreen&quot;</span>), </span>
<span id="cb619-15"><a href="generalized-linear-models.html#cb619-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">16</span>)</span></code></pre></div>
<p><img src="07-GeneralizedLinearModels_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<p>The logit and probit links are nearly identical. The complementary log-log link differs slightly, but the logit link is AIC-best.</p>
<p>Try adding sex and age class as predictors. Some of the MLEs cannot be found, because none of the individuals with  and  are infected, thus the MLE of the log odds of infection for this group (which happens to be the baseline) is <span class="math inline">\(-\infty\)</span>. This phenomenon is known as “complete separation”.</p>
<div class="sourceCode" id="cb620"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb620-1"><a href="generalized-linear-models.html#cb620-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fit a model with sex, age (as a categorical predictor) and their interaction</span></span>
<span id="cb620-2"><a href="generalized-linear-models.html#cb620-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb620-3"><a href="generalized-linear-models.html#cb620-3" aria-hidden="true" tabindex="-1"></a>fm2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(tb <span class="sc">~</span> length <span class="sc">+</span> sex <span class="sc">*</span> <span class="fu">as.factor</span>(age),</span>
<span id="cb620-4"><a href="generalized-linear-models.html#cb620-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">family =</span> binomial,</span>
<span id="cb620-5"><a href="generalized-linear-models.html#cb620-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> boar)</span>
<span id="cb620-6"><a href="generalized-linear-models.html#cb620-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb620-7"><a href="generalized-linear-models.html#cb620-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fm2)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = tb ~ length + sex * as.factor(age), family = binomial, 
##     data = boar)
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -1.603  -1.108  -0.669   1.123   1.844  
## 
## Coefficients:
##                       Estimate Std. Error z value Pr(&gt;|z|)
## (Intercept)          -16.55356  724.50177  -0.023    0.982
## length                 0.01840    0.01253   1.469    0.142
## sex2                  14.19739  724.50190   0.020    0.984
## as.factor(age)2       13.83446  724.50169   0.019    0.985
## as.factor(age)3       14.31136  724.50191   0.020    0.984
## as.factor(age)4       14.68141  724.50218   0.020    0.984
## sex2:as.factor(age)2 -14.53254  724.50204  -0.020    0.984
## sex2:as.factor(age)3 -14.36861  724.50196  -0.020    0.984
## sex2:as.factor(age)4 -14.53354  724.50196  -0.020    0.984
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 681.25  on 493  degrees of freedom
## Residual deviance: 635.43  on 485  degrees of freedom
## AIC: 653.43
## 
## Number of Fisher Scoring iterations: 14</code></pre>
<div class="sourceCode" id="cb622"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb622-1"><a href="generalized-linear-models.html#cb622-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(boar, <span class="fu">table</span>(tb, age, sex))</span></code></pre></div>
<pre><code>## , , sex = 1
## 
##    age
## tb   1  2  3  4
##   0  4 37 37 28
##   1  0 14 34 52
## 
## , , sex = 2
## 
##    age
## tb   1  2  3  4
##   0  7 40 62 53
##   1  2 11 48 65</code></pre>
<p>There are several possible remedies here. The first is to try to reduce the number of parameters in the model, perhaps by eliminating the interaction between sex and age class.</p>
<div class="sourceCode" id="cb624"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb624-1"><a href="generalized-linear-models.html#cb624-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fit a model with sex, age (as a categorical predictor) and their interaction</span></span>
<span id="cb624-2"><a href="generalized-linear-models.html#cb624-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb624-3"><a href="generalized-linear-models.html#cb624-3" aria-hidden="true" tabindex="-1"></a>fm3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(tb <span class="sc">~</span> length <span class="sc">+</span> sex <span class="sc">+</span> <span class="fu">as.factor</span>(age),</span>
<span id="cb624-4"><a href="generalized-linear-models.html#cb624-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">family =</span> binomial,</span>
<span id="cb624-5"><a href="generalized-linear-models.html#cb624-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> boar)</span>
<span id="cb624-6"><a href="generalized-linear-models.html#cb624-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb624-7"><a href="generalized-linear-models.html#cb624-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fm3)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = tb ~ length + sex + as.factor(age), family = binomial, 
##     data = boar)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.5889  -1.1114  -0.6614   1.1112   1.8837  
## 
## Coefficients:
##                 Estimate Std. Error z value Pr(&gt;|z|)  
## (Intercept)     -2.67730    1.07306  -2.495   0.0126 *
## length           0.01959    0.01237   1.584   0.1133  
## sex2            -0.24297    0.19354  -1.255   0.2093  
## as.factor(age)2 -0.19847    0.92641  -0.214   0.8304  
## as.factor(age)3  0.33908    1.06938   0.317   0.7512  
## as.factor(age)4  0.59041    1.20582   0.490   0.6244  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 681.25  on 493  degrees of freedom
## Residual deviance: 637.41  on 488  degrees of freedom
## AIC: 649.41
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>A second option is to use so-called ``exact’’ methods for inference. There doesn’t appear to be a good package available for implementing these methods in R. Other software packages might be necessary.</p>
</div>
<div id="grouped-binary-data-industrial-melanism" class="section level3" number="7.3.2">
<h3><span class="header-section-number">7.3.2</span> Grouped binary data: Industrial melanism</h3>
<p>We’ll start with the standard logistic regression model for the industrial melanism data. We are primarily interested in determining if the effect of color morph on removal rate changes with distance from Liverpool. For grouped binary data, we need to specify both the number of “successes” and number of “failures” as the response variable in the model. Here, we use <code>cbind</code> to create a two-column matrix with the number of “successes” (moths removed) in the first column, and the number of “failures” (moths not removed) in the second column. See the help documentation for <code>glm</code> for more details.</p>
<div class="sourceCode" id="cb626"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb626-1"><a href="generalized-linear-models.html#cb626-1" aria-hidden="true" tabindex="-1"></a>moth <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;data/moth.txt&quot;</span>, <span class="at">head =</span> <span class="cn">TRUE</span>, <span class="at">stringsAsFactors =</span> <span class="cn">TRUE</span>)</span>
<span id="cb626-2"><a href="generalized-linear-models.html#cb626-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb626-3"><a href="generalized-linear-models.html#cb626-3" aria-hidden="true" tabindex="-1"></a>fm1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="fu">cbind</span>(removed, placed <span class="sc">-</span> removed) <span class="sc">~</span> morph <span class="sc">*</span> distance, </span>
<span id="cb626-4"><a href="generalized-linear-models.html#cb626-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>),</span>
<span id="cb626-5"><a href="generalized-linear-models.html#cb626-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> moth)</span>
<span id="cb626-6"><a href="generalized-linear-models.html#cb626-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb626-7"><a href="generalized-linear-models.html#cb626-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fm1)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = cbind(removed, placed - removed) ~ morph * distance, 
##     family = binomial(link = &quot;logit&quot;), data = moth)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -2.21183  -0.39883   0.01155   0.68292   1.31242  
## 
## Coefficients:
##                      Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)         -1.128987   0.197906  -5.705 1.17e-08 ***
## morphlight           0.411257   0.274490   1.498 0.134066    
## distance             0.018502   0.005645   3.277 0.001048 ** 
## morphlight:distance -0.027789   0.008085  -3.437 0.000588 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 35.385  on 13  degrees of freedom
## Residual deviance: 13.230  on 10  degrees of freedom
## AIC: 83.904
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>Grouped binary data are often overdispersed relative to the variance implied by a binomial distribution. In this case, we would call the overdispersion “extra-binomial” variation. As with count data, we can deal with overdispersion through a quasi-likelihood approach:</p>
<div class="sourceCode" id="cb628"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb628-1"><a href="generalized-linear-models.html#cb628-1" aria-hidden="true" tabindex="-1"></a>fm1q <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="fu">cbind</span>(removed, placed <span class="sc">-</span> removed) <span class="sc">~</span> morph <span class="sc">*</span> distance, </span>
<span id="cb628-2"><a href="generalized-linear-models.html#cb628-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">family =</span> <span class="fu">quasibinomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>),</span>
<span id="cb628-3"><a href="generalized-linear-models.html#cb628-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> moth)</span>
<span id="cb628-4"><a href="generalized-linear-models.html#cb628-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb628-5"><a href="generalized-linear-models.html#cb628-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fm1q)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = cbind(removed, placed - removed) ~ morph * distance, 
##     family = quasibinomial(link = &quot;logit&quot;), data = moth)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -2.21183  -0.39883   0.01155   0.68292   1.31242  
## 
## Coefficients:
##                      Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)         -1.128987   0.223104  -5.060 0.000492 ***
## morphlight           0.411257   0.309439   1.329 0.213360    
## distance             0.018502   0.006364   2.907 0.015637 *  
## morphlight:distance -0.027789   0.009115  -3.049 0.012278 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for quasibinomial family taken to be 1.270859)
## 
##     Null deviance: 35.385  on 13  degrees of freedom
## Residual deviance: 13.230  on 10  degrees of freedom
## AIC: NA
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>As with count data, using quasi-likelihood to estimate the scale (or dispersion) parameter increases the estimates of the standard errors of the coefficients by an amount equal to the square root of the estimated scale parameter.</p>
<p>The <span class="math inline">\(t\)</span>-test of the interaction between color morph and distance indicates that there is a statistically significant difference in how the proportion of moth removes changes over the distance transect between the two color morphs.</p>
<div class="sourceCode" id="cb630"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb630-1"><a href="generalized-linear-models.html#cb630-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> moth<span class="sc">$</span>distance, </span>
<span id="cb630-2"><a href="generalized-linear-models.html#cb630-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">y =</span> <span class="fu">residuals</span>(fm1q, <span class="at">type =</span> <span class="st">&quot;deviance&quot;</span>),</span>
<span id="cb630-3"><a href="generalized-linear-models.html#cb630-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;distance&quot;</span>,</span>
<span id="cb630-4"><a href="generalized-linear-models.html#cb630-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Deviance residuals&quot;</span>)</span>
<span id="cb630-5"><a href="generalized-linear-models.html#cb630-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb630-6"><a href="generalized-linear-models.html#cb630-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="st">&quot;dashed&quot;</span>)</span></code></pre></div>
<p><img src="07-GeneralizedLinearModels_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
<p>The plot of the residuals suggests that we might want to include a random effect for the sampling station. This makes complete sense. The data for the two color morphs at each station share whatever other characteristics make the station unique, and are thus correlated. To account for this correlation, we need to introduce a random effect for the station. This again gets us into the world of generalized linear mixed models. Before proceeding, we’ll write the model down. Let <span class="math inline">\(i=1,2\)</span> index the two color morphs, and let <span class="math inline">\(j = 1, \ldots, 7\)</span> index the stations. Let <span class="math inline">\(y_{ij}\)</span> be the number of moths removed, let <span class="math inline">\(n_{ij}\)</span> be the number of moths placed, and let <span class="math inline">\(x_{ij}\)</span> be the distance of the station from Liverpool. We wish to fit the model
<span class="math display">\[\begin{align*}
y_{ij} &amp; \sim \mathrm{Binom}(p_{ij}, n_{ij})\\
p_{ij}  &amp; = \mathrm{logit}^{-1}({\eta_{ij}}) \\
\eta_{ij} = a_i + b_i x_{ij} + L_j \\
L_j &amp; \sim \mathcal{N}(0, \sigma^2_L)
\end{align*}\]</span></p>
<p>The <span class="math inline">\(L_j\)</span>’s are our [l]ocation-specific random effects that capture any other station-to-station differences above and beyond the station’s distance from Liverpool. (It turns out that an observation-level random effect does not improve the model, at least as indicated by DIC.) We’ll fit the model in JAGS.</p>
<div class="sourceCode" id="cb631"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb631-1"><a href="generalized-linear-models.html#cb631-1" aria-hidden="true" tabindex="-1"></a>moth.model <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb631-2"><a href="generalized-linear-models.html#cb631-2" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb631-3"><a href="generalized-linear-models.html#cb631-3" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>J) {             <span class="co"># J = number of data points</span></span>
<span id="cb631-4"><a href="generalized-linear-models.html#cb631-4" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb631-5"><a href="generalized-linear-models.html#cb631-5" aria-hidden="true" tabindex="-1"></a>      y[j]   <span class="sc">~</span> <span class="fu">dbin</span>(p[j], n[j])      <span class="co"># data distribution</span></span>
<span id="cb631-6"><a href="generalized-linear-models.html#cb631-6" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb631-7"><a href="generalized-linear-models.html#cb631-7" aria-hidden="true" tabindex="-1"></a>      p[j]   <span class="ot">&lt;-</span> <span class="fu">ilogit</span>(eta[j])      <span class="co"># inverse link</span></span>
<span id="cb631-8"><a href="generalized-linear-models.html#cb631-8" aria-hidden="true" tabindex="-1"></a>      eta[j] <span class="ot">&lt;-</span> a[morph[j]] <span class="sc">+</span> b[morph[j]] <span class="sc">*</span> dist[j] <span class="sc">+</span> L[loc[j]]  <span class="co"># linear predictor,</span></span>
<span id="cb631-9"><a href="generalized-linear-models.html#cb631-9" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb631-10"><a href="generalized-linear-models.html#cb631-10" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb631-11"><a href="generalized-linear-models.html#cb631-11" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>){  <span class="co"># random effects for location</span></span>
<span id="cb631-12"><a href="generalized-linear-models.html#cb631-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb631-13"><a href="generalized-linear-models.html#cb631-13" aria-hidden="true" tabindex="-1"></a>     L[j] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, tau_L)</span>
<span id="cb631-14"><a href="generalized-linear-models.html#cb631-14" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb631-15"><a href="generalized-linear-models.html#cb631-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb631-16"><a href="generalized-linear-models.html#cb631-16" aria-hidden="true" tabindex="-1"></a>   a[<span class="dv">1</span>] <span class="sc">~</span> <span class="fu">dnorm</span> (<span class="fl">0.0</span>, <span class="fl">1E-6</span>)       <span class="co"># priors for intercept</span></span>
<span id="cb631-17"><a href="generalized-linear-models.html#cb631-17" aria-hidden="true" tabindex="-1"></a>   a[<span class="dv">2</span>] <span class="sc">~</span> <span class="fu">dnorm</span> (<span class="fl">0.0</span>, <span class="fl">1E-6</span>)       <span class="co"># priors for intercept</span></span>
<span id="cb631-18"><a href="generalized-linear-models.html#cb631-18" aria-hidden="true" tabindex="-1"></a>   b[<span class="dv">1</span>] <span class="sc">~</span> <span class="fu">dnorm</span> (<span class="fl">0.0</span>, <span class="fl">1E-6</span>)       <span class="co"># prior for slope</span></span>
<span id="cb631-19"><a href="generalized-linear-models.html#cb631-19" aria-hidden="true" tabindex="-1"></a>   b[<span class="dv">2</span>] <span class="sc">~</span> <span class="fu">dnorm</span> (<span class="fl">0.0</span>, <span class="fl">1E-6</span>)       <span class="co"># prior for slope</span></span>
<span id="cb631-20"><a href="generalized-linear-models.html#cb631-20" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb631-21"><a href="generalized-linear-models.html#cb631-21" aria-hidden="true" tabindex="-1"></a>   tau_L   <span class="sc">~</span> <span class="fu">dgamma</span> (<span class="fl">0.01</span>, <span class="fl">0.01</span>)    <span class="co"># prior for location-level random effect</span></span>
<span id="cb631-22"><a href="generalized-linear-models.html#cb631-22" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb631-23"><a href="generalized-linear-models.html#cb631-23" aria-hidden="true" tabindex="-1"></a>   sd_L   <span class="ot">&lt;-</span> <span class="fu">pow</span>(tau_L, <span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb631-24"><a href="generalized-linear-models.html#cb631-24" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb631-25"><a href="generalized-linear-models.html#cb631-25" aria-hidden="true" tabindex="-1"></a>   b.diff <span class="ot">&lt;-</span> b[<span class="dv">1</span>] <span class="sc">-</span> b[<span class="dv">2</span>]</span>
<span id="cb631-26"><a href="generalized-linear-models.html#cb631-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb631-27"><a href="generalized-linear-models.html#cb631-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb631-28"><a href="generalized-linear-models.html#cb631-28" aria-hidden="true" tabindex="-1"></a>jags.data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">y     =</span> moth<span class="sc">$</span>removed, </span>
<span id="cb631-29"><a href="generalized-linear-models.html#cb631-29" aria-hidden="true" tabindex="-1"></a>                  <span class="at">n     =</span> moth<span class="sc">$</span>placed,</span>
<span id="cb631-30"><a href="generalized-linear-models.html#cb631-30" aria-hidden="true" tabindex="-1"></a>                  <span class="at">dist  =</span> moth<span class="sc">$</span>distance,</span>
<span id="cb631-31"><a href="generalized-linear-models.html#cb631-31" aria-hidden="true" tabindex="-1"></a>                  <span class="at">loc   =</span> <span class="fu">as.numeric</span>(moth<span class="sc">$</span>location),</span>
<span id="cb631-32"><a href="generalized-linear-models.html#cb631-32" aria-hidden="true" tabindex="-1"></a>                  <span class="at">morph =</span> <span class="fu">as.numeric</span>(moth<span class="sc">$</span>morph),</span>
<span id="cb631-33"><a href="generalized-linear-models.html#cb631-33" aria-hidden="true" tabindex="-1"></a>                  <span class="at">J     =</span> <span class="fu">nrow</span>(moth))</span>
<span id="cb631-34"><a href="generalized-linear-models.html#cb631-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb631-35"><a href="generalized-linear-models.html#cb631-35" aria-hidden="true" tabindex="-1"></a>jags.params <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;a[1]&quot;</span>, <span class="st">&quot;a[2]&quot;</span>, <span class="st">&quot;b[1]&quot;</span>, <span class="st">&quot;b[2]&quot;</span>, <span class="st">&quot;b.diff&quot;</span>, <span class="st">&quot;sd_L&quot;</span>)</span>
<span id="cb631-36"><a href="generalized-linear-models.html#cb631-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb631-37"><a href="generalized-linear-models.html#cb631-37" aria-hidden="true" tabindex="-1"></a>jags.inits <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb631-38"><a href="generalized-linear-models.html#cb631-38" aria-hidden="true" tabindex="-1"></a>   <span class="fu">list</span>(<span class="st">&quot;tau_L&quot;</span> <span class="ot">=</span> <span class="fu">runif</span>(<span class="dv">1</span>))</span>
<span id="cb631-39"><a href="generalized-linear-models.html#cb631-39" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb631-40"><a href="generalized-linear-models.html#cb631-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb631-41"><a href="generalized-linear-models.html#cb631-41" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb631-42"><a href="generalized-linear-models.html#cb631-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb631-43"><a href="generalized-linear-models.html#cb631-43" aria-hidden="true" tabindex="-1"></a>jagsfit <span class="ot">&lt;-</span> <span class="fu">jags</span>(<span class="at">data               =</span> jags.data, </span>
<span id="cb631-44"><a href="generalized-linear-models.html#cb631-44" aria-hidden="true" tabindex="-1"></a>                <span class="at">inits              =</span> jags.inits, </span>
<span id="cb631-45"><a href="generalized-linear-models.html#cb631-45" aria-hidden="true" tabindex="-1"></a>                <span class="at">parameters.to.save =</span> jags.params,</span>
<span id="cb631-46"><a href="generalized-linear-models.html#cb631-46" aria-hidden="true" tabindex="-1"></a>                <span class="at">model.file         =</span> moth.model,</span>
<span id="cb631-47"><a href="generalized-linear-models.html#cb631-47" aria-hidden="true" tabindex="-1"></a>                <span class="at">n.chains           =</span> <span class="dv">3</span>,</span>
<span id="cb631-48"><a href="generalized-linear-models.html#cb631-48" aria-hidden="true" tabindex="-1"></a>                <span class="at">n.iter             =</span> <span class="fl">5E4</span>,</span>
<span id="cb631-49"><a href="generalized-linear-models.html#cb631-49" aria-hidden="true" tabindex="-1"></a>                <span class="at">n.thin             =</span> <span class="dv">5</span>)</span></code></pre></div>
<p>For some reason this works without specifying initial values for <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> (now both vectors). Maybe the initial values are drawn from the prior?</p>
<p>In any case, let’s have a look at the summary statistics and visualize the fit:</p>
<div class="sourceCode" id="cb632"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb632-1"><a href="generalized-linear-models.html#cb632-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(jagsfit)</span></code></pre></div>
<pre><code>## Inference for Bugs model at &quot;C:/Users/krgross/AppData/Local/Temp/RtmpGiLYNj/model29e44e0d65ed.txt&quot;, fit using jags,
##  3 chains, each with 50000 iterations (first 25000 discarded), n.thin = 5
##  n.sims = 15000 iterations saved
##          mu.vect sd.vect   2.5%    25%    50%    75%  97.5%  Rhat n.eff
## a[1]      -1.141   0.290 -1.720 -1.320 -1.135 -0.963 -0.577 1.001 13000
## a[2]      -0.735   0.282 -1.295 -0.908 -0.733 -0.559 -0.185 1.001 15000
## b.diff     0.028   0.008  0.012  0.022  0.028  0.033  0.044 1.001 15000
## b[1]       0.019   0.009  0.002  0.013  0.019  0.024  0.036 1.001  6800
## b[2]      -0.009   0.009 -0.026 -0.015 -0.009 -0.004  0.008 1.001  9700
## sd_L       0.249   0.147  0.080  0.151  0.215  0.306  0.620 1.002  2200
## deviance  75.258   4.136 68.632 72.242 74.782 77.723 84.621 1.002  2700
## 
## For each parameter, n.eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor (at convergence, Rhat=1).
## 
## DIC info (using the rule, pD = var(deviance)/2)
## pD = 8.5 and DIC = 83.8
## DIC is an estimate of expected predictive error (lower deviance is better).</code></pre>
<div class="sourceCode" id="cb634"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb634-1"><a href="generalized-linear-models.html#cb634-1" aria-hidden="true" tabindex="-1"></a>inv.logit <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">exp</span>(x) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(x))</span>
<span id="cb634-2"><a href="generalized-linear-models.html#cb634-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-3"><a href="generalized-linear-models.html#cb634-3" aria-hidden="true" tabindex="-1"></a>mcmc.output <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(jagsfit<span class="sc">$</span>BUGSoutput<span class="sc">$</span>sims.list)</span>
<span id="cb634-4"><a href="generalized-linear-models.html#cb634-4" aria-hidden="true" tabindex="-1"></a>post.mean   <span class="ot">&lt;-</span> <span class="fu">apply</span>(mcmc.output, <span class="dv">2</span>, mean)</span>
<span id="cb634-5"><a href="generalized-linear-models.html#cb634-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-6"><a href="generalized-linear-models.html#cb634-6" aria-hidden="true" tabindex="-1"></a>subset.samples <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(mcmc.output), <span class="at">size =</span> <span class="dv">100</span>)</span>
<span id="cb634-7"><a href="generalized-linear-models.html#cb634-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-8"><a href="generalized-linear-models.html#cb634-8" aria-hidden="true" tabindex="-1"></a>moth<span class="sc">$</span>prop.removed <span class="ot">&lt;-</span> <span class="fu">with</span>(moth, removed <span class="sc">/</span> placed)</span>
<span id="cb634-9"><a href="generalized-linear-models.html#cb634-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-10"><a href="generalized-linear-models.html#cb634-10" aria-hidden="true" tabindex="-1"></a>light <span class="ot">&lt;-</span> <span class="fu">subset</span>(moth, morph <span class="sc">==</span> <span class="st">&quot;light&quot;</span>)</span>
<span id="cb634-11"><a href="generalized-linear-models.html#cb634-11" aria-hidden="true" tabindex="-1"></a>dark  <span class="ot">&lt;-</span> <span class="fu">subset</span>(moth, morph <span class="sc">==</span> <span class="st">&quot;dark&quot;</span>)</span>
<span id="cb634-12"><a href="generalized-linear-models.html#cb634-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-13"><a href="generalized-linear-models.html#cb634-13" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb634-14"><a href="generalized-linear-models.html#cb634-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-15"><a href="generalized-linear-models.html#cb634-15" aria-hidden="true" tabindex="-1"></a><span class="co">#------ light morph</span></span>
<span id="cb634-16"><a href="generalized-linear-models.html#cb634-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-17"><a href="generalized-linear-models.html#cb634-17" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(prop.removed <span class="sc">~</span> distance, </span>
<span id="cb634-18"><a href="generalized-linear-models.html#cb634-18" aria-hidden="true" tabindex="-1"></a>     <span class="at">data =</span> moth, </span>
<span id="cb634-19"><a href="generalized-linear-models.html#cb634-19" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">&quot;n&quot;</span>, </span>
<span id="cb634-20"><a href="generalized-linear-models.html#cb634-20" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Light morph&quot;</span>,</span>
<span id="cb634-21"><a href="generalized-linear-models.html#cb634-21" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;proprotion removed&quot;</span>)</span>
<span id="cb634-22"><a href="generalized-linear-models.html#cb634-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-23"><a href="generalized-linear-models.html#cb634-23" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="at">x =</span> light<span class="sc">$</span>distance, <span class="at">y =</span> light<span class="sc">$</span>prop.removed, <span class="at">pch =</span> <span class="dv">16</span>)</span>
<span id="cb634-24"><a href="generalized-linear-models.html#cb634-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-25"><a href="generalized-linear-models.html#cb634-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> subset.samples) {</span>
<span id="cb634-26"><a href="generalized-linear-models.html#cb634-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb634-27"><a href="generalized-linear-models.html#cb634-27" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;-</span> mcmc.output<span class="sc">$</span>a<span class="fl">.2</span>[i]</span>
<span id="cb634-28"><a href="generalized-linear-models.html#cb634-28" aria-hidden="true" tabindex="-1"></a>  b <span class="ot">&lt;-</span> mcmc.output<span class="sc">$</span>b<span class="fl">.2</span>[i]</span>
<span id="cb634-29"><a href="generalized-linear-models.html#cb634-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb634-30"><a href="generalized-linear-models.html#cb634-30" aria-hidden="true" tabindex="-1"></a>  fitted.curve <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">inv.logit</span>(a <span class="sc">+</span> b <span class="sc">*</span> x)</span>
<span id="cb634-31"><a href="generalized-linear-models.html#cb634-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb634-32"><a href="generalized-linear-models.html#cb634-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">curve</span>(fitted.curve,</span>
<span id="cb634-33"><a href="generalized-linear-models.html#cb634-33" aria-hidden="true" tabindex="-1"></a>        <span class="at">from =</span> <span class="fu">min</span>(moth<span class="sc">$</span>distance),</span>
<span id="cb634-34"><a href="generalized-linear-models.html#cb634-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">to   =</span> <span class="fu">max</span>(moth<span class="sc">$</span>distance),</span>
<span id="cb634-35"><a href="generalized-linear-models.html#cb634-35" aria-hidden="true" tabindex="-1"></a>        <span class="at">add  =</span> <span class="cn">TRUE</span>,</span>
<span id="cb634-36"><a href="generalized-linear-models.html#cb634-36" aria-hidden="true" tabindex="-1"></a>        <span class="at">col  =</span> <span class="st">&quot;deepskyblue&quot;</span>)</span>
<span id="cb634-37"><a href="generalized-linear-models.html#cb634-37" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb634-38"><a href="generalized-linear-models.html#cb634-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-39"><a href="generalized-linear-models.html#cb634-39" aria-hidden="true" tabindex="-1"></a>fitted.mean.curve <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">inv.logit</span>(post.mean[<span class="st">&#39;a.2&#39;</span>] <span class="sc">+</span> post.mean[<span class="st">&#39;b.2&#39;</span>] <span class="sc">*</span> x)</span>
<span id="cb634-40"><a href="generalized-linear-models.html#cb634-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-41"><a href="generalized-linear-models.html#cb634-41" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(fitted.mean.curve,</span>
<span id="cb634-42"><a href="generalized-linear-models.html#cb634-42" aria-hidden="true" tabindex="-1"></a>        <span class="at">from =</span> <span class="fu">min</span>(moth<span class="sc">$</span>distance),</span>
<span id="cb634-43"><a href="generalized-linear-models.html#cb634-43" aria-hidden="true" tabindex="-1"></a>        <span class="at">to   =</span> <span class="fu">max</span>(moth<span class="sc">$</span>distance),</span>
<span id="cb634-44"><a href="generalized-linear-models.html#cb634-44" aria-hidden="true" tabindex="-1"></a>        <span class="at">add  =</span> <span class="cn">TRUE</span>,</span>
<span id="cb634-45"><a href="generalized-linear-models.html#cb634-45" aria-hidden="true" tabindex="-1"></a>        <span class="at">col  =</span> <span class="st">&quot;darkblue&quot;</span>,</span>
<span id="cb634-46"><a href="generalized-linear-models.html#cb634-46" aria-hidden="true" tabindex="-1"></a>        <span class="at">lwd  =</span> <span class="dv">2</span>)</span>
<span id="cb634-47"><a href="generalized-linear-models.html#cb634-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-48"><a href="generalized-linear-models.html#cb634-48" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="at">x =</span> light<span class="sc">$</span>distance, <span class="at">y =</span> light<span class="sc">$</span>prop.removed, <span class="at">pch =</span> <span class="dv">16</span>)</span>
<span id="cb634-49"><a href="generalized-linear-models.html#cb634-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-50"><a href="generalized-linear-models.html#cb634-50" aria-hidden="true" tabindex="-1"></a><span class="co">#--------- dark morph </span></span>
<span id="cb634-51"><a href="generalized-linear-models.html#cb634-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-52"><a href="generalized-linear-models.html#cb634-52" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(prop.removed <span class="sc">~</span> distance, </span>
<span id="cb634-53"><a href="generalized-linear-models.html#cb634-53" aria-hidden="true" tabindex="-1"></a>     <span class="at">data =</span> moth, </span>
<span id="cb634-54"><a href="generalized-linear-models.html#cb634-54" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">&quot;n&quot;</span>, </span>
<span id="cb634-55"><a href="generalized-linear-models.html#cb634-55" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Dark morph&quot;</span>,</span>
<span id="cb634-56"><a href="generalized-linear-models.html#cb634-56" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;proprotion removed&quot;</span>)</span>
<span id="cb634-57"><a href="generalized-linear-models.html#cb634-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-58"><a href="generalized-linear-models.html#cb634-58" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> subset.samples) {</span>
<span id="cb634-59"><a href="generalized-linear-models.html#cb634-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb634-60"><a href="generalized-linear-models.html#cb634-60" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;-</span> mcmc.output<span class="sc">$</span>a<span class="fl">.1</span>[i]</span>
<span id="cb634-61"><a href="generalized-linear-models.html#cb634-61" aria-hidden="true" tabindex="-1"></a>  b <span class="ot">&lt;-</span> mcmc.output<span class="sc">$</span>b<span class="fl">.1</span>[i]</span>
<span id="cb634-62"><a href="generalized-linear-models.html#cb634-62" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb634-63"><a href="generalized-linear-models.html#cb634-63" aria-hidden="true" tabindex="-1"></a>  fitted.curve <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">inv.logit</span>(a <span class="sc">+</span> b <span class="sc">*</span> x)</span>
<span id="cb634-64"><a href="generalized-linear-models.html#cb634-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb634-65"><a href="generalized-linear-models.html#cb634-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">curve</span>(fitted.curve,</span>
<span id="cb634-66"><a href="generalized-linear-models.html#cb634-66" aria-hidden="true" tabindex="-1"></a>        <span class="at">from =</span> <span class="fu">min</span>(moth<span class="sc">$</span>distance),</span>
<span id="cb634-67"><a href="generalized-linear-models.html#cb634-67" aria-hidden="true" tabindex="-1"></a>        <span class="at">to   =</span> <span class="fu">max</span>(moth<span class="sc">$</span>distance),</span>
<span id="cb634-68"><a href="generalized-linear-models.html#cb634-68" aria-hidden="true" tabindex="-1"></a>        <span class="at">add  =</span> <span class="cn">TRUE</span>,</span>
<span id="cb634-69"><a href="generalized-linear-models.html#cb634-69" aria-hidden="true" tabindex="-1"></a>        <span class="at">col  =</span> <span class="st">&quot;deepskyblue&quot;</span>)</span>
<span id="cb634-70"><a href="generalized-linear-models.html#cb634-70" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb634-71"><a href="generalized-linear-models.html#cb634-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-72"><a href="generalized-linear-models.html#cb634-72" aria-hidden="true" tabindex="-1"></a>fitted.mean.curve <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">inv.logit</span>(post.mean[<span class="st">&#39;a.1&#39;</span>] <span class="sc">+</span> post.mean[<span class="st">&#39;b.1&#39;</span>] <span class="sc">*</span> x)</span>
<span id="cb634-73"><a href="generalized-linear-models.html#cb634-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-74"><a href="generalized-linear-models.html#cb634-74" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(fitted.mean.curve,</span>
<span id="cb634-75"><a href="generalized-linear-models.html#cb634-75" aria-hidden="true" tabindex="-1"></a>        <span class="at">from =</span> <span class="fu">min</span>(moth<span class="sc">$</span>distance),</span>
<span id="cb634-76"><a href="generalized-linear-models.html#cb634-76" aria-hidden="true" tabindex="-1"></a>        <span class="at">to   =</span> <span class="fu">max</span>(moth<span class="sc">$</span>distance),</span>
<span id="cb634-77"><a href="generalized-linear-models.html#cb634-77" aria-hidden="true" tabindex="-1"></a>        <span class="at">add  =</span> <span class="cn">TRUE</span>,</span>
<span id="cb634-78"><a href="generalized-linear-models.html#cb634-78" aria-hidden="true" tabindex="-1"></a>        <span class="at">col  =</span> <span class="st">&quot;darkblue&quot;</span>,</span>
<span id="cb634-79"><a href="generalized-linear-models.html#cb634-79" aria-hidden="true" tabindex="-1"></a>        <span class="at">lwd  =</span> <span class="dv">2</span>)</span>
<span id="cb634-80"><a href="generalized-linear-models.html#cb634-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-81"><a href="generalized-linear-models.html#cb634-81" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="at">x =</span> dark<span class="sc">$</span>distance, <span class="at">y =</span> dark<span class="sc">$</span>prop.removed, <span class="at">pch =</span> <span class="dv">16</span>)</span></code></pre></div>
<p><img src="07-GeneralizedLinearModels_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
<p>More salient is the posterior of the difference between the two slopes (on the logit scale).</p>
<div class="sourceCode" id="cb635"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb635-1"><a href="generalized-linear-models.html#cb635-1" aria-hidden="true" tabindex="-1"></a>bayesplot<span class="sc">::</span><span class="fu">mcmc_areas</span>(mcmc.output,</span>
<span id="cb635-2"><a href="generalized-linear-models.html#cb635-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">&quot;b.diff&quot;</span>),</span>
<span id="cb635-3"><a href="generalized-linear-models.html#cb635-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">prob =</span> <span class="fl">0.95</span>) </span></code></pre></div>
<p><img src="07-GeneralizedLinearModels_files/figure-html/unnamed-chunk-38-1.png" width="672" /></p>
<div class="sourceCode" id="cb636"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb636-1"><a href="generalized-linear-models.html#cb636-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(mcmc.output<span class="sc">$</span>b.diff <span class="sc">&gt;</span> <span class="dv">0</span>)</span></code></pre></div>
<pre><code>## 
## FALSE  TRUE 
##     4 14996</code></pre>
<p>Thus we would say that there is a 14993 / 15000 = 0.9995 posterior probability that the proportion of dark moths removed increases more rapidly with increasing distance from Liverpool than the proportion of light moths removed.</p>
<!-- We have already mentioned that the $t$-statistics reported in `summary.glm` are based on standard errors calculated from the curvature (Hessian) of the negative log-likelihood at the MLEs, with df determined by the df available for the residual deviance.  An alternative approach for testing for the significance of model terms is to use the residual deviance to compare nested models, much as one would use $F$-tests to compare nested models in ordinary least squares.  Here is a bit of theory.  Let $D$ denote the residual deviance for a model.  Suppose we are comparing two nested models: a parameter poor model that we call model 0, and a parameter rich model that we call model 1.  The parameter-rich model nests the parameter poor model.  Let $p_0$ and $p_1$ be the number of estimated parameters in the linear predictor of models 0 and 1, respectively, and let $D_0$ and $D_1$ denote the (residual) deviances of both models.  In the usual way, we wish to test whether or not the parameter-rich model provides a statistically significant improvement in fit over the parameter-poor model. -->
<!-- There are two separate approaches here depending on whether the scale parameter is known, or is estimated from the data.  If the scale parameter is known to be $\phi$, then define the scaled deviance as $D^* = D / \phi$.  The LRT to compare the two models is equal to the drop in the scaled deviance, $D^*_0 - D^*_1$.  Under the null hypothesis that the parameter-poor model generated the data, the test statistic has a $\chi^2$ distribution with $p_1 - p_0$ degrees of freedom. -->
<!-- If the scale parameter is estimated from the data, then we work with the (residual) deviances directly.  In this case, we calculate the $F$-statistic -->
<!-- $$ -->
<!-- F = \frac{(D_0 - D_1)/(p_1 - p_0)}{D_1 / (n - p_1)}. -->
<!-- $$ -->
<!-- Note that this is generalization of the usual $F$-statistic for comparing nested models from OLS.  Under the null hypothesis, the test statistic has an $F_{p_1 - p_0, n - p_1}$ distribution. -->
<!-- # test for interaction between distance and morph -->
<!-- ```{r} -->
<!-- fm2q <- glm(cbind(removed, placed - removed) ~ morph + distance,  -->
<!--             family = quasibinomial(link = "logit"), -->
<!--             data = moth) -->
<!-- anova(fm2q, fm1q, test = "F") -->
<!-- ``` -->

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="hierarchical-models.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
