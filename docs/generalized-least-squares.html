<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Generalized Least Squares | BMA / ST 590 computing companion</title>
  <meta name="description" content="This is a proto-textbook for BMA / ST 590, Statistical Modeling in Ecology, taught at NCSU in Fall 2023." />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Generalized Least Squares | BMA / ST 590 computing companion" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is a proto-textbook for BMA / ST 590, Statistical Modeling in Ecology, taught at NCSU in Fall 2023." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Generalized Least Squares | BMA / ST 590 computing companion" />
  
  <meta name="twitter:description" content="This is a proto-textbook for BMA / ST 590, Statistical Modeling in Ecology, taught at NCSU in Fall 2023." />
  

<meta name="author" content="Kevin Gross" />


<meta name="date" content="2023-09-06" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="smooth-regression.html"/>
<link rel="next" href="hierarchical-mixed-models.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.10.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Maximum likelihood estimation</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#mathematical-basics"><i class="fa fa-check"></i><b>1.1</b> Mathematical basics</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#horse-kick-data"><i class="fa fa-check"></i><b>1.2</b> Horse-kick data</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="index.html"><a href="index.html#calculate-and-plot-the-log-likelihood-function"><i class="fa fa-check"></i><b>1.2.1</b> Calculate and plot the log-likelihood function</a></li>
<li class="chapter" data-level="1.2.2" data-path="index.html"><a href="index.html#find-the-mle-numerically-using-optimize"><i class="fa fa-check"></i><b>1.2.2</b> Find the MLE numerically using ‘optimize’</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#pulse-rate-data"><i class="fa fa-check"></i><b>1.3</b> Pulse rate data</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#tadpole-data"><i class="fa fa-check"></i><b>1.4</b> Tadpole data</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#transformable-constraints"><i class="fa fa-check"></i><b>1.5</b> Transformable constraints</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html"><i class="fa fa-check"></i><b>2</b> Beyond the MLE: Confidence regions and hypothesis tests using the likelihood function</a>
<ul>
<li class="chapter" data-level="2.1" data-path="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#confidence-intervals-for-single-parameters"><i class="fa fa-check"></i><b>2.1</b> Confidence intervals for single parameters</a></li>
<li class="chapter" data-level="2.2" data-path="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#two-param-mle"><i class="fa fa-check"></i><b>2.2</b> Confidence regions, profile likelihoods, and associated univariate intervals</a></li>
<li class="chapter" data-level="2.3" data-path="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#locally-quadratic-approximations-to-confidence-intervals-and-regions"><i class="fa fa-check"></i><b>2.3</b> Locally quadratic approximations to confidence intervals and regions</a></li>
<li class="chapter" data-level="2.4" data-path="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#comparing-models-likelihood-ratio-test-and-aic"><i class="fa fa-check"></i><b>2.4</b> Comparing models: Likelihood ratio test and AIC</a></li>
<li class="chapter" data-level="2.5" data-path="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#the-negative-binomial-distriution-revisited"><i class="fa fa-check"></i><b>2.5</b> The negative binomial distriution, revisited</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="bayesian-computation.html"><a href="bayesian-computation.html"><i class="fa fa-check"></i><b>3</b> Bayesian computation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="bayesian-computation.html"><a href="bayesian-computation.html#computations-with-conjugate-priors"><i class="fa fa-check"></i><b>3.1</b> Computations with conjugate priors</a></li>
<li class="chapter" data-level="3.2" data-path="bayesian-computation.html"><a href="bayesian-computation.html#jags-in-r"><i class="fa fa-check"></i><b>3.2</b> JAGS in R</a></li>
<li class="chapter" data-level="3.3" data-path="bayesian-computation.html"><a href="bayesian-computation.html#rstanarm"><i class="fa fa-check"></i><b>3.3</b> rstanarm</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="smooth-regression.html"><a href="smooth-regression.html"><i class="fa fa-check"></i><b>4</b> Smooth regression</a>
<ul>
<li class="chapter" data-level="4.1" data-path="smooth-regression.html"><a href="smooth-regression.html#loess-smoothers"><i class="fa fa-check"></i><b>4.1</b> Loess smoothers</a></li>
<li class="chapter" data-level="4.2" data-path="smooth-regression.html"><a href="smooth-regression.html#splines"><i class="fa fa-check"></i><b>4.2</b> Splines</a></li>
<li class="chapter" data-level="4.3" data-path="smooth-regression.html"><a href="smooth-regression.html#generalized-additive-models-gams"><i class="fa fa-check"></i><b>4.3</b> Generalized additive models (GAMs)</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="generalized-least-squares.html"><a href="generalized-least-squares.html"><i class="fa fa-check"></i><b>5</b> Generalized Least Squares</a>
<ul>
<li class="chapter" data-level="5.1" data-path="generalized-least-squares.html"><a href="generalized-least-squares.html#heterogeneous-variance"><i class="fa fa-check"></i><b>5.1</b> Heterogeneous variance</a></li>
<li class="chapter" data-level="5.2" data-path="generalized-least-squares.html"><a href="generalized-least-squares.html#temporal-serial-correlation"><i class="fa fa-check"></i><b>5.2</b> Temporal (serial) correlation</a></li>
<li class="chapter" data-level="5.3" data-path="generalized-least-squares.html"><a href="generalized-least-squares.html#spatial-data"><i class="fa fa-check"></i><b>5.3</b> Spatial data</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="hierarchical-mixed-models.html"><a href="hierarchical-mixed-models.html"><i class="fa fa-check"></i><b>6</b> Hierarchical (mixed) models</a>
<ul>
<li class="chapter" data-level="6.1" data-path="hierarchical-mixed-models.html"><a href="hierarchical-mixed-models.html#one-factor-layout-dyestuff-data"><i class="fa fa-check"></i><b>6.1</b> One-factor layout: Dyestuff data</a></li>
<li class="chapter" data-level="6.2" data-path="hierarchical-mixed-models.html"><a href="hierarchical-mixed-models.html#bayesian-analysis"><i class="fa fa-check"></i><b>6.2</b> Bayesian analysis</a></li>
<li class="chapter" data-level="6.3" data-path="hierarchical-mixed-models.html"><a href="hierarchical-mixed-models.html#negative-within-group-correlations"><i class="fa fa-check"></i><b>6.3</b> Negative within-group correlations</a></li>
<li class="chapter" data-level="6.4" data-path="hierarchical-mixed-models.html"><a href="hierarchical-mixed-models.html#random-coefficient-models-rikz-data"><i class="fa fa-check"></i><b>6.4</b> Random coefficient models: RIKZ data</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="hierarchical-mixed-models.html"><a href="hierarchical-mixed-models.html#analysis-without-beach-level-covariate"><i class="fa fa-check"></i><b>6.4.1</b> Analysis without beach-level covariate</a></li>
<li class="chapter" data-level="6.4.2" data-path="hierarchical-mixed-models.html"><a href="hierarchical-mixed-models.html#adding-a-beach-level-covariate"><i class="fa fa-check"></i><b>6.4.2</b> Adding a beach-level covariate</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="hierarchical-mixed-models.html"><a href="hierarchical-mixed-models.html#nested-and-crossed-random-effects"><i class="fa fa-check"></i><b>6.5</b> Nested and crossed random effects</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="hierarchical-mixed-models.html"><a href="hierarchical-mixed-models.html#nested-random-effects"><i class="fa fa-check"></i><b>6.5.1</b> Nested random effects</a></li>
<li class="chapter" data-level="6.5.2" data-path="hierarchical-mixed-models.html"><a href="hierarchical-mixed-models.html#crossed-random-effects"><i class="fa fa-check"></i><b>6.5.2</b> Crossed random effects</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html"><i class="fa fa-check"></i><b>7</b> Generalized linear models</a>
<ul>
<li class="chapter" data-level="7.1" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#poisson-regression"><i class="fa fa-check"></i><b>7.1</b> Poisson regression</a></li>
<li class="chapter" data-level="7.2" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#bayesian-interlude"><i class="fa fa-check"></i><b>7.2</b> Bayesian interlude</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#rstanarm-1"><i class="fa fa-check"></i><b>7.2.1</b> rstanarm</a></li>
<li class="chapter" data-level="7.2.2" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#posterior-predictive-checks"><i class="fa fa-check"></i><b>7.2.2</b> Posterior predictive checks</a></li>
<li class="chapter" data-level="7.2.3" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#jags"><i class="fa fa-check"></i><b>7.2.3</b> JAGS</a></li>
<li class="chapter" data-level="7.2.4" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#observation-level-random-effects"><i class="fa fa-check"></i><b>7.2.4</b> Observation-level random effects</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#binary-responses"><i class="fa fa-check"></i><b>7.3</b> Binary responses</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#individual-binary-responses-tb-in-boar"><i class="fa fa-check"></i><b>7.3.1</b> Individual binary responses: TB in boar</a></li>
<li class="chapter" data-level="7.3.2" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#grouped-binary-data-industrial-melanism"><i class="fa fa-check"></i><b>7.3.2</b> Grouped binary data: Industrial melanism</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#zero-adjusted-models-for-count-data"><i class="fa fa-check"></i><b>7.4</b> Zero-adjusted models for count data</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#zero-truncated-models"><i class="fa fa-check"></i><b>7.4.1</b> Zero-truncated models</a></li>
<li class="chapter" data-level="7.4.2" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#zero-inflated-models"><i class="fa fa-check"></i><b>7.4.2</b> Zero-inflated models</a></li>
<li class="chapter" data-level="7.4.3" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#zero-altered-or-hurdle-models"><i class="fa fa-check"></i><b>7.4.3</b> Zero-altered, or “hurdle”, models</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#generalized-additive-models-gams-1"><i class="fa fa-check"></i><b>7.5</b> Generalized additive models (GAMs)</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="generalized-linear-mixed-models.html"><a href="generalized-linear-mixed-models.html"><i class="fa fa-check"></i><b>8</b> Generalized linear mixed models</a>
<ul>
<li class="chapter" data-level="8.1" data-path="generalized-linear-mixed-models.html"><a href="generalized-linear-mixed-models.html#example-1-industrial-melanism-data"><i class="fa fa-check"></i><b>8.1</b> Example 1: Industrial melanism data</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="generalized-linear-mixed-models.html"><a href="generalized-linear-mixed-models.html#gees"><i class="fa fa-check"></i><b>8.1.1</b> GEEs</a></li>
<li class="chapter" data-level="8.1.2" data-path="generalized-linear-mixed-models.html"><a href="generalized-linear-mixed-models.html#glmms"><i class="fa fa-check"></i><b>8.1.2</b> GLMMs</a></li>
<li class="chapter" data-level="8.1.3" data-path="generalized-linear-mixed-models.html"><a href="generalized-linear-mixed-models.html#bayesian-fit"><i class="fa fa-check"></i><b>8.1.3</b> Bayesian fit</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="generalized-linear-mixed-models.html"><a href="generalized-linear-mixed-models.html#example-2-ticks-on-red-grouse"><i class="fa fa-check"></i><b>8.2</b> Example 2: Ticks on red grouse</a></li>
<li class="chapter" data-level="8.3" data-path="generalized-linear-mixed-models.html"><a href="generalized-linear-mixed-models.html#gamms"><i class="fa fa-check"></i><b>8.3</b> GAMMs</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="bibliography.html"><a href="bibliography.html"><i class="fa fa-check"></i>Bibliography</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">BMA / ST 590 computing companion</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="generalized-least-squares" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">Chapter 5</span> Generalized Least Squares<a href="generalized-least-squares.html#generalized-least-squares" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="heterogeneous-variance" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> Heterogeneous variance<a href="generalized-least-squares.html#heterogeneous-variance" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We will illustrate generalized least squares (GLS) using a data set that gives the percentage of male births for four countries (Canada, Denmark, the Netherlands, and the US) for several decades in the late twentieth century. The data were originally reported in Davis et al., JAMA 279:1018–1023 (1998). The data set that we will work with was scraped from this publication by Ramsey and Schafer for their book “The Statistical Sleuth” (2e, 2002). The data can be found as the data set ‘ex0726’ in the r library ‘sleuth2’. We will begin by reading the data and performing some housekeeping.</p>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="generalized-least-squares.html#cb308-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--------------------</span></span>
<span id="cb308-2"><a href="generalized-least-squares.html#cb308-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Ex 07.26 from the Statistical Sleuth, 2e</span></span>
<span id="cb308-3"><a href="generalized-least-squares.html#cb308-3" aria-hidden="true" tabindex="-1"></a><span class="co">#--------------------</span></span>
<span id="cb308-4"><a href="generalized-least-squares.html#cb308-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-5"><a href="generalized-least-squares.html#cb308-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Sleuth2)</span>
<span id="cb308-6"><a href="generalized-least-squares.html#cb308-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-7"><a href="generalized-least-squares.html#cb308-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(ex0726)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    45 obs. of  5 variables:
##  $ Year       : num  1950 1951 1952 1953 1954 ...
##  $ Denmark    : num  0.512 0.517 0.515 0.517 0.515 ...
##  $ Netherlands: num  0.516 0.516 0.516 0.516 0.516 ...
##  $ Canada     : num  NaN NaN NaN NaN NaN NaN NaN NaN NaN NaN ...
##  $ Usa        : num  NaN NaN NaN NaN NaN NaN NaN NaN NaN NaN ...</code></pre>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="generalized-least-squares.html#cb310-1" aria-hidden="true" tabindex="-1"></a>births <span class="ot">&lt;-</span> ex0726</span>
<span id="cb310-2"><a href="generalized-least-squares.html#cb310-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb310-3"><a href="generalized-least-squares.html#cb310-3" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(reshape2)</span></code></pre></div>
<pre><code>## Loading required package: reshape2</code></pre>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="generalized-least-squares.html#cb312-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(births) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;DK&quot;</span>, <span class="st">&quot;NL&quot;</span>, <span class="st">&quot;CA&quot;</span>, <span class="st">&quot;US&quot;</span>)</span>
<span id="cb312-2"><a href="generalized-least-squares.html#cb312-2" aria-hidden="true" tabindex="-1"></a>births.melt <span class="ot">&lt;-</span> <span class="fu">melt</span>(births, <span class="at">id.vars =</span> <span class="fu">c</span>(<span class="st">&quot;year&quot;</span>))</span>
<span id="cb312-3"><a href="generalized-least-squares.html#cb312-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb312-4"><a href="generalized-least-squares.html#cb312-4" aria-hidden="true" tabindex="-1"></a>births <span class="ot">&lt;-</span> births.melt</span>
<span id="cb312-5"><a href="generalized-least-squares.html#cb312-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(births.melt)</span>
<span id="cb312-6"><a href="generalized-least-squares.html#cb312-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb312-7"><a href="generalized-least-squares.html#cb312-7" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(births) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;country&quot;</span>, <span class="st">&quot;pct.male&quot;</span>)</span>
<span id="cb312-8"><a href="generalized-least-squares.html#cb312-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb312-9"><a href="generalized-least-squares.html#cb312-9" aria-hidden="true" tabindex="-1"></a>births<span class="sc">$</span>pct.male <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="sc">*</span> births<span class="sc">$</span>pct.male</span></code></pre></div>
<p>We will focus only on the years 1970 – 1990, for which data are available for all countries:</p>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="generalized-least-squares.html#cb313-1" aria-hidden="true" tabindex="-1"></a>births <span class="ot">&lt;-</span> <span class="fu">subset</span>(births, year <span class="sc">&gt;=</span> <span class="dv">1970</span> <span class="sc">&amp;</span> year <span class="sc">&lt;=</span> <span class="dv">1990</span>)</span>
<span id="cb313-2"><a href="generalized-least-squares.html#cb313-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(births)</span></code></pre></div>
<pre><code>##       year      country    pct.male    
##  Min.   :1970   DK:21   Min.   :50.87  
##  1st Qu.:1975   NL:21   1st Qu.:51.22  
##  Median :1980   CA:21   Median :51.28  
##  Mean   :1980   US:21   Mean   :51.30  
##  3rd Qu.:1985           3rd Qu.:51.38  
##  Max.   :1990           Max.   :51.73</code></pre>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="generalized-least-squares.html#cb315-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(births)</span></code></pre></div>
<pre><code>##    year country pct.male
## 21 1970      DK    51.40
## 22 1971      DK    51.70
## 23 1972      DK    51.26
## 24 1973      DK    51.33
## 25 1974      DK    51.27
## 26 1975      DK    51.08</code></pre>
<p>Let’s have a look at the time trends in percentage male births in each of the four countries:</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="generalized-least-squares.html#cb317-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="at">las =</span> <span class="dv">1</span>)</span>
<span id="cb317-2"><a href="generalized-least-squares.html#cb317-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb317-3"><a href="generalized-least-squares.html#cb317-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(births, <span class="fu">plot</span>(pct.male <span class="sc">~</span> year, <span class="at">type =</span> <span class="st">&quot;n&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;percent male&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Canada&quot;</span>))</span>
<span id="cb317-4"><a href="generalized-least-squares.html#cb317-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">subset</span>(births, country <span class="sc">==</span> <span class="st">&quot;CA&quot;</span>), <span class="fu">points</span>(pct.male <span class="sc">~</span> year))</span>
<span id="cb317-5"><a href="generalized-least-squares.html#cb317-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb317-6"><a href="generalized-least-squares.html#cb317-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(births, <span class="fu">plot</span>(pct.male <span class="sc">~</span> year, <span class="at">type =</span> <span class="st">&quot;n&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;percent male&quot;</span>, <span class="at">main =</span> <span class="st">&quot;USA&quot;</span>))</span>
<span id="cb317-7"><a href="generalized-least-squares.html#cb317-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">subset</span>(births, country <span class="sc">==</span> <span class="st">&quot;US&quot;</span>), <span class="fu">points</span>(pct.male <span class="sc">~</span> year))</span>
<span id="cb317-8"><a href="generalized-least-squares.html#cb317-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb317-9"><a href="generalized-least-squares.html#cb317-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(births, <span class="fu">plot</span>(pct.male <span class="sc">~</span> year, <span class="at">type =</span> <span class="st">&quot;n&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;percent male&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Denmark&quot;</span>))</span>
<span id="cb317-10"><a href="generalized-least-squares.html#cb317-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">subset</span>(births, country <span class="sc">==</span> <span class="st">&quot;DK&quot;</span>), <span class="fu">points</span>(pct.male <span class="sc">~</span> year))</span>
<span id="cb317-11"><a href="generalized-least-squares.html#cb317-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb317-12"><a href="generalized-least-squares.html#cb317-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(births, <span class="fu">plot</span>(pct.male <span class="sc">~</span> year, <span class="at">type =</span> <span class="st">&quot;n&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;percent male&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Netherlands&quot;</span>))</span>
<span id="cb317-13"><a href="generalized-least-squares.html#cb317-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">subset</span>(births, country <span class="sc">==</span> <span class="st">&quot;NL&quot;</span>), <span class="fu">points</span>(pct.male <span class="sc">~</span> year))</span></code></pre></div>
<p><img src="05-GeneralizedLeastSquares_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>For these data, we might want to ask: Is there evidence that the percentage of male births is changing through time? If so, does the rate of change differ among countries? Among continents?</p>
<p>These are the types of questions that we would usually address with a regression model. However, there’s a lot going on with these data that would cause us to question the appropriateness of the usual ordinary least squares (OLS) assumptions.</p>
<ol style="list-style-type: decimal">
<li><p>The responses are proportions. We know that when the response is a proportion, the variance in the response depends on the mean, with the variance decreasing as the mean approaches 0% or 100%, and obtaining its maximal value when the mean response is at 50%. For these data, however, all of the responses are sufficiently close to 50% that we don’t need to worry about heterogeneous variances that arise from the proportional nature of the response.</p></li>
<li><p>The variance of the response also depends inversely on the number of births. Evidently, this will be a major issue, because these countries differ substantially in the sizes of their populations. If we knew the number of births in each country in each year (in other words, if we knew the denominator of the each data point), then could account for these differences using grouped logistic regression. However, the data as we have them do not contain any information about the number of births that underlie each data point. So, we will need a different approach to deal with the heterogeneous variances among countries.</p></li>
<li><p>The data are time series. We will devote our attention to time-series data more fully later in the course. For now, it suffices to realize that time series data are typically autocorrelated. In other words, the residual errors for consecutive data points are often correlated (and usually positively correlated), and this correlation typically decays as the time between data points increases. For these data, it is less clear why the errors might be autocorrelated, but we want to allow for the possibility all the same.</p></li>
</ol>
<p>We’ll regress the percentage of male births on year and country. Following Zuur et al.’s good advice, we’ll begin with a model with richly specified fixed effects. In this case, that means country specific intercepts and slopes. In an equation, this model is
<span class="math display">\[\begin{equation}
y_{it} = a_i + b_i x_{it} + \varepsilon_{it}
\end{equation}\]</span>
where <span class="math inline">\(i = 1, \ldots, 4\)</span> is an index that distinguishes among the four countries, and <span class="math inline">\(t = 1, \ldots, 21\)</span> is an index that distinguishes among the 21 years. The response <span class="math inline">\(y_{it}\)</span> is the percentage of male births in country <span class="math inline">\(i\)</span> in year <span class="math inline">\(t\)</span>, <span class="math inline">\(x_{it}\)</span> is the year to which measurement <span class="math inline">\(y_{it}\)</span> corresponds, the <span class="math inline">\(a_i\)</span> are the country-specific intercepts, the <span class="math inline">\(b_i\)</span> are the country-specific slopes, and the <span class="math inline">\(\varepsilon_{it}\)</span>’s are the errors. To begin, we make the usual OLS assumption that the errors are iid, that is, <span class="math inline">\(\varepsilon_{it} \sim \mathcal{N}(0, \sigma^2)\)</span>.</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="generalized-least-squares.html#cb318-1" aria-hidden="true" tabindex="-1"></a>fm1 <span class="ot">&lt;-</span> <span class="fu">with</span>(births, <span class="fu">lm</span>(pct.male <span class="sc">~</span> year <span class="sc">*</span> country))</span>
<span id="cb318-2"><a href="generalized-least-squares.html#cb318-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fm1)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = pct.male ~ year * country)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.30707 -0.05931  0.00100  0.04787  0.35314 
## 
## Coefficients:
##                  Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)    49.6995238  9.0048249   5.519 4.53e-07 ***
## year            0.0008442  0.0045479   0.186   0.8532    
## countryNL      14.4252381 12.7347455   1.133   0.2609    
## countryCA      23.6790476 12.7347455   1.859   0.0668 .  
## countryUS      12.3090476 12.7347455   0.967   0.3368    
## year:countryNL -0.0073636  0.0064317  -1.145   0.2558    
## year:countryCA -0.0119610  0.0064317  -1.860   0.0668 .  
## year:countryUS -0.0062727  0.0064317  -0.975   0.3325    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.1262 on 76 degrees of freedom
## Multiple R-squared:  0.3052, Adjusted R-squared:  0.2412 
## F-statistic: 4.768 on 7 and 76 DF,  p-value: 0.0001753</code></pre>
<p>Inconveniently, the intercepts here refer to the percentage of male births extrapolated back to the year 1 BCE. That’s not very useful, so we’ll center the year predictor. Now, the predictor <span class="math inline">\(x_{it}\)</span> will refer to the number of years before or after 1980, and the intercepts will give the fitted percentage of male births in the year 1980.</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="generalized-least-squares.html#cb320-1" aria-hidden="true" tabindex="-1"></a>births<span class="sc">$</span>yr.ctr <span class="ot">&lt;-</span> births<span class="sc">$</span>year <span class="sc">-</span> <span class="dv">1980</span></span>
<span id="cb320-2"><a href="generalized-least-squares.html#cb320-2" aria-hidden="true" tabindex="-1"></a>fm1 <span class="ot">&lt;-</span> <span class="fu">with</span>(births, <span class="fu">lm</span>(pct.male <span class="sc">~</span> yr.ctr <span class="sc">*</span> country))</span>
<span id="cb320-3"><a href="generalized-least-squares.html#cb320-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fm1)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = pct.male ~ yr.ctr * country)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.30707 -0.05931  0.00100  0.04787  0.35314 
## 
## Coefficients:
##                    Estimate Std. Error  t value Pr(&gt;|t|)    
## (Intercept)      51.3709524  0.0275387 1865.408  &lt; 2e-16 ***
## yr.ctr            0.0008442  0.0045479    0.186  0.85324    
## countryNL        -0.1547619  0.0389456   -3.974  0.00016 ***
## countryCA        -0.0038095  0.0389456   -0.098  0.92234    
## countryUS        -0.1109524  0.0389456   -2.849  0.00564 ** 
## yr.ctr:countryNL -0.0073636  0.0064317   -1.145  0.25584    
## yr.ctr:countryCA -0.0119610  0.0064317   -1.860  0.06680 .  
## yr.ctr:countryUS -0.0062727  0.0064317   -0.975  0.33251    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.1262 on 76 degrees of freedom
## Multiple R-squared:  0.3052, Adjusted R-squared:  0.2412 
## F-statistic: 4.768 on 7 and 76 DF,  p-value: 0.0001753</code></pre>
<p>Let’s plot the percentage of male births vs. year for each country, and overlay the fit of regression lines. To make it easy to extract the country-specific slopes and intercepts, we’ll first re-fit the model without the global intercept:</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="generalized-least-squares.html#cb322-1" aria-hidden="true" tabindex="-1"></a>fm1a <span class="ot">&lt;-</span> <span class="fu">with</span>(births, <span class="fu">lm</span>(pct.male <span class="sc">~</span> country <span class="sc">+</span> yr.ctr<span class="sc">:</span>country<span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb322-2"><a href="generalized-least-squares.html#cb322-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fm1a)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = pct.male ~ country + yr.ctr:country - 1)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.30707 -0.05931  0.00100  0.04787  0.35314 
## 
## Coefficients:
##                    Estimate Std. Error  t value Pr(&gt;|t|)    
## countryDK        51.3709524  0.0275387 1865.408   &lt;2e-16 ***
## countryNL        51.2161905  0.0275387 1859.788   &lt;2e-16 ***
## countryCA        51.3671429  0.0275387 1865.270   &lt;2e-16 ***
## countryUS        51.2600000  0.0275387 1861.379   &lt;2e-16 ***
## countryDK:yr.ctr  0.0008442  0.0045479    0.186   0.8532    
## countryNL:yr.ctr -0.0065195  0.0045479   -1.434   0.1558    
## countryCA:yr.ctr -0.0111169  0.0045479   -2.444   0.0168 *  
## countryUS:yr.ctr -0.0054286  0.0045479   -1.194   0.2363    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.1262 on 76 degrees of freedom
## Multiple R-squared:      1,  Adjusted R-squared:      1 
## F-statistic: 1.735e+06 on 8 and 76 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>There’s probably a more elegant way to extract the slope and intercept, but we’ll use the crude approach for now.</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="generalized-least-squares.html#cb324-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="at">las =</span> <span class="dv">1</span>)</span>
<span id="cb324-2"><a href="generalized-least-squares.html#cb324-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb324-3"><a href="generalized-least-squares.html#cb324-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(births, <span class="fu">plot</span>(pct.male <span class="sc">~</span> year, <span class="at">type =</span> <span class="st">&quot;n&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;percent male&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Canada&quot;</span>))</span>
<span id="cb324-4"><a href="generalized-least-squares.html#cb324-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">subset</span>(births, country <span class="sc">==</span> <span class="st">&quot;CA&quot;</span>), <span class="fu">points</span>(pct.male <span class="sc">~</span> year))</span>
<span id="cb324-5"><a href="generalized-least-squares.html#cb324-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb324-6"><a href="generalized-least-squares.html#cb324-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">a =</span> <span class="fl">51.3671</span> <span class="sc">-</span> (<span class="sc">-</span><span class="fl">0.01112</span> <span class="sc">*</span> <span class="dv">1980</span>), <span class="at">b =</span> <span class="sc">-</span><span class="fl">0.01112</span>)</span>
<span id="cb324-7"><a href="generalized-least-squares.html#cb324-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb324-8"><a href="generalized-least-squares.html#cb324-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(births, <span class="fu">plot</span>(pct.male <span class="sc">~</span> year, <span class="at">type =</span> <span class="st">&quot;n&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;percent male&quot;</span>, <span class="at">main =</span> <span class="st">&quot;USA&quot;</span>))</span>
<span id="cb324-9"><a href="generalized-least-squares.html#cb324-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">subset</span>(births, country <span class="sc">==</span> <span class="st">&quot;US&quot;</span>), <span class="fu">points</span>(pct.male <span class="sc">~</span> year))</span>
<span id="cb324-10"><a href="generalized-least-squares.html#cb324-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb324-11"><a href="generalized-least-squares.html#cb324-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">a =</span> <span class="fl">51.26</span> <span class="sc">-</span> (<span class="sc">-</span><span class="fl">0.0054286</span> <span class="sc">*</span> <span class="dv">1980</span>), <span class="at">b =</span> <span class="sc">-</span><span class="fl">0.0054286</span>)</span>
<span id="cb324-12"><a href="generalized-least-squares.html#cb324-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb324-13"><a href="generalized-least-squares.html#cb324-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(births, <span class="fu">plot</span>(pct.male <span class="sc">~</span> year, <span class="at">type =</span> <span class="st">&quot;n&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;percent male&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Denmark&quot;</span>))</span>
<span id="cb324-14"><a href="generalized-least-squares.html#cb324-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">subset</span>(births, country <span class="sc">==</span> <span class="st">&quot;DK&quot;</span>), <span class="fu">points</span>(pct.male <span class="sc">~</span> year))</span>
<span id="cb324-15"><a href="generalized-least-squares.html#cb324-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb324-16"><a href="generalized-least-squares.html#cb324-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">a =</span> <span class="fl">51.3709</span> <span class="sc">-</span> (<span class="fl">0.0008442</span> <span class="sc">*</span> <span class="dv">1980</span>), <span class="at">b =</span> <span class="fl">0.0008442</span>)</span>
<span id="cb324-17"><a href="generalized-least-squares.html#cb324-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb324-18"><a href="generalized-least-squares.html#cb324-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(births, <span class="fu">plot</span>(pct.male <span class="sc">~</span> year, <span class="at">type =</span> <span class="st">&quot;n&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;percent male&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Netherlands&quot;</span>))</span>
<span id="cb324-19"><a href="generalized-least-squares.html#cb324-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">subset</span>(births, country <span class="sc">==</span> <span class="st">&quot;NL&quot;</span>), <span class="fu">points</span>(pct.male <span class="sc">~</span> year))</span>
<span id="cb324-20"><a href="generalized-least-squares.html#cb324-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb324-21"><a href="generalized-least-squares.html#cb324-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">a =</span> <span class="fl">51.2162</span> <span class="sc">-</span> (<span class="sc">-</span><span class="fl">0.00652</span> <span class="sc">*</span> <span class="dv">1980</span>), <span class="at">b =</span> <span class="sc">-</span><span class="fl">0.0065195</span>)</span></code></pre></div>
<p><img src="05-GeneralizedLeastSquares_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>We would like to draw inferences about the time and country effects. However, the error variance clearly differs among the countries, because of the different sizes of the countries’ populations. Thus, we can’t trust the usual inference procedures that assume iid errors.</p>
<p>We will cope by fitting a GLS model that allows the error variances to differ among the countries. The model equation is nearly the same as above:
<span class="math display">\[\begin{equation}
y_{it} = a_i + b_i x_{it} + \varepsilon_{it}.
\end{equation}\]</span>
The only difference is that now we assume that the variance of the errors differs among the countries: <span class="math inline">\(\varepsilon_{it} \sim \mathcal{N}(0, \sigma^2_i)\)</span>. This change looks trivial in the notation, but it’s an important change to the model!</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="generalized-least-squares.html#cb325-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(nlme)</span></code></pre></div>
<pre><code>## Loading required package: nlme</code></pre>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="generalized-least-squares.html#cb327-1" aria-hidden="true" tabindex="-1"></a>gls1 <span class="ot">&lt;-</span> <span class="fu">gls</span>(pct.male <span class="sc">~</span> yr.ctr <span class="sc">*</span> country, <span class="at">data =</span> births, <span class="at">weights =</span> <span class="fu">varIdent</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> country))</span>
<span id="cb327-2"><a href="generalized-least-squares.html#cb327-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(gls1)</span></code></pre></div>
<pre><code>## Generalized least squares fit by REML
##   Model: pct.male ~ yr.ctr * country 
##   Data: births 
##         AIC       BIC   logLik
##   -94.69995 -66.73115 59.34998
## 
## Variance function:
##  Structure: Different standard deviations per stratum
##  Formula: ~1 | country 
##  Parameter estimates:
##        DK        NL        CA        US 
## 1.0000000 0.7264997 0.3971728 0.1347962 
## 
## Coefficients:
##                     Value  Std.Error   t-value p-value
## (Intercept)      51.37095 0.04219635 1217.4264  0.0000
## yr.ctr            0.00084 0.00696850    0.1211  0.9039
## countryNL        -0.15476 0.05215650   -2.9673  0.0040
## countryCA        -0.00381 0.04540269   -0.0839  0.9334
## countryUS        -0.11095 0.04257798   -2.6059  0.0110
## yr.ctr:countryNL -0.00736 0.00861336   -0.8549  0.3953
## yr.ctr:countryCA -0.01196 0.00749801   -1.5952  0.1148
## yr.ctr:countryUS -0.00627 0.00703152   -0.8921  0.3752
## 
##  Correlation: 
##                  (Intr) yr.ctr cntrNL cntrCA cntrUS yr.:NL yr.:CA
## yr.ctr            0.000                                          
## countryNL        -0.809  0.000                                   
## countryCA        -0.929  0.000  0.752                            
## countryUS        -0.991  0.000  0.802  0.921                     
## yr.ctr:countryNL  0.000 -0.809  0.000  0.000  0.000              
## yr.ctr:countryCA  0.000 -0.929  0.000  0.000  0.000  0.752       
## yr.ctr:countryUS  0.000 -0.991  0.000  0.000  0.000  0.802  0.921
## 
## Standardized residuals:
##         Min          Q1         Med          Q3         Max 
## -2.18586069 -0.69331440 -0.01165266  0.66706364  1.82625135 
## 
## Residual standard error: 0.193368 
## Degrees of freedom: 84 total; 76 residual</code></pre>
<p>Notice that the model estimates separate error standard deviations for each country.</p>
<p>We would like to ask if model with country-specific variances provides a statistically significant improvement in fit relative to the model with homogeneous error variances. Here, it is crucial to remember that the default fitting scheme in <code>nlme::gls</code> is REML. However, because the models share the same fixed-effect structure, we can compare AIC values from the REML fits directly. Further, because the modes are nested, we can use the REML fits for a likelihood ratio test. The <code>anova.gls</code> command provides both.</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="generalized-least-squares.html#cb329-1" aria-hidden="true" tabindex="-1"></a>gls0 <span class="ot">&lt;-</span> <span class="fu">gls</span>(pct.male <span class="sc">~</span> yr.ctr <span class="sc">*</span> country, <span class="at">data =</span> births)  <span class="co"># OLS fit</span></span>
<span id="cb329-2"><a href="generalized-least-squares.html#cb329-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(gls0, gls1)</span></code></pre></div>
<pre><code>##      Model df       AIC       BIC   logLik   Test  L.Ratio p-value
## gls0     1  9 -42.18264 -21.20604 30.09132                        
## gls1     2 12 -94.69995 -66.73115 59.34998 1 vs 2 58.51731  &lt;.0001</code></pre>
<p>Both the LRT and the AIC suggest that the GLS model with country-specific variances provides a statistically significant improvement over the OLS model with homogeneous error variances.</p>
<p>If the fixed-effect structures had not been the same, it would not have been correct to compare the models using the REML fits. Instead, we would have to re-fit the models using ML. For the sake of illustration, let’s do this anyway, and see if and how the results differ.</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="generalized-least-squares.html#cb331-1" aria-hidden="true" tabindex="-1"></a>gls0ML <span class="ot">&lt;-</span> <span class="fu">gls</span>(pct.male <span class="sc">~</span> yr.ctr <span class="sc">*</span> country, <span class="at">data =</span> births, <span class="at">method =</span> <span class="st">&quot;ML&quot;</span>)</span>
<span id="cb331-2"><a href="generalized-least-squares.html#cb331-2" aria-hidden="true" tabindex="-1"></a>gls1ML <span class="ot">&lt;-</span> <span class="fu">gls</span>(pct.male <span class="sc">~</span> yr.ctr <span class="sc">*</span> country, <span class="at">data =</span> births, </span>
<span id="cb331-3"><a href="generalized-least-squares.html#cb331-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">weights =</span> <span class="fu">varIdent</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> country), <span class="at">method =</span> <span class="st">&quot;ML&quot;</span>)</span>
<span id="cb331-4"><a href="generalized-least-squares.html#cb331-4" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(gls0ML, gls1ML)</span></code></pre></div>
<pre><code>##        Model df        AIC        BIC   logLik   Test  L.Ratio p-value
## gls0ML     1  9  -99.76871  -77.89136 58.88435                        
## gls1ML     2 12 -158.44573 -129.27593 91.22287 1 vs 2 64.67702  &lt;.0001</code></pre>
<p>We obtain somewhat different numerical results based on the ML fit, even though the qualitative outcome of the test is unchanged (the model with country-specific variances is still strongly favored).</p>
<p>In any event, we can also compare the variance estimates from the ML fit to those from the REML fit.</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="generalized-least-squares.html#cb333-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(gls1ML)</span></code></pre></div>
<pre><code>## Generalized least squares fit by maximum likelihood
##   Model: pct.male ~ yr.ctr * country 
##   Data: births 
##         AIC       BIC   logLik
##   -158.4457 -129.2759 91.22287
## 
## Variance function:
##  Structure: Different standard deviations per stratum
##  Formula: ~1 | country 
##  Parameter estimates:
##        DK        NL        CA        US 
## 1.0000000 0.7264997 0.3971729 0.1347962 
## 
## Coefficients:
##                     Value  Std.Error   t-value p-value
## (Intercept)      51.37095 0.04219635 1217.4265  0.0000
## yr.ctr            0.00084 0.00696850    0.1211  0.9039
## countryNL        -0.15476 0.05215650   -2.9673  0.0040
## countryCA        -0.00381 0.04540269   -0.0839  0.9334
## countryUS        -0.11095 0.04257798   -2.6059  0.0110
## yr.ctr:countryNL -0.00736 0.00861336   -0.8549  0.3953
## yr.ctr:countryCA -0.01196 0.00749801   -1.5952  0.1148
## yr.ctr:countryUS -0.00627 0.00703152   -0.8921  0.3752
## 
##  Correlation: 
##                  (Intr) yr.ctr cntrNL cntrCA cntrUS yr.:NL yr.:CA
## yr.ctr            0.000                                          
## countryNL        -0.809  0.000                                   
## countryCA        -0.929  0.000  0.752                            
## countryUS        -0.991  0.000  0.802  0.921                     
## yr.ctr:countryNL  0.000 -0.809  0.000  0.000  0.000              
## yr.ctr:countryCA  0.000 -0.929  0.000  0.000  0.000  0.752       
## yr.ctr:countryUS  0.000 -0.991  0.000  0.000  0.000  0.802  0.921
## 
## Standardized residuals:
##         Min          Q1         Med          Q3         Max 
## -2.29802807 -0.72889177 -0.01225061  0.70129397  1.91996548 
## 
## Residual standard error: 0.1839296 
## Degrees of freedom: 84 total; 76 residual</code></pre>
<p>Note that the estimate of the residual standard deviation (mislabeled as the “residual standard error” in the R output) is smaller for the ML fit than for the REML fit, as we expect.</p>
<p>To continue, we can also fit a first-order autoregressive correlation structure to the residual errors within each country. Here, because the data are evenly spaced and are already sorted in the data set, it’s simple to add the within country autocorrelation. To write this model as an equation, the fixed-effect specification remains unchanged:
<span class="math display">\[\begin{equation}
y_{it} = a_i + b_i x_{it} + \varepsilon_{it}.
\end{equation}\]</span>
The marginal distribution of the errors is also unchanged: <span class="math inline">\(\varepsilon_{it} \sim \mathcal{N}(0, \sigma^2_i)\)</span>. However, the within-country errors are now correlated:
<span class="math display">\[\begin{equation}
\mathrm{Corr}(\varepsilon_{it_1}, \varepsilon_{jt_2}) = \begin{cases} \rho^{|t_1 - t_2|} &amp; i = j \\ 0 &amp; i \neq j \end{cases}
\end{equation}\]</span></p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="generalized-least-squares.html#cb335-1" aria-hidden="true" tabindex="-1"></a>gls2 <span class="ot">&lt;-</span> <span class="fu">gls</span>(pct.male <span class="sc">~</span> yr.ctr <span class="sc">*</span> country, <span class="at">data =</span> births, <span class="at">weights =</span> <span class="fu">varIdent</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> country),</span>
<span id="cb335-2"><a href="generalized-least-squares.html#cb335-2" aria-hidden="true" tabindex="-1"></a>                                                        <span class="at">correlation =</span> <span class="fu">corAR1</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> country))</span>
<span id="cb335-3"><a href="generalized-least-squares.html#cb335-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(gls2)</span></code></pre></div>
<pre><code>## Generalized least squares fit by REML
##   Model: pct.male ~ yr.ctr * country 
##   Data: births 
##         AIC       BIC   logLik
##   -93.01222 -62.71269 59.50611
## 
## Correlation Structure: AR(1)
##  Formula: ~1 | country 
##  Parameter estimate(s):
##        Phi 
## 0.07081995 
## Variance function:
##  Structure: Different standard deviations per stratum
##  Formula: ~1 | country 
##  Parameter estimates:
##        DK        NL        CA        US 
## 1.0000000 0.7416576 0.4009707 0.1338036 
## 
## Coefficients:
##                     Value  Std.Error   t-value p-value
## (Intercept)      51.37134 0.04520738 1136.3486  0.0000
## yr.ctr            0.00088 0.00741198    0.1187  0.9058
## countryNL        -0.15484 0.05628375   -2.7510  0.0074
## countryCA        -0.00385 0.04870615   -0.0791  0.9371
## countryUS        -0.11127 0.04561027   -2.4396  0.0170
## yr.ctr:countryNL -0.00713 0.00922801   -0.7727  0.4421
## yr.ctr:countryCA -0.01188 0.00798562   -1.4872  0.1411
## yr.ctr:countryUS -0.00634 0.00747803   -0.8481  0.3991
## 
##  Correlation: 
##                  (Intr) yr.ctr cntrNL cntrCA cntrUS yr.:NL yr.:CA
## yr.ctr            0.000                                          
## countryNL        -0.803  0.000                                   
## countryCA        -0.928  0.000  0.746                            
## countryUS        -0.991  0.000  0.796  0.920                     
## yr.ctr:countryNL  0.000 -0.803  0.000  0.000  0.000              
## yr.ctr:countryCA  0.000 -0.928  0.000  0.000  0.000  0.746       
## yr.ctr:countryUS  0.000 -0.991  0.000  0.000  0.000  0.796  0.920
## 
## Standardized residuals:
##         Min          Q1         Med          Q3         Max 
## -2.15117280 -0.70400503 -0.02488281  0.66159776  1.82002897 
## 
## Residual standard error: 0.1936784 
## Degrees of freedom: 84 total; 76 residual</code></pre>
<p>The estimate of the within-country correlation is small: only 0.071. The model with autocorrelated errors is nested within the model with heterogeneous variances, and both have the same fixed-effect structure, so we can compare the two REML fits directly:</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="generalized-least-squares.html#cb337-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(gls0, gls1, gls2)</span></code></pre></div>
<pre><code>##      Model df       AIC       BIC   logLik   Test  L.Ratio p-value
## gls0     1  9 -42.18264 -21.20604 30.09132                        
## gls1     2 12 -94.69995 -66.73115 59.34998 1 vs 2 58.51731  &lt;.0001
## gls2     3 13 -93.01222 -62.71269 59.50611 2 vs 3  0.31227  0.5763</code></pre>
<p>By either AIC or the LRT, the model with the autocorrelated errors does not provide a statistically significant improvement in fit.</p>
<p>We can now use the model with heterogeneous variances and independent errors to conduct the usual inferences on the fixed effects. Because we now compare models with different fixed-effect structures, we must work on the ML fits. Let’s start with a model that removes the interaction between time and country. The fixed-effects component of this model is:
<span class="math display">\[\begin{equation}
y_{it} = a_i + b x_{it} + \varepsilon_{it}.
\end{equation}\]</span>
In other words, there is a common slope among the countries.</p>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="generalized-least-squares.html#cb339-1" aria-hidden="true" tabindex="-1"></a>gls3ML <span class="ot">&lt;-</span> <span class="fu">gls</span>(pct.male <span class="sc">~</span> yr.ctr <span class="sc">+</span> country, <span class="at">data =</span> births, <span class="at">weights =</span> <span class="fu">varIdent</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> country),</span>
<span id="cb339-2"><a href="generalized-least-squares.html#cb339-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">method =</span> <span class="st">&quot;ML&quot;</span>)</span>
<span id="cb339-3"><a href="generalized-least-squares.html#cb339-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(gls3ML)</span></code></pre></div>
<pre><code>## Generalized least squares fit by maximum likelihood
##   Model: pct.male ~ yr.ctr + country 
##   Data: births 
##         AIC       BIC  logLik
##   -159.5456 -137.6682 88.7728
## 
## Variance function:
##  Structure: Different standard deviations per stratum
##  Formula: ~1 | country 
##  Parameter estimates:
##        DK        NL        CA        US 
## 1.0000000 0.7098035 0.4232237 0.1323319 
## 
## Coefficients:
##                Value  Std.Error   t-value p-value
## (Intercept) 51.37095 0.04238044 1212.1383  0.0000
## yr.ctr      -0.00585 0.00086365   -6.7731  0.0000
## countryNL   -0.15476 0.05197129   -2.9778  0.0039
## countryCA   -0.00381 0.04601974   -0.0828  0.9342
## countryUS   -0.11095 0.04274991   -2.5954  0.0113
## 
##  Correlation: 
##           (Intr) yr.ctr cntrNL cntrCA
## yr.ctr     0.000                     
## countryNL -0.815  0.000              
## countryCA -0.921  0.000  0.751       
## countryUS -0.991  0.000  0.808  0.913
## 
## Standardized residuals:
##         Min          Q1         Med          Q3         Max 
## -2.32703514 -0.72533260  0.03426803  0.82167128  2.12375963 
## 
## Residual standard error: 0.1883428 
## Degrees of freedom: 84 total; 79 residual</code></pre>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="generalized-least-squares.html#cb341-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(gls3ML, gls1ML)</span></code></pre></div>
<pre><code>##        Model df       AIC       BIC   logLik   Test  L.Ratio p-value
## gls3ML     1  9 -159.5456 -137.6683 88.77280                        
## gls1ML     2 12 -158.4457 -129.2759 91.22287 1 vs 2 4.900132  0.1793</code></pre>
<p>Both AIC and the LRT favor a model with a common slope. Let’s go further to see if the intercepts differ among the countries. In other words, we can entertain the model
<span class="math display">\[\begin{equation}
y_{it} = a + b x_{it} + \varepsilon_{it}.
\end{equation}\]</span></p>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="generalized-least-squares.html#cb343-1" aria-hidden="true" tabindex="-1"></a>gls4ML <span class="ot">&lt;-</span> <span class="fu">gls</span>(pct.male <span class="sc">~</span> yr.ctr, <span class="at">data =</span> births, <span class="at">weights =</span> <span class="fu">varIdent</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> country),</span>
<span id="cb343-2"><a href="generalized-least-squares.html#cb343-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">method =</span> <span class="st">&quot;ML&quot;</span>)</span>
<span id="cb343-3"><a href="generalized-least-squares.html#cb343-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(gls4ML)</span></code></pre></div>
<pre><code>## Generalized least squares fit by maximum likelihood
##   Model: pct.male ~ yr.ctr 
##   Data: births 
##         AIC       BIC  logLik
##   -136.0564 -121.4715 74.0282
## 
## Variance function:
##  Structure: Different standard deviations per stratum
##  Formula: ~1 | country 
##  Parameter estimates:
##        DK        NL        CA        US 
## 1.0000000 0.6559362 0.6051856 0.1159405 
## 
## Coefficients:
##                Value   Std.Error  t-value p-value
## (Intercept) 51.26375 0.005328997 9619.775       0
## yr.ctr      -0.00558 0.000880055   -6.335       0
## 
##  Correlation: 
##        (Intr)
## yr.ctr 0     
## 
## Standardized residuals:
##        Min         Q1        Med         Q3        Max 
## -2.5381852 -0.3580929  0.1883530  0.9250208  2.3348069 
## 
## Residual standard error: 0.2164103 
## Degrees of freedom: 84 total; 82 residual</code></pre>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="generalized-least-squares.html#cb345-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(gls4ML, gls3ML, gls1ML)</span></code></pre></div>
<pre><code>##        Model df       AIC       BIC   logLik   Test   L.Ratio p-value
## gls4ML     1  6 -136.0564 -121.4715 74.02820                         
## gls3ML     2  9 -159.5456 -137.6683 88.77280 1 vs 2 29.489202  &lt;.0001
## gls1ML     3 12 -158.4457 -129.2759 91.22287 2 vs 3  4.900132  0.1793</code></pre>
<p>There is strong evidence that the percentage of male births differs among countries, after accounting for the effect of the temporal trend.</p>
<p>We can visualize the model by making scatterplots and overlaying fitted regression lines. Having finished with model selection, we’ll revert to the REML fits for final parameter estimation. Again, we’ll use the trick of eliminating the global intercept to make it easier to find the country-specific intercepts.</p>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="generalized-least-squares.html#cb347-1" aria-hidden="true" tabindex="-1"></a>gls3a <span class="ot">&lt;-</span> <span class="fu">gls</span>(pct.male <span class="sc">~</span> yr.ctr <span class="sc">+</span> country <span class="sc">-</span> <span class="dv">1</span>, <span class="at">data =</span> births, <span class="at">weights =</span> <span class="fu">varIdent</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> country))</span>
<span id="cb347-2"><a href="generalized-least-squares.html#cb347-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(gls3a)</span></code></pre></div>
<pre><code>## Generalized least squares fit by REML
##   Model: pct.male ~ yr.ctr + country - 1 
##   Data: births 
##         AIC       BIC   logLik
##   -122.7459 -101.4209 70.37297
## 
## Variance function:
##  Structure: Different standard deviations per stratum
##  Formula: ~1 | country 
##  Parameter estimates:
##        DK        NL        CA        US 
## 1.0000000 0.7099907 0.4237511 0.1352729 
## 
## Coefficients:
##              Value  Std.Error  t-value p-value
## yr.ctr    -0.00586 0.00087529   -6.700       0
## countryDK 51.37095 0.04213583 1219.175       0
## countryNL 51.21619 0.02991605 1711.997       0
## countryCA 51.36714 0.01785511 2876.888       0
## countryUS 51.26000 0.00569984 8993.240       0
## 
##  Correlation: 
##           yr.ctr cntrDK cntrNL cntrCA
## countryDK 0                          
## countryNL 0      0                   
## countryCA 0      0      0            
## countryUS 0      0      0      0     
## 
## Standardized residuals:
##         Min          Q1         Med          Q3         Max 
## -2.26855300 -0.70087717  0.03371643  0.79968076  2.07208985 
## 
## Residual standard error: 0.1930906 
## Degrees of freedom: 84 total; 79 residual</code></pre>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="generalized-least-squares.html#cb349-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="at">las =</span> <span class="dv">1</span>)</span>
<span id="cb349-2"><a href="generalized-least-squares.html#cb349-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb349-3"><a href="generalized-least-squares.html#cb349-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(births, <span class="fu">plot</span>(pct.male <span class="sc">~</span> year, <span class="at">type =</span> <span class="st">&quot;n&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;percent male&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Canada&quot;</span>))</span>
<span id="cb349-4"><a href="generalized-least-squares.html#cb349-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">subset</span>(births, country <span class="sc">==</span> <span class="st">&quot;CA&quot;</span>), <span class="fu">points</span>(pct.male <span class="sc">~</span> year))</span>
<span id="cb349-5"><a href="generalized-least-squares.html#cb349-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb349-6"><a href="generalized-least-squares.html#cb349-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">a =</span> <span class="fl">51.3671</span> <span class="sc">+</span> <span class="fl">0.00586</span> <span class="sc">*</span> <span class="dv">1980</span>, <span class="at">b =</span> <span class="sc">-</span><span class="fl">0.00586</span>)</span>
<span id="cb349-7"><a href="generalized-least-squares.html#cb349-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb349-8"><a href="generalized-least-squares.html#cb349-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(births, <span class="fu">plot</span>(pct.male <span class="sc">~</span> year, <span class="at">type =</span> <span class="st">&quot;n&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;percent male&quot;</span>, <span class="at">main =</span> <span class="st">&quot;USA&quot;</span>))</span>
<span id="cb349-9"><a href="generalized-least-squares.html#cb349-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">subset</span>(births, country <span class="sc">==</span> <span class="st">&quot;US&quot;</span>), <span class="fu">points</span>(pct.male <span class="sc">~</span> year))</span>
<span id="cb349-10"><a href="generalized-least-squares.html#cb349-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb349-11"><a href="generalized-least-squares.html#cb349-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">a =</span> <span class="fl">51.26</span> <span class="sc">+</span> <span class="fl">0.00586</span> <span class="sc">*</span> <span class="dv">1980</span>, <span class="at">b =</span> <span class="sc">-</span><span class="fl">0.00586</span>)</span>
<span id="cb349-12"><a href="generalized-least-squares.html#cb349-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb349-13"><a href="generalized-least-squares.html#cb349-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(births, <span class="fu">plot</span>(pct.male <span class="sc">~</span> year, <span class="at">type =</span> <span class="st">&quot;n&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;percent male&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Denmark&quot;</span>))</span>
<span id="cb349-14"><a href="generalized-least-squares.html#cb349-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">subset</span>(births, country <span class="sc">==</span> <span class="st">&quot;DK&quot;</span>), <span class="fu">points</span>(pct.male <span class="sc">~</span> year))</span>
<span id="cb349-15"><a href="generalized-least-squares.html#cb349-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb349-16"><a href="generalized-least-squares.html#cb349-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">a =</span> <span class="fl">51.371</span> <span class="sc">+</span> <span class="fl">0.00586</span> <span class="sc">*</span> <span class="dv">1980</span>, <span class="at">b =</span> <span class="sc">-</span><span class="fl">0.00586</span>)</span>
<span id="cb349-17"><a href="generalized-least-squares.html#cb349-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb349-18"><a href="generalized-least-squares.html#cb349-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(births, <span class="fu">plot</span>(pct.male <span class="sc">~</span> year, <span class="at">type =</span> <span class="st">&quot;n&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;percent male&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Netherlands&quot;</span>))</span>
<span id="cb349-19"><a href="generalized-least-squares.html#cb349-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">subset</span>(births, country <span class="sc">==</span> <span class="st">&quot;NL&quot;</span>), <span class="fu">points</span>(pct.male <span class="sc">~</span> year))</span>
<span id="cb349-20"><a href="generalized-least-squares.html#cb349-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb349-21"><a href="generalized-least-squares.html#cb349-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">a =</span> <span class="fl">51.2162</span> <span class="sc">+</span> <span class="fl">0.00586</span> <span class="sc">*</span> <span class="dv">1980</span>, <span class="at">b =</span> <span class="sc">-</span><span class="fl">0.00586</span>)</span></code></pre></div>
<p><img src="05-GeneralizedLeastSquares_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>It is interesting to compare the estimate of the slope between the GLS model and the naive OLS fit. In the GLS model, the slope is estimated to be <span class="math inline">\(-0.00586\%\)</span> per year, with a standard error of <span class="math inline">\(8.8 \times 10^{-4}\)</span>. In the OLS fit, the estimate is <span class="math inline">\(-0.00555\%\)</span> per year, with a standard error of <span class="math inline">\(2.8 \times 10^{-3}\)</span>. Thus the GLS fit has substantially improved the precision of the estimate of the temporal trend.</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="generalized-least-squares.html#cb350-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">gls</span>(pct.male <span class="sc">~</span> yr.ctr <span class="sc">+</span> country, <span class="at">data =</span> births))</span></code></pre></div>
<pre><code>## Generalized least squares fit by REML
##   Model: pct.male ~ yr.ctr + country 
##   Data: births 
##         AIC      BIC   logLik
##   -70.12178 -55.9051 41.06089
## 
## Coefficients:
##                Value  Std.Error   t-value p-value
## (Intercept) 51.37095 0.02762942 1859.2846  0.0000
## yr.ctr      -0.00556 0.00228142   -2.4350  0.0171
## countryNL   -0.15476 0.03907390   -3.9607  0.0002
## countryCA   -0.00381 0.03907390   -0.0975  0.9226
## countryUS   -0.11095 0.03907390   -2.8396  0.0057
## 
##  Correlation: 
##           (Intr) yr.ctr cntrNL cntrCA
## yr.ctr     0.000                     
## countryNL -0.707  0.000              
## countryCA -0.707  0.000  0.500       
## countryUS -0.707  0.000  0.500  0.500
## 
## Standardized residuals:
##          Min           Q1          Med           Q3          Max 
## -2.517325067 -0.553487986  0.009393865  0.508672668  3.142893232 
## 
## Residual standard error: 0.1266139 
## Degrees of freedom: 84 total; 79 residual</code></pre>
</div>
<div id="temporal-serial-correlation" class="section level2 hasAnchor" number="5.2">
<h2><span class="header-section-number">5.2</span> Temporal (serial) correlation<a href="generalized-least-squares.html#temporal-serial-correlation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Temporal structure often induces a (positive) correlation between data points that occur close together in time. These are the same types of correlations that we would expect to find for any data that occur as part of a series, or serial correlation. (Other data types may display serial correlations that are not driven by time, such as positions along a one-dimensional spatial transect.) We will illustrate how to handle temporal correlations using a time series of annual moorhen abundance on the island of Kauai. These data are analyzed in Ch. 6 of Zuur et al. (2009), and are originally from Reed et al. (2007). The data are available for download from the website associated with Zuur et al.’s text. More details about the models available to handle serial correlations in <code>nlme::gls</code> can be found in <span class="math inline">\(\S\)</span> 5.3.1 of Pinheiro &amp; Bates (2000).</p>
<p>First we load the data and do some housekeeping.</p>
<div class="sourceCode" id="cb352"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb352-1"><a href="generalized-least-squares.html#cb352-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb352-2"><a href="generalized-least-squares.html#cb352-2" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(nlme)</span>
<span id="cb352-3"><a href="generalized-least-squares.html#cb352-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb352-4"><a href="generalized-least-squares.html#cb352-4" aria-hidden="true" tabindex="-1"></a>birds <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;data/Hawaii.txt&quot;</span>, <span class="at">head =</span> T)</span>
<span id="cb352-5"><a href="generalized-least-squares.html#cb352-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb352-6"><a href="generalized-least-squares.html#cb352-6" aria-hidden="true" tabindex="-1"></a><span class="do">## extract moorhen data</span></span>
<span id="cb352-7"><a href="generalized-least-squares.html#cb352-7" aria-hidden="true" tabindex="-1"></a>moorhen <span class="ot">&lt;-</span> birds[, <span class="fu">c</span>(<span class="st">&quot;Year&quot;</span>, <span class="st">&quot;Rainfall&quot;</span>, <span class="st">&quot;Moorhen.Kauai&quot;</span>)]</span>
<span id="cb352-8"><a href="generalized-least-squares.html#cb352-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb352-9"><a href="generalized-least-squares.html#cb352-9" aria-hidden="true" tabindex="-1"></a><span class="do">## rename variables</span></span>
<span id="cb352-10"><a href="generalized-least-squares.html#cb352-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(moorhen) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;rainfall&quot;</span>, <span class="st">&quot;abundance&quot;</span>)</span>
<span id="cb352-11"><a href="generalized-least-squares.html#cb352-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb352-12"><a href="generalized-least-squares.html#cb352-12" aria-hidden="true" tabindex="-1"></a><span class="do">## remove NAs</span></span>
<span id="cb352-13"><a href="generalized-least-squares.html#cb352-13" aria-hidden="true" tabindex="-1"></a>moorhen <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(moorhen)</span>
<span id="cb352-14"><a href="generalized-least-squares.html#cb352-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb352-15"><a href="generalized-least-squares.html#cb352-15" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(moorhen, <span class="fu">plot</span>(abundance <span class="sc">~</span> year))</span></code></pre></div>
<p><img src="05-GeneralizedLeastSquares_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="generalized-least-squares.html#cb353-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(moorhen, <span class="fu">plot</span>(<span class="fu">log</span>(abundance) <span class="sc">~</span> year))</span></code></pre></div>
<p><img src="05-GeneralizedLeastSquares_files/figure-html/unnamed-chunk-20-2.png" width="672" /></p>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="generalized-least-squares.html#cb354-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(moorhen, <span class="fu">plot</span>(<span class="fu">log</span>(abundance) <span class="sc">~</span> rainfall))</span></code></pre></div>
<p><img src="05-GeneralizedLeastSquares_files/figure-html/unnamed-chunk-20-3.png" width="672" /></p>
<p>Suppose we want to characterize any possible (linear) temporal trend in moorhen abundance, and/or any association between moorhen abundance and annual rainfall. We log transform the abundance data to convert any multiplicative time trends into linear trends. First we will fit an OLS model and use the function <code>acf</code> to plot the autocorrelation function (ACF) of the residuals.</p>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb355-1"><a href="generalized-least-squares.html#cb355-1" aria-hidden="true" tabindex="-1"></a>fm1 <span class="ot">&lt;-</span> nlme<span class="sc">::</span><span class="fu">gls</span>(<span class="fu">log</span>(abundance) <span class="sc">~</span> rainfall <span class="sc">+</span> year, <span class="at">data =</span> moorhen)</span>
<span id="cb355-2"><a href="generalized-least-squares.html#cb355-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">residuals</span>(fm1) <span class="sc">~</span> moorhen<span class="sc">$</span>year)</span></code></pre></div>
<p><img src="05-GeneralizedLeastSquares_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="generalized-least-squares.html#cb356-1" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(<span class="fu">residuals</span>(fm1))</span></code></pre></div>
<p><img src="05-GeneralizedLeastSquares_files/figure-html/unnamed-chunk-21-2.png" width="672" /></p>
<p>The significant first-order autocorrelation suggests a first-order autoregressive model might be appropriate for these errors. We will fit such a model using the <code>corAR1</code> correlation structure. In doing so, we use the formula <code>form = ~ year</code> to indicate that the <code>year</code> variable in the data set provides the time index. This is a necessary step with these data because some years are missing.</p>
<div class="sourceCode" id="cb357"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb357-1"><a href="generalized-least-squares.html#cb357-1" aria-hidden="true" tabindex="-1"></a>fm2 <span class="ot">&lt;-</span> nlme<span class="sc">::</span><span class="fu">gls</span>(<span class="fu">log</span>(abundance) <span class="sc">~</span> rainfall <span class="sc">+</span> year, <span class="at">data =</span> moorhen, </span>
<span id="cb357-2"><a href="generalized-least-squares.html#cb357-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">correlation =</span> <span class="fu">corAR1</span>(<span class="at">form =</span> <span class="sc">~</span> year))</span>
<span id="cb357-3"><a href="generalized-least-squares.html#cb357-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fm2)</span></code></pre></div>
<pre><code>## Generalized least squares fit by REML
##   Model: log(abundance) ~ rainfall + year 
##   Data: moorhen 
##        AIC      BIC   logLik
##   124.6062 133.2946 -57.3031
## 
## Correlation Structure: ARMA(1,0)
##  Formula: ~year 
##  Parameter estimate(s):
##      Phi1 
## 0.5599778 
## 
## Coefficients:
##                  Value Std.Error   t-value p-value
## (Intercept) -161.17809  32.93180 -4.894299  0.0000
## rainfall      -0.00783   0.01433 -0.546369  0.5877
## year           0.08326   0.01663  5.005461  0.0000
## 
##  Correlation: 
##          (Intr) ranfll
## rainfall -0.006       
## year     -1.000 -0.001
## 
## Standardized residuals:
##        Min         Q1        Med         Q3        Max 
## -3.3338721 -0.5125953  0.2117251  0.6813604  1.5181543 
## 
## Residual standard error: 0.9112434 
## Degrees of freedom: 45 total; 42 residual</code></pre>
<p>The fit suggests that the residuals from adjacent years have a reasonably strong positive correlation of <span class="math inline">\(\approx 0.56\)</span>.</p>
<p>To see if the AR1 model has successfully accounted for the correlation structure in the residuals, we will inspect the “normalized” residuals (see the R help for <code>residuals.gls</code> for details). If all the structure in the residuals has been successfully accounted for, then the normalized residuals should look like iid draws from a standard Gaussian distribution.</p>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb359-1"><a href="generalized-least-squares.html#cb359-1" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(<span class="fu">residuals</span>(fm2, <span class="at">type =</span> <span class="st">&quot;normalized&quot;</span>))</span></code></pre></div>
<p><img src="05-GeneralizedLeastSquares_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<p>None of the autocorrelations among the normalized residuals differ significantly from zero.</p>
<p>Finally, because the AR1 model nests the OLS model, we can use a LRT to inspect whether the first-order autoregression provides a significant improvement in fit.</p>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb360-1"><a href="generalized-least-squares.html#cb360-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fm1, fm2)</span></code></pre></div>
<pre><code>##     Model df      AIC      BIC    logLik   Test  L.Ratio p-value
## fm1     1  4 134.5734 141.5240 -63.28668                        
## fm2     2  5 124.6062 133.2946 -57.30310 1 vs 2 11.96716   5e-04</code></pre>
<p>The LRT suggests that the model with a first-order autocorrelation signficantly improves on the OLS model. We would then proceed to use this model to characterize the temporal trend in moorhen abundance, and the (lack of) association between moorhen abundance and rainfall.</p>
</div>
<div id="spatial-data" class="section level2 hasAnchor" number="5.3">
<h2><span class="header-section-number">5.3</span> Spatial data<a href="generalized-least-squares.html#spatial-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Data that are organized in space are also often correlated, with data points that occur close together in space being strongly (positively) correlated with one another. To illustrate spatial correlations, we will use the <code>Wheat2</code> data provided as part of the <code>nlme</code> package. Pinheiro &amp; Bates (2000, p. 260) introduce the data as follows:</p>
<blockquote>
<p>“Stroup and Baenziger (1994) describe an agronomic experiment to compare the yield of 56 different varieties of wheat planted in four blocks arranged according to a randomized complete complete block design. All 56 varieties of wheat were used in each block. The latitude and longitude of each experimental unit in the trial were also recorded.”</p>
</blockquote>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb362-1"><a href="generalized-least-squares.html#cb362-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb362-2"><a href="generalized-least-squares.html#cb362-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;Wheat2&quot;</span>)</span>
<span id="cb362-3"><a href="generalized-least-squares.html#cb362-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb362-4"><a href="generalized-least-squares.html#cb362-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Wheat2)</span></code></pre></div>
<pre><code>##  Block       variety        yield          latitude       longitude    
##  4:56   ARAPAHOE :  4   Min.   : 1.05   Min.   : 4.30   Min.   : 1.20  
##  2:56   BRULE    :  4   1st Qu.:23.52   1st Qu.:17.20   1st Qu.: 7.20  
##  3:56   BUCKSKIN :  4   Median :26.85   Median :25.80   Median :14.40  
##  1:56   CENTURA  :  4   Mean   :25.53   Mean   :27.22   Mean   :14.08  
##         CENTURK78:  4   3rd Qu.:30.39   3rd Qu.:38.70   3rd Qu.:20.40  
##         CHEYENNE :  4   Max.   :42.00   Max.   :47.30   Max.   :26.40  
##         (Other)  :200</code></pre>
<p>A plot of the spatial locations of these data shows that the blocks hide a lot of information about the actual spatial position of the individual plots. While a traditional RCBD analysis might account for some of the spatial variation, we could perhaps do better by ignoring the block designations and modeling spatial correlations based on the actual location of each plot.</p>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="generalized-least-squares.html#cb364-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(Wheat2, <span class="fu">plot</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude, </span>
<span id="cb364-2"><a href="generalized-least-squares.html#cb364-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">pch =</span> <span class="fu">as.numeric</span>(Block)))</span></code></pre></div>
<p><img src="05-GeneralizedLeastSquares_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<p>Our goal is simply to characterizes the differences in mean yield among the 56 varieties while accounting for possible spatial correlations. We begin by fitting a simple one-factor ANOVA model and inspecting the residuals. First, we will use the <code>plot_ly</code> function to generate a three-dimensional view of the residuals. This 3D plot can be rotated in R, although the rotation is not possible in this Rbook.</p>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="generalized-least-squares.html#cb365-1" aria-hidden="true" tabindex="-1"></a>fm1 <span class="ot">&lt;-</span> nlme<span class="sc">::</span><span class="fu">gls</span>(yield <span class="sc">~</span> variety, <span class="at">data =</span> Wheat2)</span>
<span id="cb365-2"><a href="generalized-least-squares.html#cb365-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb365-3"><a href="generalized-least-squares.html#cb365-3" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(plotly)</span></code></pre></div>
<pre><code>## Loading required package: plotly</code></pre>
<pre><code>## Loading required package: ggplot2</code></pre>
<pre><code>## 
## Attaching package: &#39;plotly&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:ggplot2&#39;:
## 
##     last_plot</code></pre>
<pre><code>## The following object is masked from &#39;package:stats&#39;:
## 
##     filter</code></pre>
<pre><code>## The following object is masked from &#39;package:graphics&#39;:
## 
##     layout</code></pre>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="generalized-least-squares.html#cb372-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(<span class="at">x =</span> Wheat2<span class="sc">$</span>latitude, </span>
<span id="cb372-2"><a href="generalized-least-squares.html#cb372-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> Wheat2<span class="sc">$</span>longitude, </span>
<span id="cb372-3"><a href="generalized-least-squares.html#cb372-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">z =</span> <span class="fu">resid</span>(fm1), </span>
<span id="cb372-4"><a href="generalized-least-squares.html#cb372-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">type =</span> <span class="st">&quot;scatter3d&quot;</span>, </span>
<span id="cb372-5"><a href="generalized-least-squares.html#cb372-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">mode =</span> <span class="st">&quot;markers&quot;</span>, </span>
<span id="cb372-6"><a href="generalized-least-squares.html#cb372-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="fu">resid</span>(fm1))</span></code></pre></div>
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-2c9375a346f1b6e14a8c" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-2c9375a346f1b6e14a8c">{"x":{"visdat":{"2a9811ca76c9":["function () ","plotlyVisDat"]},"cur_data":"2a9811ca76c9","attrs":{"2a9811ca76c9":{"x":[4.3,4.3,4.3,4.3,4.3,4.3,4.3,8.6,8.6,8.6,8.6,8.6,8.6,8.6,8.6,8.6,8.6,8.6,8.6,8.6,8.6,8.6,8.6,8.6,8.6,8.6,8.6,8.6,8.6,12.9,12.9,12.9,12.9,12.9,12.9,12.9,12.9,12.9,12.9,12.9,12.9,12.9,12.9,12.9,12.9,12.9,12.9,12.9,12.9,12.9,12.9,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,21.5,21.5,21.5,21.5,21.5,21.5,21.5,21.5,21.5,21.5,21.5,21.5,21.5,21.5,21.5,21.5,21.5,21.5,21.5,21.5,21.5,21.5,25.8,25.8,25.8,25.8,25.8,25.8,25.8,25.8,25.8,25.8,25.8,25.8,25.8,25.8,25.8,25.8,25.8,25.8,25.8,25.8,25.8,30.1,30.1,30.1,30.1,30.1,30.1,30.1,30.1,30.1,30.1,30.1,30.1,30.1,30.1,30.1,30.1,30.1,30.1,30.1,30.1,30.1,30.1,34.4,34.4,34.4,34.4,34.4,34.4,34.4,34.4,34.4,34.4,34.4,34.4,34.4,34.4,34.4,34.4,34.4,34.4,34.4,34.4,34.4,34.4,38.7,38.7,38.7,38.7,38.7,38.7,38.7,38.7,38.7,38.7,38.7,38.7,38.7,38.7,38.7,38.7,38.7,38.7,38.7,38.7,38.7,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,47.3,47.3,47.3,47.3,47.3,47.3,47.3,47.3,47.3,47.3,47.3,47.3,47.3,47.3,47.3,47.3,47.3,47.3,47.3,47.3,47.3,47.3],"y":[19.2,20.4,21.6,22.8,24,25.2,26.4,1.2,2.4,3.6,4.8,6,7.2,8.4,9.6,10.8,12,13.2,14.4,15.6,16.8,18,19.2,20.4,21.6,22.8,24,25.2,26.4,1.2,2.4,3.6,4.8,6,7.2,8.4,9.6,10.8,12,13.2,14.4,15.6,16.8,18,19.2,20.4,21.6,22.8,24,25.2,26.4,1.2,2.4,3.6,4.8,6,8.4,9.6,10.8,12,13.2,14.4,15.6,16.8,18,19.2,20.4,21.6,22.8,24,25.2,26.4,1.2,2.4,3.6,4.8,6,7.2,8.4,9.6,10.8,12,13.2,14.4,15.6,16.8,18,19.2,20.4,21.6,22.8,24,25.2,26.4,1.2,2.4,3.6,4.8,6,7.2,8.4,9.6,10.8,12,13.2,14.4,15.6,16.8,18,19.2,20.4,21.6,24,25.2,26.4,1.2,2.4,3.6,4.8,6,7.2,8.4,9.6,10.8,12,13.2,14.4,15.6,16.8,18,19.2,20.4,21.6,22.8,24,25.2,26.4,1.2,2.4,3.6,4.8,6,7.2,8.4,9.6,10.8,12,13.2,14.4,15.6,16.8,18,19.2,20.4,21.6,22.8,24,25.2,26.4,1.2,2.4,3.6,4.8,6,7.2,8.4,9.6,10.8,13.2,14.4,15.6,16.8,18,19.2,20.4,21.6,22.8,24,25.2,26.4,1.2,2.4,3.6,4.8,6,7.2,8.4,9.6,10.8,12,13.2,14.4,15.6,16.8,18,19.2,20.4,21.6,22.8,24,25.2,26.4,1.2,2.4,3.6,4.8,6,7.2,8.4,9.6,10.8,12,13.2,14.4,15.6,16.8,18,19.2,20.4,21.6,22.8,24,25.2,26.4],"z":[0.687499999999968,5.47499999999997,4.55,8.88750000000006,3.61249999999998,2.86249999999996,10.925,-3.2875,2.69999999999994,-1.975,-1.90000000000004,-5.52500000000003,4.92500000000001,-6.325,5.26249999999997,3.92499999999996,1.29999999999999,-2.1125,10.075,-0.137500000000021,3.7125,0.662499999999998,-0.850000000000033,0.812499999999996,9.35,7.1125,6.04999999999999,-4.35,0.137499999999989,4.28749999999999,6.9875,-3.63750000000001,-3.46250000000001,-3.475,2.7625,1.7,-3.0125,1.13749999999999,3.63749999999999,-3.13750000000001,-3.27500000000002,0.699999999999982,10.175,2.82499999999997,7.33749999999998,6.63749999999999,1.33749999999998,9.48749999999999,9.55,1.03749999999999,-0.70000000000001,6.35,-2.45000000000001,-0.587500000000009,-1.01250000000001,-3.07500000000001,6.14999999999994,6.72499999999996,1.53750000000006,2.16249999999999,-0.65000000000002,2.83749999999998,11.275,-5.40000000000001,4.08749999999999,11.025,4.38749999999999,4.375,5.21249999999998,-0.062500000000032,1.04999999999999,0.0500000000000007,3.2,-2.06250000000001,3.6125,4.53749999999999,3.5625,3.3375,-1.525,-1.85000000000001,-0.412500000000009,8.07500000000002,2.57499999999999,0.737499999999994,2.48749999999999,1.88749999999999,-0.0125000000000099,5.22499999999999,7.27499999999997,1.61249999999996,3.52499999999997,6.9875,1.8625,0.412499999999998,-3.05,3.7125,0.524999999999977,7.98749999999999,6.77499999999997,3.74999999999996,2.14999999999999,5.8875,6.01249999999999,4.11249999999998,3.11249999999998,-0.450000000000031,-2.7,8.5125,2.07499999999996,10.9,7.49999999999999,-3.13750000000001,1.82499999999999,0.399999999999967,3.98749999999999,-4.40000000000002,6.9125,-0.162500000000001,-3.4,-3.07500000000001,-3.05000000000004,5.2875,6.4,6.09999999999999,2.79999999999999,4.97499999999999,4.26249999999999,8.26249999999999,-0.587500000000002,-6.10000000000001,5.83749999999999,3.6375,9.33749999999999,0.487499999999994,-0.462500000000031,-2.67500000000003,6.0125,-4.36249999999994,-4.7,-14.3625,-19.025,-8.81250000000001,-1.6375,-2.03750000000002,-5.85000000000001,-4.38750000000002,5.725,-1.12500000000002,10.025,-2.80000000000001,12.0625,-1.7875,5.41249999999996,2.45,6.51249999999999,1.88749999999999,3.08749999999998,2.38749999999999,14.825,-7.56250000000001,-22.125,-17.625,-17.4625,-12.9500000000001,-8.675,-10.9,1.2625,-3.22500000000003,2.01249999999999,3.87499999999998,4.4,-3.67500000000003,4.09999999999994,-9.1,4.34999999999998,1.19999999999996,-0.162500000000033,4.42499999999997,-3.57500000000001,-7.6125,-12.55,-1.26250000000001,-21.4375,-22.375,-9.0875,-7.5875,-11.3,-9.88750000000004,-6.06249999999994,-2.36250000000001,-5.03750000000001,6.08749999999999,-3.6125,-2.225,-9.41250000000001,1.08749999999999,1.29999999999999,-6.27500000000001,1.48749999999999,-0.26250000000001,-1.40000000000001,0.899999999999967,-9.57500000000001,-18.2375,-20.675,-15.6125,-19.5125,-3.57500000000001,-2.36250000000001,-7.3375,-13.6875,-4.43750000000002,-5.96250000000001,-1.2,3.72499999999999,-3.36250000000001,1.47499999999997,0.79999999999999,-0.637500000000003,-0.937500000000021,4.64999999999999,6.02500000000002,-2.8,-0.737500000000004],"mode":"markers","color":[0.687499999999968,5.47499999999997,4.55,8.88750000000006,3.61249999999998,2.86249999999996,10.925,-3.2875,2.69999999999994,-1.975,-1.90000000000004,-5.52500000000003,4.92500000000001,-6.325,5.26249999999997,3.92499999999996,1.29999999999999,-2.1125,10.075,-0.137500000000021,3.7125,0.662499999999998,-0.850000000000033,0.812499999999996,9.35,7.1125,6.04999999999999,-4.35,0.137499999999989,4.28749999999999,6.9875,-3.63750000000001,-3.46250000000001,-3.475,2.7625,1.7,-3.0125,1.13749999999999,3.63749999999999,-3.13750000000001,-3.27500000000002,0.699999999999982,10.175,2.82499999999997,7.33749999999998,6.63749999999999,1.33749999999998,9.48749999999999,9.55,1.03749999999999,-0.70000000000001,6.35,-2.45000000000001,-0.587500000000009,-1.01250000000001,-3.07500000000001,6.14999999999994,6.72499999999996,1.53750000000006,2.16249999999999,-0.65000000000002,2.83749999999998,11.275,-5.40000000000001,4.08749999999999,11.025,4.38749999999999,4.375,5.21249999999998,-0.062500000000032,1.04999999999999,0.0500000000000007,3.2,-2.06250000000001,3.6125,4.53749999999999,3.5625,3.3375,-1.525,-1.85000000000001,-0.412500000000009,8.07500000000002,2.57499999999999,0.737499999999994,2.48749999999999,1.88749999999999,-0.0125000000000099,5.22499999999999,7.27499999999997,1.61249999999996,3.52499999999997,6.9875,1.8625,0.412499999999998,-3.05,3.7125,0.524999999999977,7.98749999999999,6.77499999999997,3.74999999999996,2.14999999999999,5.8875,6.01249999999999,4.11249999999998,3.11249999999998,-0.450000000000031,-2.7,8.5125,2.07499999999996,10.9,7.49999999999999,-3.13750000000001,1.82499999999999,0.399999999999967,3.98749999999999,-4.40000000000002,6.9125,-0.162500000000001,-3.4,-3.07500000000001,-3.05000000000004,5.2875,6.4,6.09999999999999,2.79999999999999,4.97499999999999,4.26249999999999,8.26249999999999,-0.587500000000002,-6.10000000000001,5.83749999999999,3.6375,9.33749999999999,0.487499999999994,-0.462500000000031,-2.67500000000003,6.0125,-4.36249999999994,-4.7,-14.3625,-19.025,-8.81250000000001,-1.6375,-2.03750000000002,-5.85000000000001,-4.38750000000002,5.725,-1.12500000000002,10.025,-2.80000000000001,12.0625,-1.7875,5.41249999999996,2.45,6.51249999999999,1.88749999999999,3.08749999999998,2.38749999999999,14.825,-7.56250000000001,-22.125,-17.625,-17.4625,-12.9500000000001,-8.675,-10.9,1.2625,-3.22500000000003,2.01249999999999,3.87499999999998,4.4,-3.67500000000003,4.09999999999994,-9.1,4.34999999999998,1.19999999999996,-0.162500000000033,4.42499999999997,-3.57500000000001,-7.6125,-12.55,-1.26250000000001,-21.4375,-22.375,-9.0875,-7.5875,-11.3,-9.88750000000004,-6.06249999999994,-2.36250000000001,-5.03750000000001,6.08749999999999,-3.6125,-2.225,-9.41250000000001,1.08749999999999,1.29999999999999,-6.27500000000001,1.48749999999999,-0.26250000000001,-1.40000000000001,0.899999999999967,-9.57500000000001,-18.2375,-20.675,-15.6125,-19.5125,-3.57500000000001,-2.36250000000001,-7.3375,-13.6875,-4.43750000000002,-5.96250000000001,-1.2,3.72499999999999,-3.36250000000001,1.47499999999997,0.79999999999999,-0.637500000000003,-0.937500000000021,4.64999999999999,6.02500000000002,-2.8,-0.737500000000004],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter3d"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":[]},"yaxis":{"title":[]},"zaxis":{"title":[]}},"hovermode":"closest","showlegend":false,"legend":{"yanchor":"top","y":0.5}},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[4.3,4.3,4.3,4.3,4.3,4.3,4.3,8.6,8.6,8.6,8.6,8.6,8.6,8.6,8.6,8.6,8.6,8.6,8.6,8.6,8.6,8.6,8.6,8.6,8.6,8.6,8.6,8.6,8.6,12.9,12.9,12.9,12.9,12.9,12.9,12.9,12.9,12.9,12.9,12.9,12.9,12.9,12.9,12.9,12.9,12.9,12.9,12.9,12.9,12.9,12.9,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,21.5,21.5,21.5,21.5,21.5,21.5,21.5,21.5,21.5,21.5,21.5,21.5,21.5,21.5,21.5,21.5,21.5,21.5,21.5,21.5,21.5,21.5,25.8,25.8,25.8,25.8,25.8,25.8,25.8,25.8,25.8,25.8,25.8,25.8,25.8,25.8,25.8,25.8,25.8,25.8,25.8,25.8,25.8,30.1,30.1,30.1,30.1,30.1,30.1,30.1,30.1,30.1,30.1,30.1,30.1,30.1,30.1,30.1,30.1,30.1,30.1,30.1,30.1,30.1,30.1,34.4,34.4,34.4,34.4,34.4,34.4,34.4,34.4,34.4,34.4,34.4,34.4,34.4,34.4,34.4,34.4,34.4,34.4,34.4,34.4,34.4,34.4,38.7,38.7,38.7,38.7,38.7,38.7,38.7,38.7,38.7,38.7,38.7,38.7,38.7,38.7,38.7,38.7,38.7,38.7,38.7,38.7,38.7,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,47.3,47.3,47.3,47.3,47.3,47.3,47.3,47.3,47.3,47.3,47.3,47.3,47.3,47.3,47.3,47.3,47.3,47.3,47.3,47.3,47.3,47.3],"y":[19.2,20.4,21.6,22.8,24,25.2,26.4,1.2,2.4,3.6,4.8,6,7.2,8.4,9.6,10.8,12,13.2,14.4,15.6,16.8,18,19.2,20.4,21.6,22.8,24,25.2,26.4,1.2,2.4,3.6,4.8,6,7.2,8.4,9.6,10.8,12,13.2,14.4,15.6,16.8,18,19.2,20.4,21.6,22.8,24,25.2,26.4,1.2,2.4,3.6,4.8,6,8.4,9.6,10.8,12,13.2,14.4,15.6,16.8,18,19.2,20.4,21.6,22.8,24,25.2,26.4,1.2,2.4,3.6,4.8,6,7.2,8.4,9.6,10.8,12,13.2,14.4,15.6,16.8,18,19.2,20.4,21.6,22.8,24,25.2,26.4,1.2,2.4,3.6,4.8,6,7.2,8.4,9.6,10.8,12,13.2,14.4,15.6,16.8,18,19.2,20.4,21.6,24,25.2,26.4,1.2,2.4,3.6,4.8,6,7.2,8.4,9.6,10.8,12,13.2,14.4,15.6,16.8,18,19.2,20.4,21.6,22.8,24,25.2,26.4,1.2,2.4,3.6,4.8,6,7.2,8.4,9.6,10.8,12,13.2,14.4,15.6,16.8,18,19.2,20.4,21.6,22.8,24,25.2,26.4,1.2,2.4,3.6,4.8,6,7.2,8.4,9.6,10.8,13.2,14.4,15.6,16.8,18,19.2,20.4,21.6,22.8,24,25.2,26.4,1.2,2.4,3.6,4.8,6,7.2,8.4,9.6,10.8,12,13.2,14.4,15.6,16.8,18,19.2,20.4,21.6,22.8,24,25.2,26.4,1.2,2.4,3.6,4.8,6,7.2,8.4,9.6,10.8,12,13.2,14.4,15.6,16.8,18,19.2,20.4,21.6,22.8,24,25.2,26.4],"z":[0.687499999999968,5.47499999999997,4.55,8.88750000000006,3.61249999999998,2.86249999999996,10.925,-3.2875,2.69999999999994,-1.975,-1.90000000000004,-5.52500000000003,4.92500000000001,-6.325,5.26249999999997,3.92499999999996,1.29999999999999,-2.1125,10.075,-0.137500000000021,3.7125,0.662499999999998,-0.850000000000033,0.812499999999996,9.35,7.1125,6.04999999999999,-4.35,0.137499999999989,4.28749999999999,6.9875,-3.63750000000001,-3.46250000000001,-3.475,2.7625,1.7,-3.0125,1.13749999999999,3.63749999999999,-3.13750000000001,-3.27500000000002,0.699999999999982,10.175,2.82499999999997,7.33749999999998,6.63749999999999,1.33749999999998,9.48749999999999,9.55,1.03749999999999,-0.70000000000001,6.35,-2.45000000000001,-0.587500000000009,-1.01250000000001,-3.07500000000001,6.14999999999994,6.72499999999996,1.53750000000006,2.16249999999999,-0.65000000000002,2.83749999999998,11.275,-5.40000000000001,4.08749999999999,11.025,4.38749999999999,4.375,5.21249999999998,-0.062500000000032,1.04999999999999,0.0500000000000007,3.2,-2.06250000000001,3.6125,4.53749999999999,3.5625,3.3375,-1.525,-1.85000000000001,-0.412500000000009,8.07500000000002,2.57499999999999,0.737499999999994,2.48749999999999,1.88749999999999,-0.0125000000000099,5.22499999999999,7.27499999999997,1.61249999999996,3.52499999999997,6.9875,1.8625,0.412499999999998,-3.05,3.7125,0.524999999999977,7.98749999999999,6.77499999999997,3.74999999999996,2.14999999999999,5.8875,6.01249999999999,4.11249999999998,3.11249999999998,-0.450000000000031,-2.7,8.5125,2.07499999999996,10.9,7.49999999999999,-3.13750000000001,1.82499999999999,0.399999999999967,3.98749999999999,-4.40000000000002,6.9125,-0.162500000000001,-3.4,-3.07500000000001,-3.05000000000004,5.2875,6.4,6.09999999999999,2.79999999999999,4.97499999999999,4.26249999999999,8.26249999999999,-0.587500000000002,-6.10000000000001,5.83749999999999,3.6375,9.33749999999999,0.487499999999994,-0.462500000000031,-2.67500000000003,6.0125,-4.36249999999994,-4.7,-14.3625,-19.025,-8.81250000000001,-1.6375,-2.03750000000002,-5.85000000000001,-4.38750000000002,5.725,-1.12500000000002,10.025,-2.80000000000001,12.0625,-1.7875,5.41249999999996,2.45,6.51249999999999,1.88749999999999,3.08749999999998,2.38749999999999,14.825,-7.56250000000001,-22.125,-17.625,-17.4625,-12.9500000000001,-8.675,-10.9,1.2625,-3.22500000000003,2.01249999999999,3.87499999999998,4.4,-3.67500000000003,4.09999999999994,-9.1,4.34999999999998,1.19999999999996,-0.162500000000033,4.42499999999997,-3.57500000000001,-7.6125,-12.55,-1.26250000000001,-21.4375,-22.375,-9.0875,-7.5875,-11.3,-9.88750000000004,-6.06249999999994,-2.36250000000001,-5.03750000000001,6.08749999999999,-3.6125,-2.225,-9.41250000000001,1.08749999999999,1.29999999999999,-6.27500000000001,1.48749999999999,-0.26250000000001,-1.40000000000001,0.899999999999967,-9.57500000000001,-18.2375,-20.675,-15.6125,-19.5125,-3.57500000000001,-2.36250000000001,-7.3375,-13.6875,-4.43750000000002,-5.96250000000001,-1.2,3.72499999999999,-3.36250000000001,1.47499999999997,0.79999999999999,-0.637500000000003,-0.937500000000021,4.64999999999999,6.02500000000002,-2.8,-0.737500000000004],"mode":"markers","type":"scatter3d","marker":{"colorbar":{"title":"","ticklen":2},"cmin":-22.375,"cmax":14.825,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333334","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[0.687499999999968,5.47499999999997,4.55,8.88750000000006,3.61249999999998,2.86249999999996,10.925,-3.2875,2.69999999999994,-1.975,-1.90000000000004,-5.52500000000003,4.92500000000001,-6.325,5.26249999999997,3.92499999999996,1.29999999999999,-2.1125,10.075,-0.137500000000021,3.7125,0.662499999999998,-0.850000000000033,0.812499999999996,9.35,7.1125,6.04999999999999,-4.35,0.137499999999989,4.28749999999999,6.9875,-3.63750000000001,-3.46250000000001,-3.475,2.7625,1.7,-3.0125,1.13749999999999,3.63749999999999,-3.13750000000001,-3.27500000000002,0.699999999999982,10.175,2.82499999999997,7.33749999999998,6.63749999999999,1.33749999999998,9.48749999999999,9.55,1.03749999999999,-0.70000000000001,6.35,-2.45000000000001,-0.587500000000009,-1.01250000000001,-3.07500000000001,6.14999999999994,6.72499999999996,1.53750000000006,2.16249999999999,-0.65000000000002,2.83749999999998,11.275,-5.40000000000001,4.08749999999999,11.025,4.38749999999999,4.375,5.21249999999998,-0.062500000000032,1.04999999999999,0.0500000000000007,3.2,-2.06250000000001,3.6125,4.53749999999999,3.5625,3.3375,-1.525,-1.85000000000001,-0.412500000000009,8.07500000000002,2.57499999999999,0.737499999999994,2.48749999999999,1.88749999999999,-0.0125000000000099,5.22499999999999,7.27499999999997,1.61249999999996,3.52499999999997,6.9875,1.8625,0.412499999999998,-3.05,3.7125,0.524999999999977,7.98749999999999,6.77499999999997,3.74999999999996,2.14999999999999,5.8875,6.01249999999999,4.11249999999998,3.11249999999998,-0.450000000000031,-2.7,8.5125,2.07499999999996,10.9,7.49999999999999,-3.13750000000001,1.82499999999999,0.399999999999967,3.98749999999999,-4.40000000000002,6.9125,-0.162500000000001,-3.4,-3.07500000000001,-3.05000000000004,5.2875,6.4,6.09999999999999,2.79999999999999,4.97499999999999,4.26249999999999,8.26249999999999,-0.587500000000002,-6.10000000000001,5.83749999999999,3.6375,9.33749999999999,0.487499999999994,-0.462500000000031,-2.67500000000003,6.0125,-4.36249999999994,-4.7,-14.3625,-19.025,-8.81250000000001,-1.6375,-2.03750000000002,-5.85000000000001,-4.38750000000002,5.725,-1.12500000000002,10.025,-2.80000000000001,12.0625,-1.7875,5.41249999999996,2.45,6.51249999999999,1.88749999999999,3.08749999999998,2.38749999999999,14.825,-7.56250000000001,-22.125,-17.625,-17.4625,-12.9500000000001,-8.675,-10.9,1.2625,-3.22500000000003,2.01249999999999,3.87499999999998,4.4,-3.67500000000003,4.09999999999994,-9.1,4.34999999999998,1.19999999999996,-0.162500000000033,4.42499999999997,-3.57500000000001,-7.6125,-12.55,-1.26250000000001,-21.4375,-22.375,-9.0875,-7.5875,-11.3,-9.88750000000004,-6.06249999999994,-2.36250000000001,-5.03750000000001,6.08749999999999,-3.6125,-2.225,-9.41250000000001,1.08749999999999,1.29999999999999,-6.27500000000001,1.48749999999999,-0.26250000000001,-1.40000000000001,0.899999999999967,-9.57500000000001,-18.2375,-20.675,-15.6125,-19.5125,-3.57500000000001,-2.36250000000001,-7.3375,-13.6875,-4.43750000000002,-5.96250000000001,-1.2,3.72499999999999,-3.36250000000001,1.47499999999997,0.79999999999999,-0.637500000000003,-0.937500000000021,4.64999999999999,6.02500000000002,-2.8,-0.737500000000004],"line":{"colorbar":{"title":"","ticklen":2},"cmin":-22.375,"cmax":14.825,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333334","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[0.687499999999968,5.47499999999997,4.55,8.88750000000006,3.61249999999998,2.86249999999996,10.925,-3.2875,2.69999999999994,-1.975,-1.90000000000004,-5.52500000000003,4.92500000000001,-6.325,5.26249999999997,3.92499999999996,1.29999999999999,-2.1125,10.075,-0.137500000000021,3.7125,0.662499999999998,-0.850000000000033,0.812499999999996,9.35,7.1125,6.04999999999999,-4.35,0.137499999999989,4.28749999999999,6.9875,-3.63750000000001,-3.46250000000001,-3.475,2.7625,1.7,-3.0125,1.13749999999999,3.63749999999999,-3.13750000000001,-3.27500000000002,0.699999999999982,10.175,2.82499999999997,7.33749999999998,6.63749999999999,1.33749999999998,9.48749999999999,9.55,1.03749999999999,-0.70000000000001,6.35,-2.45000000000001,-0.587500000000009,-1.01250000000001,-3.07500000000001,6.14999999999994,6.72499999999996,1.53750000000006,2.16249999999999,-0.65000000000002,2.83749999999998,11.275,-5.40000000000001,4.08749999999999,11.025,4.38749999999999,4.375,5.21249999999998,-0.062500000000032,1.04999999999999,0.0500000000000007,3.2,-2.06250000000001,3.6125,4.53749999999999,3.5625,3.3375,-1.525,-1.85000000000001,-0.412500000000009,8.07500000000002,2.57499999999999,0.737499999999994,2.48749999999999,1.88749999999999,-0.0125000000000099,5.22499999999999,7.27499999999997,1.61249999999996,3.52499999999997,6.9875,1.8625,0.412499999999998,-3.05,3.7125,0.524999999999977,7.98749999999999,6.77499999999997,3.74999999999996,2.14999999999999,5.8875,6.01249999999999,4.11249999999998,3.11249999999998,-0.450000000000031,-2.7,8.5125,2.07499999999996,10.9,7.49999999999999,-3.13750000000001,1.82499999999999,0.399999999999967,3.98749999999999,-4.40000000000002,6.9125,-0.162500000000001,-3.4,-3.07500000000001,-3.05000000000004,5.2875,6.4,6.09999999999999,2.79999999999999,4.97499999999999,4.26249999999999,8.26249999999999,-0.587500000000002,-6.10000000000001,5.83749999999999,3.6375,9.33749999999999,0.487499999999994,-0.462500000000031,-2.67500000000003,6.0125,-4.36249999999994,-4.7,-14.3625,-19.025,-8.81250000000001,-1.6375,-2.03750000000002,-5.85000000000001,-4.38750000000002,5.725,-1.12500000000002,10.025,-2.80000000000001,12.0625,-1.7875,5.41249999999996,2.45,6.51249999999999,1.88749999999999,3.08749999999998,2.38749999999999,14.825,-7.56250000000001,-22.125,-17.625,-17.4625,-12.9500000000001,-8.675,-10.9,1.2625,-3.22500000000003,2.01249999999999,3.87499999999998,4.4,-3.67500000000003,4.09999999999994,-9.1,4.34999999999998,1.19999999999996,-0.162500000000033,4.42499999999997,-3.57500000000001,-7.6125,-12.55,-1.26250000000001,-21.4375,-22.375,-9.0875,-7.5875,-11.3,-9.88750000000004,-6.06249999999994,-2.36250000000001,-5.03750000000001,6.08749999999999,-3.6125,-2.225,-9.41250000000001,1.08749999999999,1.29999999999999,-6.27500000000001,1.48749999999999,-0.26250000000001,-1.40000000000001,0.899999999999967,-9.57500000000001,-18.2375,-20.675,-15.6125,-19.5125,-3.57500000000001,-2.36250000000001,-7.3375,-13.6875,-4.43750000000002,-5.96250000000001,-1.2,3.72499999999999,-3.36250000000001,1.47499999999997,0.79999999999999,-0.637500000000003,-0.937500000000021,4.64999999999999,6.02500000000002,-2.8,-0.737500000000004]}},"frame":null},{"x":[4.3,47.3],"y":[1.2,26.4],"type":"scatter3d","mode":"markers","opacity":0,"hoverinfo":"none","showlegend":false,"marker":{"colorbar":{"title":"","ticklen":2,"len":0.5,"lenmode":"fraction","y":1,"yanchor":"top"},"cmin":-22.375,"cmax":14.825,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333334","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":true,"color":[-22.375,14.825],"line":{"color":"rgba(255,127,14,1)"}},"z":[-22.375,14.825],"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p>The residuals suggest a clear spatial trend in fertility. Next, We plot the semivariogram using <code>nlme::Variogram</code>. This command will actually plot the semivariance normalized by the sill, such that the quantity plotted is 1 minus the correlation between two points. In the plot below, the smooth curve is a loess curve fit to the calculated points.</p>
<div class="sourceCode" id="cb373"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb373-1"><a href="generalized-least-squares.html#cb373-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">Variogram</span>(fm1, <span class="at">form =</span> <span class="sc">~</span> latitude <span class="sc">+</span> longitude))</span></code></pre></div>
<p><img src="05-GeneralizedLeastSquares_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<p>The semivariogram suggests a non-zero nugget. Here, we will fit spherical, Gaussian, and linear correlation models based on the latitude and longitude coordinates of each data point. For each fit, we will then plot a semivariogram of the normalized residuals. Again, if the model has done a good job accounting for the correlation structure in the data, then the normalized residuals should be independent. See <span class="math inline">\(\S\)</span> 5.3.2 of Pinheiro &amp; Bates (2000) for more details about the different spatial correlation structures available in <code>nlme::gls</code>. In particular, see their Fig. 5.9 for a display of how different spatial correlation models compare.</p>
<p>For each model, we must supply starting values for the range and nugget. Rough starting values based on the semivariogram of the raw residuals will suffice. Calls to <code>Variogram</code> will plot the calculated semivariances and overlay the fitted semivariogram.</p>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="generalized-least-squares.html#cb374-1" aria-hidden="true" tabindex="-1"></a><span class="do">## spherical covariance</span></span>
<span id="cb374-2"><a href="generalized-least-squares.html#cb374-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb374-3"><a href="generalized-least-squares.html#cb374-3" aria-hidden="true" tabindex="-1"></a>fm2 <span class="ot">&lt;-</span> nlme<span class="sc">::</span><span class="fu">gls</span>(yield <span class="sc">~</span> variety, <span class="at">data =</span> Wheat2, </span>
<span id="cb374-4"><a href="generalized-least-squares.html#cb374-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">correlation =</span> <span class="fu">corSpher</span>(<span class="fu">c</span>(<span class="dv">28</span>, <span class="fl">0.2</span>), </span>
<span id="cb374-5"><a href="generalized-least-squares.html#cb374-5" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">form =</span> <span class="sc">~</span> latitude <span class="sc">+</span> longitude, </span>
<span id="cb374-6"><a href="generalized-least-squares.html#cb374-6" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">nugget =</span> <span class="cn">TRUE</span>))  <span class="co"># need to supply starting values</span></span>
<span id="cb374-7"><a href="generalized-least-squares.html#cb374-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb374-8"><a href="generalized-least-squares.html#cb374-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">Variogram</span>(fm2, <span class="at">form =</span> <span class="sc">~</span> latitude <span class="sc">+</span> longitude))</span></code></pre></div>
<p><img src="05-GeneralizedLeastSquares_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb375-1"><a href="generalized-least-squares.html#cb375-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Gaussian covariance</span></span>
<span id="cb375-2"><a href="generalized-least-squares.html#cb375-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb375-3"><a href="generalized-least-squares.html#cb375-3" aria-hidden="true" tabindex="-1"></a>fm3 <span class="ot">&lt;-</span> nlme<span class="sc">::</span><span class="fu">gls</span>(yield <span class="sc">~</span> variety, <span class="at">data =</span> Wheat2, </span>
<span id="cb375-4"><a href="generalized-least-squares.html#cb375-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">correlation =</span> <span class="fu">corGaus</span>(<span class="fu">c</span>(<span class="dv">28</span>, <span class="fl">0.2</span>),</span>
<span id="cb375-5"><a href="generalized-least-squares.html#cb375-5" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">form =</span> <span class="sc">~</span> latitude <span class="sc">+</span> longitude,</span>
<span id="cb375-6"><a href="generalized-least-squares.html#cb375-6" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">nugget =</span> <span class="cn">TRUE</span>))  <span class="co"># need to supply starting values</span></span>
<span id="cb375-7"><a href="generalized-least-squares.html#cb375-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb375-8"><a href="generalized-least-squares.html#cb375-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">Variogram</span>(fm3, <span class="at">form =</span> <span class="sc">~</span> latitude <span class="sc">+</span> longitude))</span></code></pre></div>
<p><img src="05-GeneralizedLeastSquares_files/figure-html/unnamed-chunk-29-2.png" width="672" /></p>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="generalized-least-squares.html#cb376-1" aria-hidden="true" tabindex="-1"></a><span class="do">## linear covariance</span></span>
<span id="cb376-2"><a href="generalized-least-squares.html#cb376-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb376-3"><a href="generalized-least-squares.html#cb376-3" aria-hidden="true" tabindex="-1"></a>fm4 <span class="ot">&lt;-</span> nlme<span class="sc">::</span><span class="fu">gls</span>(yield <span class="sc">~</span> variety, <span class="at">data =</span> Wheat2, </span>
<span id="cb376-4"><a href="generalized-least-squares.html#cb376-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">correlation =</span> <span class="fu">corLin</span>(<span class="fu">c</span>(<span class="dv">28</span>, <span class="fl">0.2</span>),</span>
<span id="cb376-5"><a href="generalized-least-squares.html#cb376-5" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">form =</span> <span class="sc">~</span> latitude <span class="sc">+</span> longitude,</span>
<span id="cb376-6"><a href="generalized-least-squares.html#cb376-6" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">nugget =</span> <span class="cn">TRUE</span>))  <span class="co"># need to supply starting values</span></span>
<span id="cb376-7"><a href="generalized-least-squares.html#cb376-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb376-8"><a href="generalized-least-squares.html#cb376-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">Variogram</span>(fm4, <span class="at">form =</span> <span class="sc">~</span> latitude <span class="sc">+</span> longitude))</span></code></pre></div>
<p><img src="05-GeneralizedLeastSquares_files/figure-html/unnamed-chunk-29-3.png" width="672" /></p>
<p>If we wish, we can extract the estimated nugget and range from each model by calling <code>print</code>.</p>
<div class="sourceCode" id="cb377"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb377-1"><a href="generalized-least-squares.html#cb377-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fm4)</span></code></pre></div>
<pre><code>## Generalized least squares fit by REML
##   Model: yield ~ variety 
##   Data: Wheat2 
##   Log-restricted-likelihood: -533.2815
## 
## Coefficients:
##       (Intercept)      varietyBRULE   varietyBUCKSKIN    varietyCENTURA 
##       28.41005933       -1.71161334        6.99635483       -2.58344151 
##  varietyCENTURK78   varietyCHEYENNE       varietyCODY       varietyCOLT 
##       -2.46550574       -3.07214768       -4.49895886       -2.22833768 
##       varietyGAGE  varietyHOMESTEAD   varietyKS831374     varietyLANCER 
##       -4.26332881       -6.20641501       -1.18492850       -4.53944671 
##    varietyLANCOTA    varietyNE83404    varietyNE83406    varietyNE83407 
##       -6.32251412       -2.92856070       -1.17290874       -2.62264363 
##    varietyNE83432    varietyNE83498    varietyNE83T12    varietyNE84557 
##       -5.65619040        2.20715030       -5.32860054       -5.50430895 
##    varietyNE85556    varietyNE85623    varietyNE86482    varietyNE86501 
##       -0.19445894       -3.51776928       -2.99576076       -2.22781284 
##    varietyNE86503    varietyNE86507    varietyNE86509    varietyNE86527 
##       -0.13437309       -0.49972260       -5.64308018       -1.70998353 
##    varietyNE86582    varietyNE86606    varietyNE86607   varietyNE86T666 
##       -4.52784048       -0.04400593       -1.87905786      -11.34834217 
##    varietyNE87403    varietyNE87408    varietyNE87409    varietyNE87446 
##       -7.07640881       -3.87938223       -1.07868064       -5.46517624 
##    varietyNE87451    varietyNE87457    varietyNE87463    varietyNE87499 
##       -2.90699758       -3.59541052       -4.49563865       -5.67322707 
##    varietyNE87512    varietyNE87513    varietyNE87522    varietyNE87612 
##       -5.60494961       -4.84498289       -7.64855589        0.48268951 
##    varietyNE87613    varietyNE87615    varietyNE87619    varietyNE87627 
##        1.37319577       -3.69500935        1.18693565      -10.07566895 
##     varietyNORKAN    varietyREDLAND varietyROUGHRIDER    varietySCOUT66 
##       -5.27977336        0.36480075       -1.53131835        0.30979481 
##  varietySIOUXLAND     varietyTAM107     varietyTAM200       varietyVONA 
##       -2.75246638       -5.45138542       -9.11014805       -3.25735184 
## 
## Correlation Structure: Linear spatial correlation
##  Formula: ~latitude + longitude 
##  Parameter estimate(s):
##      range     nugget 
## 10.7962043  0.2050487 
## Degrees of freedom: 224 total; 168 residual
## Residual standard error: 6.960609</code></pre>
<p>We can use AIC to compare the fits of the two different spatial correlation structures.</p>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb379-1"><a href="generalized-least-squares.html#cb379-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fm1, fm2, fm3, fm4)</span></code></pre></div>
<pre><code>##     Model df      AIC      BIC    logLik   Test  L.Ratio p-value
## fm1     1 57 1354.742 1532.808 -620.3709                        
## fm2     2 59 1185.863 1370.177 -533.9315 1 vs 2 172.8787  &lt;.0001
## fm3     3 59 1185.102 1369.416 -533.5509                        
## fm4     4 59 1184.563 1368.877 -533.2815</code></pre>
<p>The linear correlation structure is AIC best.</p>
<p>At this point, if we were really interested in these data, we would proceed to analyze for significant differences among the 56 wheat varieties. For our present purposes, we will merely note that the usual <span class="math inline">\(F\)</span>-test rejects the null hypothesis of equality of means when we account for the spatial correlation in the residuals, but does not do so when we assumed the residuals were independent.</p>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb381-1"><a href="generalized-least-squares.html#cb381-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fm1)</span></code></pre></div>
<pre><code>## Denom. DF: 168 
##             numDF  F-value p-value
## (Intercept)     1 2454.621  &lt;.0001
## variety        55    0.730  0.9119</code></pre>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb383-1"><a href="generalized-least-squares.html#cb383-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fm4)</span></code></pre></div>
<pre><code>## Denom. DF: 168 
##             numDF   F-value p-value
## (Intercept)     1 233.98320  &lt;.0001
## variety        55   2.65823  &lt;.0001</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="smooth-regression.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="hierarchical-mixed-models.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "serif",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
