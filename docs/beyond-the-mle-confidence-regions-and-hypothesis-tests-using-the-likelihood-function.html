<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Beyond the MLE: Confidence regions and hypothesis tests using the likelihood function | BMA / ST 590 computing companion</title>
  <meta name="description" content="This is a proto-textbook for BMA / ST 590, Statistical Modeling in Ecology, taught at NCSU in Fall 2021." />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Beyond the MLE: Confidence regions and hypothesis tests using the likelihood function | BMA / ST 590 computing companion" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is a proto-textbook for BMA / ST 590, Statistical Modeling in Ecology, taught at NCSU in Fall 2021." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Beyond the MLE: Confidence regions and hypothesis tests using the likelihood function | BMA / ST 590 computing companion" />
  
  <meta name="twitter:description" content="This is a proto-textbook for BMA / ST 590, Statistical Modeling in Ecology, taught at NCSU in Fall 2021." />
  

<meta name="author" content="Kevin Gross" />


<meta name="date" content="2023-08-28" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="bayesian-computation.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.10.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Maximum likelihood estimation</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#mathematical-basics"><i class="fa fa-check"></i><b>1.1</b> Mathematical basics</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#horse-kick-data"><i class="fa fa-check"></i><b>1.2</b> Horse-kick data</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="index.html"><a href="index.html#calculate-and-plot-the-log-likelihood-function"><i class="fa fa-check"></i><b>1.2.1</b> Calculate and plot the log-likelihood function</a></li>
<li class="chapter" data-level="1.2.2" data-path="index.html"><a href="index.html#find-the-mle-numerically-using-optimize"><i class="fa fa-check"></i><b>1.2.2</b> Find the MLE numerically using ‘optimize’</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#pulse-rate-data"><i class="fa fa-check"></i><b>1.3</b> Pulse rate data</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#tadpole-data"><i class="fa fa-check"></i><b>1.4</b> Tadpole data</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html"><i class="fa fa-check"></i><b>2</b> Beyond the MLE: Confidence regions and hypothesis tests using the likelihood function</a>
<ul>
<li class="chapter" data-level="2.1" data-path="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#confidence-intervals-for-single-parameters"><i class="fa fa-check"></i><b>2.1</b> Confidence intervals for single parameters</a></li>
<li class="chapter" data-level="2.2" data-path="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#two-param-mle"><i class="fa fa-check"></i><b>2.2</b> Confidence regions, profile likelihoods, and associated univariate intervals</a></li>
<li class="chapter" data-level="2.3" data-path="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#locally-quadratic-approximations-to-confidence-intervals-and-regions"><i class="fa fa-check"></i><b>2.3</b> Locally quadratic approximations to confidence intervals and regions</a></li>
<li class="chapter" data-level="2.4" data-path="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#comparing-models-likelihood-ratio-test-and-aic"><i class="fa fa-check"></i><b>2.4</b> Comparing models: Likelihood ratio test and AIC</a></li>
<li class="chapter" data-level="2.5" data-path="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#transformable-constraints"><i class="fa fa-check"></i><b>2.5</b> Transformable constraints</a></li>
<li class="chapter" data-level="2.6" data-path="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#the-negative-binomial-distriution-revisited"><i class="fa fa-check"></i><b>2.6</b> The negative binomial distriution, revisited</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="bayesian-computation.html"><a href="bayesian-computation.html"><i class="fa fa-check"></i><b>3</b> Bayesian computation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="bayesian-computation.html"><a href="bayesian-computation.html#computations-with-conjugate-priors"><i class="fa fa-check"></i><b>3.1</b> Computations with conjugate priors</a></li>
<li class="chapter" data-level="3.2" data-path="bayesian-computation.html"><a href="bayesian-computation.html#jags-in-r"><i class="fa fa-check"></i><b>3.2</b> JAGS in R</a></li>
<li class="chapter" data-level="3.3" data-path="bayesian-computation.html"><a href="bayesian-computation.html#rstanarm"><i class="fa fa-check"></i><b>3.3</b> rstanarm</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="smooth-regression.html"><a href="smooth-regression.html"><i class="fa fa-check"></i><b>4</b> Smooth regression</a>
<ul>
<li class="chapter" data-level="4.1" data-path="smooth-regression.html"><a href="smooth-regression.html#loess-smoothers"><i class="fa fa-check"></i><b>4.1</b> Loess smoothers</a></li>
<li class="chapter" data-level="4.2" data-path="smooth-regression.html"><a href="smooth-regression.html#splines"><i class="fa fa-check"></i><b>4.2</b> Splines</a></li>
<li class="chapter" data-level="4.3" data-path="smooth-regression.html"><a href="smooth-regression.html#generalized-additive-models-gams"><i class="fa fa-check"></i><b>4.3</b> Generalized additive models (GAMs)</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="generalized-least-squares.html"><a href="generalized-least-squares.html"><i class="fa fa-check"></i><b>5</b> Generalized Least Squares</a>
<ul>
<li class="chapter" data-level="5.1" data-path="generalized-least-squares.html"><a href="generalized-least-squares.html#heterogeneous-variance"><i class="fa fa-check"></i><b>5.1</b> Heterogeneous variance</a></li>
<li class="chapter" data-level="5.2" data-path="generalized-least-squares.html"><a href="generalized-least-squares.html#temporal-serial-correlation"><i class="fa fa-check"></i><b>5.2</b> Temporal (serial) correlation</a></li>
<li class="chapter" data-level="5.3" data-path="generalized-least-squares.html"><a href="generalized-least-squares.html#spatial-data"><i class="fa fa-check"></i><b>5.3</b> Spatial data</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="hierarchical-mixed-models.html"><a href="hierarchical-mixed-models.html"><i class="fa fa-check"></i><b>6</b> Hierarchical (mixed) models</a>
<ul>
<li class="chapter" data-level="6.1" data-path="hierarchical-mixed-models.html"><a href="hierarchical-mixed-models.html#one-factor-layout-dyestuff-data"><i class="fa fa-check"></i><b>6.1</b> One-factor layout: Dyestuff data</a></li>
<li class="chapter" data-level="6.2" data-path="hierarchical-mixed-models.html"><a href="hierarchical-mixed-models.html#bayesian-analysis"><i class="fa fa-check"></i><b>6.2</b> Bayesian analysis</a></li>
<li class="chapter" data-level="6.3" data-path="hierarchical-mixed-models.html"><a href="hierarchical-mixed-models.html#negative-within-group-correlations"><i class="fa fa-check"></i><b>6.3</b> Negative within-group correlations</a></li>
<li class="chapter" data-level="6.4" data-path="hierarchical-mixed-models.html"><a href="hierarchical-mixed-models.html#random-coefficient-models-rikz-data"><i class="fa fa-check"></i><b>6.4</b> Random coefficient models: RIKZ data</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="hierarchical-mixed-models.html"><a href="hierarchical-mixed-models.html#analysis-without-beach-level-covariate"><i class="fa fa-check"></i><b>6.4.1</b> Analysis without beach-level covariate</a></li>
<li class="chapter" data-level="6.4.2" data-path="hierarchical-mixed-models.html"><a href="hierarchical-mixed-models.html#adding-a-beach-level-covariate"><i class="fa fa-check"></i><b>6.4.2</b> Adding a beach-level covariate</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="hierarchical-mixed-models.html"><a href="hierarchical-mixed-models.html#nested-and-crossed-random-effects"><i class="fa fa-check"></i><b>6.5</b> Nested and crossed random effects</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="hierarchical-mixed-models.html"><a href="hierarchical-mixed-models.html#nested-random-effects"><i class="fa fa-check"></i><b>6.5.1</b> Nested random effects</a></li>
<li class="chapter" data-level="6.5.2" data-path="hierarchical-mixed-models.html"><a href="hierarchical-mixed-models.html#crossed-random-effects"><i class="fa fa-check"></i><b>6.5.2</b> Crossed random effects</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html"><i class="fa fa-check"></i><b>7</b> Generalized linear models</a>
<ul>
<li class="chapter" data-level="7.1" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#poisson-regression"><i class="fa fa-check"></i><b>7.1</b> Poisson regression</a></li>
<li class="chapter" data-level="7.2" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#bayesian-interlude"><i class="fa fa-check"></i><b>7.2</b> Bayesian interlude</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#rstanarm-1"><i class="fa fa-check"></i><b>7.2.1</b> rstanarm</a></li>
<li class="chapter" data-level="7.2.2" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#posterior-predictive-checks"><i class="fa fa-check"></i><b>7.2.2</b> Posterior predictive checks</a></li>
<li class="chapter" data-level="7.2.3" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#jags"><i class="fa fa-check"></i><b>7.2.3</b> JAGS</a></li>
<li class="chapter" data-level="7.2.4" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#observation-level-random-effects"><i class="fa fa-check"></i><b>7.2.4</b> Observation-level random effects</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#binary-responses"><i class="fa fa-check"></i><b>7.3</b> Binary responses</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#individual-binary-responses-tb-in-boar"><i class="fa fa-check"></i><b>7.3.1</b> Individual binary responses: TB in boar</a></li>
<li class="chapter" data-level="7.3.2" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#grouped-binary-data-industrial-melanism"><i class="fa fa-check"></i><b>7.3.2</b> Grouped binary data: Industrial melanism</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#zero-adjusted-models-for-count-data"><i class="fa fa-check"></i><b>7.4</b> Zero-adjusted models for count data</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#zero-truncated-models"><i class="fa fa-check"></i><b>7.4.1</b> Zero-truncated models</a></li>
<li class="chapter" data-level="7.4.2" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#zero-inflated-models"><i class="fa fa-check"></i><b>7.4.2</b> Zero-inflated models</a></li>
<li class="chapter" data-level="7.4.3" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#zero-altered-or-hurdle-models"><i class="fa fa-check"></i><b>7.4.3</b> Zero-altered, or “hurdle”, models</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#generalized-additive-models-gams-1"><i class="fa fa-check"></i><b>7.5</b> Generalized additive models (GAMs)</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="generalized-linear-mixed-models.html"><a href="generalized-linear-mixed-models.html"><i class="fa fa-check"></i><b>8</b> Generalized linear mixed models</a>
<ul>
<li class="chapter" data-level="8.1" data-path="generalized-linear-mixed-models.html"><a href="generalized-linear-mixed-models.html#example-1-industrial-melanism-data"><i class="fa fa-check"></i><b>8.1</b> Example 1: Industrial melanism data</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="generalized-linear-mixed-models.html"><a href="generalized-linear-mixed-models.html#gees"><i class="fa fa-check"></i><b>8.1.1</b> GEEs</a></li>
<li class="chapter" data-level="8.1.2" data-path="generalized-linear-mixed-models.html"><a href="generalized-linear-mixed-models.html#glmms"><i class="fa fa-check"></i><b>8.1.2</b> GLMMs</a></li>
<li class="chapter" data-level="8.1.3" data-path="generalized-linear-mixed-models.html"><a href="generalized-linear-mixed-models.html#bayesian-fit"><i class="fa fa-check"></i><b>8.1.3</b> Bayesian fit</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="generalized-linear-mixed-models.html"><a href="generalized-linear-mixed-models.html#example-2-ticks-on-red-grouse"><i class="fa fa-check"></i><b>8.2</b> Example 2: Ticks on red grouse</a></li>
<li class="chapter" data-level="8.3" data-path="generalized-linear-mixed-models.html"><a href="generalized-linear-mixed-models.html#gamms"><i class="fa fa-check"></i><b>8.3</b> GAMMs</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="bibliography.html"><a href="bibliography.html"><i class="fa fa-check"></i>Bibliography</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">BMA / ST 590 computing companion</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Chapter 2</span> Beyond the MLE: Confidence regions and hypothesis tests using the likelihood function<a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Likelihood can be used for more than simply isolating the MLE. The likelihood can also be used to generate confidence intervals for single parameters, or confidence regions for several parameters. We’ll start by using the horse-kick data to see how to generate a confidence interval for a single parameter, and then move on to considering models with more than one parameter.</p>
<div id="confidence-intervals-for-single-parameters" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Confidence intervals for single parameters<a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#confidence-intervals-for-single-parameters" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>First we’ll read in the data and recreate the negative log likelihood function.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="do">#################</span></span>
<span id="cb59-2"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Preparation</span></span>
<span id="cb59-3"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="do">################</span></span>
<span id="cb59-4"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb59-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-5"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="co"># read in the data</span></span>
<span id="cb59-6"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb59-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-7"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb59-7" aria-hidden="true" tabindex="-1"></a>horse <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;data/horse.txt&quot;</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb59-8"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb59-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-9"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb59-9" aria-hidden="true" tabindex="-1"></a>horse.neg.ll <span class="ot">&lt;-</span> <span class="cf">function</span>(my.lambda) {</span>
<span id="cb59-10"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb59-10" aria-hidden="true" tabindex="-1"></a>  ll.vals <span class="ot">&lt;-</span> <span class="fu">dpois</span>(<span class="at">x =</span> horse<span class="sc">$</span>deaths, <span class="at">lambda =</span> my.lambda, <span class="at">log =</span> <span class="cn">TRUE</span>)</span>
<span id="cb59-11"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb59-11" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> <span class="fu">sum</span>(ll.vals) </span>
<span id="cb59-12"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb59-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb59-13"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb59-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-14"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb59-14" aria-hidden="true" tabindex="-1"></a><span class="co"># create a vector of lambda values using the &#39;seq&#39;uence command</span></span>
<span id="cb59-15"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb59-15" aria-hidden="true" tabindex="-1"></a>lambda.vals <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.5</span>, <span class="at">to =</span> <span class="fl">1.0</span>, <span class="at">by =</span> <span class="fl">0.01</span>)</span>
<span id="cb59-16"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb59-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-17"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb59-17" aria-hidden="true" tabindex="-1"></a><span class="co"># create an empty vector to store the values of the log-likelihood</span></span>
<span id="cb59-18"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb59-18" aria-hidden="true" tabindex="-1"></a>ll.vals <span class="ot">&lt;-</span> <span class="fu">double</span>(<span class="at">length =</span> <span class="fu">length</span>(lambda.vals))</span>
<span id="cb59-19"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb59-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-20"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb59-20" aria-hidden="true" tabindex="-1"></a><span class="co"># use a loop to find the log-likelihood for each value in lambda.vals</span></span>
<span id="cb59-21"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb59-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i.lambda <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(lambda.vals)) {</span>
<span id="cb59-22"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb59-22" aria-hidden="true" tabindex="-1"></a>  ll.vals[i.lambda] <span class="ot">&lt;-</span> <span class="fu">horse.neg.ll</span>(lambda.vals[i.lambda])</span>
<span id="cb59-23"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb59-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb59-24"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb59-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-25"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb59-25" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ll.vals <span class="sc">~</span> lambda.vals, <span class="at">xlab =</span> <span class="st">&quot;lambda&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;negative log likelihood&quot;</span>, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>)</span></code></pre></div>
<p><img src="02-LikelihoodConfideceRegions_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<p>Now we’ll find the a (asymptotic) 95% confidence interval for <span class="math inline">\(\lambda\)</span> directly.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb60-1" aria-hidden="true" tabindex="-1"></a>cutoff.ll <span class="ot">&lt;-</span> <span class="fu">horse.neg.ll</span>(<span class="fl">0.7</span>) <span class="sc">+</span> <span class="fu">qchisq</span>(<span class="fl">0.95</span>, <span class="at">df =</span> <span class="dv">1</span>) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb60-2"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="co"># recreate the plot and add a line</span></span>
<span id="cb60-4"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ll.vals <span class="sc">~</span> lambda.vals, <span class="at">xlab =</span> <span class="st">&quot;lambda&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;negative log likelihood&quot;</span>, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>)</span>
<span id="cb60-5"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> cutoff.ll, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lty =</span> <span class="st">&quot;dashed&quot;</span>)</span></code></pre></div>
<p><img src="02-LikelihoodConfideceRegions_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># use uniroot to find the confidence bounds precisely</span></span>
<span id="cb61-2"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb61-3" aria-hidden="true" tabindex="-1"></a>my.function <span class="ot">&lt;-</span> <span class="cf">function</span>(my.lambda){</span>
<span id="cb61-4"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb61-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-5"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb61-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">horse.neg.ll</span>(<span class="fl">0.7</span>) <span class="sc">+</span> <span class="fu">qchisq</span>(<span class="fl">0.95</span>, <span class="at">df =</span> <span class="dv">1</span>) <span class="sc">/</span> <span class="dv">2</span> <span class="sc">-</span> <span class="fu">horse.neg.ll</span>(my.lambda)  </span>
<span id="cb61-6"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb61-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb61-7"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb61-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-8"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb61-8" aria-hidden="true" tabindex="-1"></a>(lower <span class="ot">&lt;-</span> <span class="fu">uniroot</span>(<span class="at">f =</span> my.function, <span class="at">interval =</span> <span class="fu">c</span>(<span class="fl">0.6</span>, <span class="fl">0.7</span>)))</span></code></pre></div>
<pre><code>## $root
## [1] 0.6065198
## 
## $f.root
## [1] -3.556854e-05
## 
## $iter
## [1] 4
## 
## $init.it
## [1] NA
## 
## $estim.prec
## [1] 6.103516e-05</code></pre>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb63-1" aria-hidden="true" tabindex="-1"></a>(upper <span class="ot">&lt;-</span> <span class="fu">uniroot</span>(<span class="at">f =</span> my.function, <span class="at">interval =</span> <span class="fu">c</span>(<span class="fl">0.7</span>, <span class="fl">0.9</span>)))</span></code></pre></div>
<pre><code>## $root
## [1] 0.8026265
## 
## $f.root
## [1] -0.0001007316
## 
## $iter
## [1] 6
## 
## $init.it
## [1] NA
## 
## $estim.prec
## [1] 6.103516e-05</code></pre>
<p>As an alternative programming style, we could have defined the objective function on the fly, and not bothered to create <code>my.function</code>.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb65-1" aria-hidden="true" tabindex="-1"></a>(lower <span class="ot">&lt;-</span> <span class="fu">uniroot</span>(<span class="at">f =</span> <span class="cf">function</span>(x) <span class="fu">horse.neg.ll</span>(<span class="fl">0.7</span>) <span class="sc">+</span> <span class="fu">qchisq</span>(<span class="fl">0.95</span>, <span class="at">df =</span> <span class="dv">1</span>) <span class="sc">/</span> <span class="dv">2</span> <span class="sc">-</span> <span class="fu">horse.neg.ll</span>(x) ,</span>
<span id="cb65-2"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb65-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">interval =</span> <span class="fu">c</span>(<span class="fl">0.6</span>, <span class="fl">0.7</span>)))</span></code></pre></div>
<pre><code>## $root
## [1] 0.6065198
## 
## $f.root
## [1] -3.556854e-05
## 
## $iter
## [1] 4
## 
## $init.it
## [1] NA
## 
## $estim.prec
## [1] 6.103516e-05</code></pre>
<p>Let’s recreate the plot and add vertical lines to indicate the confidence interval.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ll.vals <span class="sc">~</span> lambda.vals, <span class="at">xlab =</span> <span class="st">&quot;lambda&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;negative log likelihood&quot;</span>, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>)</span>
<span id="cb67-2"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> cutoff.ll, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lty =</span> <span class="st">&quot;dashed&quot;</span>)</span>
<span id="cb67-3"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="fu">c</span>(lower<span class="sc">$</span>root, upper<span class="sc">$</span>root), <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="02-LikelihoodConfideceRegions_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># clean up the workspace</span></span>
<span id="cb68-2"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span></code></pre></div>
<p>Thus, the 95% CI for <span class="math inline">\(\lambda\)</span> is <span class="math inline">\((0.607, 0.803)\)</span>.</p>
</div>
<div id="two-param-mle" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Confidence regions, profile likelihoods, and associated univariate intervals<a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#two-param-mle" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>With a 2-parameter model, we can plot a confidence region directly. First some housekeeping to get started:</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emdbook)</span>
<span id="cb69-2"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;ReedfrogFuncresp&quot;</span>)</span>
<span id="cb69-3"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb69-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-4"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="co"># rename something shorter</span></span>
<span id="cb69-5"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb69-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-6"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb69-6" aria-hidden="true" tabindex="-1"></a>frog <span class="ot">&lt;-</span> ReedfrogFuncresp</span>
<span id="cb69-7"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb69-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(ReedfrogFuncresp)</span>
<span id="cb69-8"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb69-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-9"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb69-9" aria-hidden="true" tabindex="-1"></a>frog.neg.ll <span class="ot">&lt;-</span> <span class="cf">function</span>(params){</span>
<span id="cb69-10"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb69-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb69-11"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb69-11" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;-</span> params[<span class="dv">1</span>]</span>
<span id="cb69-12"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb69-12" aria-hidden="true" tabindex="-1"></a>  h <span class="ot">&lt;-</span> params[<span class="dv">2</span>]</span>
<span id="cb69-13"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb69-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb69-14"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb69-14" aria-hidden="true" tabindex="-1"></a>  prob.vals <span class="ot">&lt;-</span> a <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> a <span class="sc">*</span> h <span class="sc">*</span> frog<span class="sc">$</span>Initial)</span>
<span id="cb69-15"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb69-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb69-16"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb69-16" aria-hidden="true" tabindex="-1"></a>  ll.vals <span class="ot">&lt;-</span> <span class="fu">dbinom</span>(frog<span class="sc">$</span>Killed, <span class="at">size =</span> frog<span class="sc">$</span>Initial, <span class="at">prob =</span> prob.vals, <span class="at">log =</span> <span class="cn">TRUE</span>)</span>
<span id="cb69-17"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb69-17" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> <span class="fu">sum</span>(ll.vals)</span>
<span id="cb69-18"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb69-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb69-19"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb69-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-20"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb69-20" aria-hidden="true" tabindex="-1"></a>(frog.mle <span class="ot">&lt;-</span> <span class="fu">optim</span>(<span class="at">par =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">60</span>),</span>
<span id="cb69-21"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb69-21" aria-hidden="true" tabindex="-1"></a>                   <span class="at">fn  =</span> frog.neg.ll))</span></code></pre></div>
<pre><code>## Warning in dbinom(frog$Killed, size = frog$Initial, prob = prob.vals, log =
## TRUE): NaNs produced</code></pre>
<pre><code>## $par
## [1] 0.52585566 0.01660104
## 
## $value
## [1] 46.72136
## 
## $counts
## function gradient 
##       61       NA 
## 
## $convergence
## [1] 0
## 
## $message
## NULL</code></pre>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb72-1" aria-hidden="true" tabindex="-1"></a>a.mle <span class="ot">&lt;-</span> frog.mle<span class="sc">$</span>par[<span class="dv">1</span>]</span>
<span id="cb72-2"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb72-2" aria-hidden="true" tabindex="-1"></a>h.mle <span class="ot">&lt;-</span> frog.mle<span class="sc">$</span>par[<span class="dv">2</span>]</span>
<span id="cb72-3"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb72-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-4"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plot negative likelihood contours</span></span>
<span id="cb72-5"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb72-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-6"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb72-6" aria-hidden="true" tabindex="-1"></a>a.vals <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.3</span>, <span class="at">to =</span> <span class="fl">0.75</span>, <span class="at">by =</span> <span class="fl">0.01</span>)</span>
<span id="cb72-7"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb72-7" aria-hidden="true" tabindex="-1"></a>h.vals <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.001</span>, <span class="at">to =</span> <span class="fl">0.03</span>, <span class="at">by =</span> <span class="fl">0.001</span>)</span>
<span id="cb72-8"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb72-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-9"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb72-9" aria-hidden="true" tabindex="-1"></a>ll.vals <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="fu">length</span>(a.vals), <span class="at">ncol =</span> <span class="fu">length</span>(h.vals))</span>
<span id="cb72-10"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb72-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-11"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb72-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i.a <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(a.vals)) {</span>
<span id="cb72-12"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb72-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i.h <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(h.vals)) {</span>
<span id="cb72-13"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb72-13" aria-hidden="true" tabindex="-1"></a>    ll.vals[i.a, i.h] <span class="ot">&lt;-</span> <span class="fu">frog.neg.ll</span>(<span class="fu">c</span>(a.vals[i.a], h.vals[i.h]))</span>
<span id="cb72-14"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb72-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb72-15"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb72-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb72-16"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb72-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-17"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb72-17" aria-hidden="true" tabindex="-1"></a><span class="fu">contour</span>(<span class="at">x =</span> a.vals, <span class="at">y =</span> h.vals, <span class="at">z =</span> ll.vals, <span class="at">nlevels =</span> <span class="dv">100</span>,</span>
<span id="cb72-18"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb72-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">&quot;a&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;h&quot;</span>)</span>
<span id="cb72-19"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb72-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-20"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb72-20" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="at">x =</span> a.mle, <span class="at">y =</span> h.mle, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="02-LikelihoodConfideceRegions_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>Equipped with the contour plot, graphing the appropriate confidence region is straightforward.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb73-1" aria-hidden="true" tabindex="-1"></a>cut.off <span class="ot">&lt;-</span> <span class="fu">frog.neg.ll</span>(<span class="fu">c</span>(a.mle, h.mle)) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">*</span> <span class="fu">qchisq</span>(.<span class="dv">95</span>, <span class="at">df =</span> <span class="dv">2</span>)</span>
<span id="cb73-2"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="co"># recreate the plot and add a line for the 95% confidence region</span></span>
<span id="cb73-4"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="fu">contour</span>(<span class="at">x =</span> a.vals, <span class="at">y =</span> h.vals, <span class="at">z =</span> ll.vals, <span class="at">nlevels =</span> <span class="dv">100</span>,</span>
<span id="cb73-5"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb73-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">&quot;a&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;h&quot;</span>)</span>
<span id="cb73-6"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb73-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-7"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb73-7" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="at">x =</span> a.mle, <span class="at">y =</span> h.mle, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb73-8"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb73-8" aria-hidden="true" tabindex="-1"></a><span class="fu">contour</span>(<span class="at">x =</span> a.vals, <span class="at">y =</span> h.vals, <span class="at">z =</span> ll.vals, </span>
<span id="cb73-9"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb73-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">levels =</span> cut.off,</span>
<span id="cb73-10"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb73-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="02-LikelihoodConfideceRegions_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>However, there are several drawbacks to confidence regions. First, while a two-dimensional confidence region can be readily visualized, it is hard to summarize or describe. Second, and more importantly, most models have more than two parameters. In these models, a confidence region would have more than 2 dimensions, and thus would be impractical to visualize. Thus it is helpful, or even essential, to be able to generate univariate confidence intervals for single parameters from high-dimensional likelihoods. One approach to doing so is to calculate the so-called profile likelihood for a given parameter, and then to derive the univariate interval from this profile likelihood. We will illustrate this approach by computing a profile-based confidence interval for the attack rate <span class="math inline">\(a\)</span> in the tadpole data.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># profile log-likelihood function for the attack rate a</span></span>
<span id="cb74-2"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb74-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb74-3" aria-hidden="true" tabindex="-1"></a>profile.ll <span class="ot">&lt;-</span> <span class="cf">function</span>(my.a) {</span>
<span id="cb74-4"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb74-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb74-5"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb74-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate the minimum log likelihood value for a given value of a, the attack rate</span></span>
<span id="cb74-6"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb74-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb74-7"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb74-7" aria-hidden="true" tabindex="-1"></a>  my.ll <span class="ot">&lt;-</span> <span class="cf">function</span>(h) <span class="fu">frog.neg.ll</span>(<span class="fu">c</span>(my.a, h))</span>
<span id="cb74-8"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb74-8" aria-hidden="true" tabindex="-1"></a>  my.profile <span class="ot">&lt;-</span> <span class="fu">optimize</span>(<span class="at">f =</span> my.ll, <span class="at">interval =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.03</span>), <span class="at">maximum =</span> <span class="cn">FALSE</span>)</span>
<span id="cb74-9"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb74-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb74-10"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb74-10" aria-hidden="true" tabindex="-1"></a>  my.profile<span class="sc">$</span>objective</span>
<span id="cb74-11"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb74-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb74-12"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb74-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-13"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb74-13" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the profile likelihood vs. a</span></span>
<span id="cb74-14"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb74-14" aria-hidden="true" tabindex="-1"></a><span class="co"># not necessary for finding the CI, but useful for understanding</span></span>
<span id="cb74-15"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb74-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-16"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb74-16" aria-hidden="true" tabindex="-1"></a>a.values <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.3</span>, <span class="at">to =</span> <span class="fl">0.8</span>, <span class="at">by =</span> <span class="fl">0.01</span>)</span>
<span id="cb74-17"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb74-17" aria-hidden="true" tabindex="-1"></a>a.profile <span class="ot">&lt;-</span> <span class="fu">double</span>(<span class="at">length =</span> <span class="fu">length</span>(a.values))</span>
<span id="cb74-18"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb74-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-19"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb74-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(a.values)) {</span>
<span id="cb74-20"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb74-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb74-21"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb74-21" aria-hidden="true" tabindex="-1"></a>  a.profile[i] <span class="ot">&lt;-</span> <span class="fu">profile.ll</span>(a.values[i])</span>
<span id="cb74-22"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb74-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb74-23"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb74-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-24"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb74-24" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> a.values, <span class="at">y =</span> a.profile, <span class="at">xlab =</span> <span class="st">&quot;a&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;negative log-likelihood&quot;</span>, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>)</span></code></pre></div>
<p><img src="02-LikelihoodConfideceRegions_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>Now we’ll follow the same steps as before to compute the profile-based 95% CI.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now follow the same steps as before to find the profile 95% CI</span></span>
<span id="cb75-2"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb75-3" aria-hidden="true" tabindex="-1"></a>cut.off <span class="ot">&lt;-</span> <span class="fu">profile.ll</span>(a.mle) <span class="sc">+</span> <span class="fu">qchisq</span>(<span class="fl">0.95</span>, <span class="at">df =</span> <span class="dv">1</span>) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb75-4"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb75-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-5"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb75-5" aria-hidden="true" tabindex="-1"></a>(lower <span class="ot">&lt;-</span> <span class="fu">uniroot</span>(<span class="at">f =</span> <span class="cf">function</span>(x) cut.off <span class="sc">-</span> <span class="fu">profile.ll</span>(x) ,</span>
<span id="cb75-6"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb75-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">interval =</span> <span class="fu">c</span>(<span class="fl">0.3</span>, a.mle)))</span></code></pre></div>
<pre><code>## $root
## [1] 0.4024268
## 
## $f.root
## [1] -0.0001303772
## 
## $iter
## [1] 6
## 
## $init.it
## [1] NA
## 
## $estim.prec
## [1] 6.103516e-05</code></pre>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb77-1" aria-hidden="true" tabindex="-1"></a>(upper <span class="ot">&lt;-</span> <span class="fu">uniroot</span>(<span class="at">f =</span> <span class="cf">function</span>(x) cut.off <span class="sc">-</span> <span class="fu">profile.ll</span>(x) ,</span>
<span id="cb77-2"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb77-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">interval =</span> <span class="fu">c</span>(a.mle, <span class="fl">0.8</span>)))</span></code></pre></div>
<pre><code>## $root
## [1] 0.6824678
## 
## $f.root
## [1] -9.763258e-06
## 
## $iter
## [1] 6
## 
## $init.it
## [1] NA
## 
## $estim.prec
## [1] 6.103516e-05</code></pre>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> a.values, <span class="at">y =</span> a.profile, <span class="at">xlab =</span> <span class="st">&quot;a&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;negative log-likelihood&quot;</span>, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>)</span>
<span id="cb79-2"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="fu">c</span>(lower<span class="sc">$</span>root, upper<span class="sc">$</span>root), <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb79-3"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> cut.off, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">lty =</span> <span class="st">&quot;dashed&quot;</span>)</span></code></pre></div>
<p><img src="02-LikelihoodConfideceRegions_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>So, the 95% profile CI for <span class="math inline">\(a\)</span> is (0.402, 0.682).</p>
</div>
<div id="locally-quadratic-approximations-to-confidence-intervals-and-regions" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Locally quadratic approximations to confidence intervals and regions<a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#locally-quadratic-approximations-to-confidence-intervals-and-regions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Likelihood profiling provides a straightforward way to summarize a high-dimensional confidence region by univariate confidence intervals. However, these profile intervals can still involve quite a bit of computation. Further, they are not able to capture possible correlations among parameter estimates, which are revealed in (two-dimensional) confidence regions. (Recall the shape of the joint confidence region for the parameters <span class="math inline">\(a\)</span> and <span class="math inline">\(h\)</span> in the tadpole data.) Locally quadratic approximations provide a way to approximate the (already approximate) univariate confidence intervals and bivariate confidence regions using only information about the curvature of the likelihood surface at the MLE.</p>
<p>We’ll first start by revisiting the horse-kick data again. Of course, with the more precise <span class="math inline">\(\chi^2\)</span> based confidence interval in hand, there is no reason to seek an approximation. But doing so allows us to illustrate the calculations involved, and to see how well the approximation fares in this case.</p>
<p>First some housekeepign to read the data into memory, etc.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># clean up</span></span>
<span id="cb80-2"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb80-3"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb80-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-4"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="co"># read in the data</span></span>
<span id="cb80-5"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb80-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-6"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb80-6" aria-hidden="true" tabindex="-1"></a>horse <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;data/horse.txt&quot;</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb80-7"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb80-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-8"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb80-8" aria-hidden="true" tabindex="-1"></a>horse.neg.ll <span class="ot">&lt;-</span> <span class="cf">function</span>(my.lambda) {</span>
<span id="cb80-9"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb80-9" aria-hidden="true" tabindex="-1"></a>  ll.vals <span class="ot">&lt;-</span> <span class="fu">dpois</span>(<span class="at">x =</span> horse<span class="sc">$</span>deaths, <span class="at">lambda =</span> my.lambda, <span class="at">log =</span> <span class="cn">TRUE</span>)</span>
<span id="cb80-10"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb80-10" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> <span class="fu">sum</span>(ll.vals) </span>
<span id="cb80-11"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb80-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb80-12"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb80-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-13"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb80-13" aria-hidden="true" tabindex="-1"></a><span class="co"># use uniroot to find the confidence bounds precisely</span></span>
<span id="cb80-14"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb80-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-15"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb80-15" aria-hidden="true" tabindex="-1"></a>my.function <span class="ot">&lt;-</span> <span class="cf">function</span>(my.lambda){</span>
<span id="cb80-16"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb80-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-17"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb80-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">horse.neg.ll</span>(<span class="fl">0.7</span>) <span class="sc">+</span> <span class="fu">qchisq</span>(<span class="fl">0.95</span>, <span class="at">df =</span> <span class="dv">1</span>) <span class="sc">/</span> <span class="dv">2</span> <span class="sc">-</span> <span class="fu">horse.neg.ll</span>(my.lambda)  </span>
<span id="cb80-18"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb80-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb80-19"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb80-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-20"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb80-20" aria-hidden="true" tabindex="-1"></a>lower <span class="ot">&lt;-</span> <span class="fu">uniroot</span>(<span class="at">f =</span> my.function, <span class="at">interval =</span> <span class="fu">c</span>(<span class="fl">0.6</span>, <span class="fl">0.7</span>))</span>
<span id="cb80-21"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb80-21" aria-hidden="true" tabindex="-1"></a>upper <span class="ot">&lt;-</span> <span class="fu">uniroot</span>(<span class="at">f =</span> my.function, <span class="at">interval =</span> <span class="fu">c</span>(<span class="fl">0.7</span>, <span class="fl">0.9</span>))</span></code></pre></div>
<p>Now we will proceed to use a locally quadratic approximation to the negative log likelihood.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="do">## this function finds the second derivative at the MLE by finite differences</span></span>
<span id="cb81-2"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb81-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-3"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb81-3" aria-hidden="true" tabindex="-1"></a>second.deriv <span class="ot">&lt;-</span> <span class="cf">function</span>(delta.l) {</span>
<span id="cb81-4"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb81-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-5"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb81-5" aria-hidden="true" tabindex="-1"></a>  (<span class="fu">horse.neg.ll</span>(<span class="fl">0.7</span> <span class="sc">+</span> delta.l) <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">horse.neg.ll</span>(<span class="fl">0.7</span>) <span class="sc">+</span> <span class="fu">horse.neg.ll</span>(<span class="fl">0.7</span> <span class="sc">-</span> delta.l)) <span class="sc">/</span> delta.l <span class="sc">^</span> <span class="dv">2</span></span>
<span id="cb81-6"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb81-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb81-7"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb81-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-8"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb81-8" aria-hidden="true" tabindex="-1"></a>(horse.D2 <span class="ot">&lt;-</span> <span class="fu">second.deriv</span>(<span class="fl">1e-04</span>))</span></code></pre></div>
<pre><code>## [1] 400</code></pre>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># see how the answer changes if we change delta</span></span>
<span id="cb83-2"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">second.deriv</span>(<span class="fl">1e-05</span>)</span></code></pre></div>
<pre><code>## [1] 400.0003</code></pre>
<p>Let’s compare this answer to the answer obtained by <code>numDeriv::hessian</code>.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb85-1" aria-hidden="true" tabindex="-1"></a>numDeriv<span class="sc">::</span><span class="fu">hessian</span>(<span class="at">func =</span> horse.neg.ll, <span class="at">x =</span> <span class="fl">0.7</span>)</span></code></pre></div>
<pre><code>##      [,1]
## [1,]  400</code></pre>
<p>The approximate standard error of <span class="math inline">\(\hat{\lambda}\)</span> is the square root of the inverse of the second derivative of the likelihood function.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb87-1" aria-hidden="true" tabindex="-1"></a>(lambda.se <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">/</span> horse.D2))</span></code></pre></div>
<pre><code>## [1] 0.05</code></pre>
<p>Now we can approximate the 95% confidence interval by using critical values from a standard normal distribution.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb89-1" aria-hidden="true" tabindex="-1"></a>(lower.approx <span class="ot">&lt;-</span> <span class="fl">0.7</span> <span class="sc">-</span> <span class="fu">qnorm</span>(.<span class="dv">975</span>) <span class="sc">*</span> lambda.se)</span></code></pre></div>
<pre><code>## [1] 0.6020018</code></pre>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb91-1" aria-hidden="true" tabindex="-1"></a>(upper.approx <span class="ot">&lt;-</span> <span class="fl">0.7</span> <span class="sc">+</span> <span class="fu">qnorm</span>(.<span class="dv">975</span>) <span class="sc">*</span> lambda.se)</span></code></pre></div>
<pre><code>## [1] 0.7979982</code></pre>
<p>Compare the approximation to the “exact” values</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb93-1" aria-hidden="true" tabindex="-1"></a>lower<span class="sc">$</span>root</span></code></pre></div>
<pre><code>## [1] 0.6065198</code></pre>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb95-1" aria-hidden="true" tabindex="-1"></a>upper<span class="sc">$</span>root</span></code></pre></div>
<pre><code>## [1] 0.8026265</code></pre>
<p>Make a plot</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a vector of lambda values using the &#39;seq&#39;uence command</span></span>
<span id="cb97-2"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb97-2" aria-hidden="true" tabindex="-1"></a>lambda.vals <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.5</span>, <span class="at">to =</span> <span class="fl">1.0</span>, <span class="at">by =</span> <span class="fl">0.01</span>)</span>
<span id="cb97-3"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb97-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-4"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb97-4" aria-hidden="true" tabindex="-1"></a><span class="co"># create an empty vector to store the values of the log-likelihood</span></span>
<span id="cb97-5"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb97-5" aria-hidden="true" tabindex="-1"></a>ll.vals <span class="ot">&lt;-</span> <span class="fu">double</span>(<span class="at">length =</span> <span class="fu">length</span>(lambda.vals))</span>
<span id="cb97-6"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb97-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-7"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb97-7" aria-hidden="true" tabindex="-1"></a><span class="co"># use a loop to find the log-likelihood for each value in lambda.vals</span></span>
<span id="cb97-8"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb97-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i.lambda <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(lambda.vals)) {</span>
<span id="cb97-9"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb97-9" aria-hidden="true" tabindex="-1"></a>  ll.vals[i.lambda] <span class="ot">&lt;-</span> <span class="fu">horse.neg.ll</span>(lambda.vals[i.lambda])</span>
<span id="cb97-10"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb97-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb97-11"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb97-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-12"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb97-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ll.vals <span class="sc">~</span> lambda.vals, <span class="at">xlab =</span> <span class="st">&quot;lambda&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;negative log likelihood&quot;</span>, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>)</span>
<span id="cb97-13"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb97-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-14"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb97-14" aria-hidden="true" tabindex="-1"></a><span class="do">###################################</span></span>
<span id="cb97-15"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb97-15" aria-hidden="true" tabindex="-1"></a><span class="do">## Now find the confidence interval, and plot it</span></span>
<span id="cb97-16"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb97-16" aria-hidden="true" tabindex="-1"></a><span class="do">####################################</span></span>
<span id="cb97-17"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb97-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-18"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb97-18" aria-hidden="true" tabindex="-1"></a>cutoff.ll <span class="ot">&lt;-</span> <span class="fu">horse.neg.ll</span>(<span class="fl">0.7</span>) <span class="sc">+</span> <span class="fu">qchisq</span>(<span class="fl">0.95</span>, <span class="at">df =</span> <span class="dv">1</span>) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb97-19"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb97-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-20"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb97-20" aria-hidden="true" tabindex="-1"></a><span class="co"># add a line to the plot</span></span>
<span id="cb97-21"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb97-21" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> cutoff.ll, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lty =</span> <span class="st">&quot;dashed&quot;</span>)</span>
<span id="cb97-22"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb97-22" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="fu">c</span>(lower<span class="sc">$</span>root, upper<span class="sc">$</span>root), <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb97-23"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb97-23" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="fu">c</span>(lower.approx, upper.approx), <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb97-24"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb97-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-25"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb97-25" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="at">x =</span> <span class="fl">0.65</span>, <span class="at">y =</span> <span class="dv">326</span>, </span>
<span id="cb97-26"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb97-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">leg =</span> <span class="fu">c</span>(<span class="st">&quot;exact&quot;</span>, <span class="st">&quot;approximate&quot;</span>), </span>
<span id="cb97-27"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb97-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">16</span>, </span>
<span id="cb97-28"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb97-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>),</span>
<span id="cb97-29"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb97-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span></code></pre></div>
<p><img src="02-LikelihoodConfideceRegions_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># clean up</span></span>
<span id="cb98-2"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span></code></pre></div>
<p>Notice that the full <span class="math inline">\(\chi^2\)</span>-based confidence intervals capture the asymmetry in the information about <span class="math inline">\(\lambda\)</span>. The intervals based on the quadratic approximation are symmetric.</p>
<p>Now, use the quadratic approximation to find standard errors for <span class="math inline">\(\hat{a}\)</span> and <span class="math inline">\(\hat{h}\)</span> in the tadpole predation data.</p>
<p>The first part is preparatory work from old classes.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emdbook)</span>
<span id="cb99-2"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;ReedfrogFuncresp&quot;</span>)</span>
<span id="cb99-3"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb99-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-4"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb99-4" aria-hidden="true" tabindex="-1"></a><span class="co"># rename something shorter</span></span>
<span id="cb99-5"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb99-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-6"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb99-6" aria-hidden="true" tabindex="-1"></a>frog <span class="ot">&lt;-</span> ReedfrogFuncresp</span>
<span id="cb99-7"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb99-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(ReedfrogFuncresp)</span>
<span id="cb99-8"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb99-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-9"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb99-9" aria-hidden="true" tabindex="-1"></a>frog.neg.ll <span class="ot">&lt;-</span> <span class="cf">function</span>(params){</span>
<span id="cb99-10"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb99-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb99-11"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb99-11" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;-</span> params[<span class="dv">1</span>]</span>
<span id="cb99-12"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb99-12" aria-hidden="true" tabindex="-1"></a>  h <span class="ot">&lt;-</span> params[<span class="dv">2</span>]</span>
<span id="cb99-13"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb99-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb99-14"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb99-14" aria-hidden="true" tabindex="-1"></a>  prob.vals <span class="ot">&lt;-</span> a <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> a <span class="sc">*</span> h <span class="sc">*</span> frog<span class="sc">$</span>Initial)</span>
<span id="cb99-15"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb99-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb99-16"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb99-16" aria-hidden="true" tabindex="-1"></a>  ll.vals <span class="ot">&lt;-</span> <span class="fu">dbinom</span>(frog<span class="sc">$</span>Killed, <span class="at">size =</span> frog<span class="sc">$</span>Initial, <span class="at">prob =</span> prob.vals, <span class="at">log =</span> <span class="cn">TRUE</span>)</span>
<span id="cb99-17"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb99-17" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> <span class="fu">sum</span>(ll.vals)</span>
<span id="cb99-18"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb99-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb99-19"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb99-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-20"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb99-20" aria-hidden="true" tabindex="-1"></a>frog.mle <span class="ot">&lt;-</span> <span class="fu">optim</span>(<span class="at">par =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">60</span>),</span>
<span id="cb99-21"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb99-21" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fn  =</span> frog.neg.ll)</span></code></pre></div>
<pre><code>## Warning in dbinom(frog$Killed, size = frog$Initial, prob = prob.vals, log =
## TRUE): NaNs produced</code></pre>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb101-1" aria-hidden="true" tabindex="-1"></a>(a.mle <span class="ot">&lt;-</span> frog.mle<span class="sc">$</span>par[<span class="dv">1</span>])</span></code></pre></div>
<pre><code>## [1] 0.5258557</code></pre>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb103-1" aria-hidden="true" tabindex="-1"></a>(h.mle <span class="ot">&lt;-</span> frog.mle<span class="sc">$</span>par[<span class="dv">2</span>])</span></code></pre></div>
<pre><code>## [1] 0.01660104</code></pre>
<p>Now find the hessian:</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb105-1" aria-hidden="true" tabindex="-1"></a>(D2 <span class="ot">&lt;-</span> numDeriv<span class="sc">::</span><span class="fu">hessian</span>(<span class="at">func =</span> frog.neg.ll, <span class="at">x =</span> <span class="fu">c</span>(a.mle, h.mle)))</span></code></pre></div>
<pre><code>##            [,1]       [,2]
## [1,]   616.5606  -7394.263
## [2,] -7394.2628 130640.685</code></pre>
<p>The matrix inverse of the hessian is the variance-covariance matrix of the parameters. Note that R uses the function <code>solve</code> to find the inverse of a matrix.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co"># invert to get var-cov matrix</span></span>
<span id="cb107-2"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb107-2" aria-hidden="true" tabindex="-1"></a>(var.matrix <span class="ot">&lt;-</span> <span class="fu">solve</span>(D2))</span></code></pre></div>
<pre><code>##              [,1]         [,2]
## [1,] 0.0050493492 2.857932e-04
## [2,] 0.0002857932 2.383048e-05</code></pre>
<p>We can use the handy <code>cov2cor</code> function to convert the variance matrix into a correlation matrix:</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cov2cor</span>(var.matrix)</span></code></pre></div>
<pre><code>##           [,1]      [,2]
## [1,] 1.0000000 0.8238872
## [2,] 0.8238872 1.0000000</code></pre>
<p>Note the large correlation between <span class="math inline">\(\hat{a}\)</span> and <span class="math inline">\(\hat{h}\)</span>. Compare with Figure 6.13 of Bolker.</p>
<p>The standard errors of <span class="math inline">\(\hat{a}\)</span> and <span class="math inline">\(\hat{h}\)</span> are the square roots of the diagaonal elements of the variance-covariance matrix.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb111-1" aria-hidden="true" tabindex="-1"></a>(a.se <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(var.matrix[<span class="dv">1</span>, <span class="dv">1</span>]))</span></code></pre></div>
<pre><code>## [1] 0.07105877</code></pre>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb113-1" aria-hidden="true" tabindex="-1"></a>(h.se <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(var.matrix[<span class="dv">2</span>, <span class="dv">2</span>]))</span></code></pre></div>
<pre><code>## [1] 0.004881647</code></pre>
<p>Note the large correlation between <span class="math inline">\(\hat{a}\)</span> and <span class="math inline">\(\hat{h}\)</span>.</p>
<p>Let’s use the (approximate) standard error of <span class="math inline">\(\hat{a}\)</span> to calculate an (approximate) 95% confidence interval:</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb115-1" aria-hidden="true" tabindex="-1"></a>(ci.approx <span class="ot">&lt;-</span> a.mle <span class="sc">+</span> <span class="fu">qnorm</span>(<span class="fu">c</span>(<span class="fl">0.025</span>, .<span class="dv">975</span>)) <span class="sc">*</span> a.se)</span></code></pre></div>
<pre><code>## [1] 0.3865830 0.6651283</code></pre>
<p>Recall that the 95% confidence interval we calculated by the profile likelihood was <span class="math inline">\((0.402, 0.682)\)</span>. So the quadratic approximation has gotten the width of the interval more or less correct, but it has fared less at capturing the asymmetry of the interval.</p>
</div>
<div id="comparing-models-likelihood-ratio-test-and-aic" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> Comparing models: Likelihood ratio test and AIC<a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#comparing-models-likelihood-ratio-test-and-aic" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Obtaining a parsimonious statistical description of data often requires arbitrating between competing model fits. Likelihood provides two tools for comparing models: likelihood ratio tests (LRTs) and information criteria. Of the latter, the best known information criterion is due to Akaike, and takes the name AIC. (Akaike didn’t name AIC after himself; he used AIC to refer to “An information criterion”. In his honor, the acronym is now largely taken to stand for “Akaike’s information criterion”.)</p>
<p>LRTs and information criteria have complementary strengths and weaknesses. LRTs are direct, head-to-head comparisons of nested models. By “nested”, we mean that one model can be obtained as a special case of the other. The “reduced”, or less flexible (and thus more parsimonious) model plays the role of the null hypothesis, and the “full”, or more flexible (and thus less parsimonious) model plays the role of the alternative hypothesis. The LRT then formally evaluates whether the improvement in fit offered by the full model is statistically significant, that is, greater than what we would expect merely by chance.</p>
<p>On the other hand, information criteria provide a penalized goodness-of-fit measure that can be used to compare many models at once. Information criteria produce a ranking of model fits, and thus a best-fitting model. The downside to information criteria is that there are no hard and fast guidelines to determine when one model provides a significantly better fit than another. The properties of information criteria are also less well understood than the properties of LRTs.</p>
<p>To illustrate both, we will use the study of cone production by fir trees studied in <span class="math inline">\(\S\)</span> 6.6 of Bolker. These data are originally from work by Dodd and Silvertown. The data are much richer than we will examine here. Like Bolker, we will focus on whether the relationship between tree size (as measured by diameter at breast height, or dbh) and the number of cones produces differs between populations that “have experienced wave-like die-offs” and those that have not.</p>
<p>First some preparatory work to import and assemble the data:</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(emdbook)</span>
<span id="cb117-2"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;FirDBHFec&quot;</span>)</span>
<span id="cb117-3"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb117-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-4"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb117-4" aria-hidden="true" tabindex="-1"></a><span class="co"># give the data a simpler name</span></span>
<span id="cb117-5"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb117-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-6"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb117-6" aria-hidden="true" tabindex="-1"></a>fir <span class="ot">&lt;-</span> FirDBHFec</span>
<span id="cb117-7"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb117-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(FirDBHFec)</span>
<span id="cb117-8"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb117-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-9"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb117-9" aria-hidden="true" tabindex="-1"></a>fir <span class="ot">&lt;-</span> fir[, <span class="fu">c</span>(<span class="st">&quot;WAVE_NON&quot;</span>, <span class="st">&quot;DBH&quot;</span>, <span class="st">&quot;TOTCONES&quot;</span>)]  <span class="co"># select just the variables we want</span></span>
<span id="cb117-10"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb117-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-11"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb117-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fir)</span></code></pre></div>
<pre><code>##  WAVE_NON      DBH            TOTCONES    
##  n:166    Min.   : 3.200   Min.   :  0.0  
##  w:205    1st Qu.: 6.400   1st Qu.: 14.0  
##           Median : 7.600   Median : 36.0  
##           Mean   : 8.169   Mean   : 49.9  
##           3rd Qu.: 9.700   3rd Qu.: 66.0  
##           Max.   :17.400   Max.   :297.0  
##           NA&#39;s   :26       NA&#39;s   :114</code></pre>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(fir) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;wave&quot;</span>, <span class="st">&quot;dbh&quot;</span>, <span class="st">&quot;cones&quot;</span>)  <span class="co"># rename the variables</span></span>
<span id="cb119-2"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb119-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-3"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb119-3" aria-hidden="true" tabindex="-1"></a><span class="co"># get rid of the incomplete records</span></span>
<span id="cb119-4"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb119-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-5"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb119-5" aria-hidden="true" tabindex="-1"></a>fir <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(fir)</span>
<span id="cb119-6"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb119-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-7"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb119-7" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb119-8"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb119-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-9"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb119-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cones <span class="sc">~</span> dbh, <span class="at">data =</span> fir, <span class="at">type =</span> <span class="st">&quot;n&quot;</span>, <span class="at">main =</span> <span class="st">&quot;wave&quot;</span>)</span>
<span id="cb119-10"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb119-10" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(cones <span class="sc">~</span> dbh, <span class="at">data =</span> <span class="fu">subset</span>(fir, wave <span class="sc">==</span> <span class="st">&quot;w&quot;</span>))</span>
<span id="cb119-11"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb119-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-12"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb119-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cones <span class="sc">~</span> dbh, <span class="at">data =</span> fir, <span class="at">type =</span> <span class="st">&quot;n&quot;</span>, <span class="at">main =</span> <span class="st">&quot;non-wave&quot;</span>)</span>
<span id="cb119-13"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb119-13" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(cones <span class="sc">~</span> dbh, <span class="at">data =</span> <span class="fu">subset</span>(fir, wave <span class="sc">==</span> <span class="st">&quot;n&quot;</span>))</span></code></pre></div>
<p><img src="02-LikelihoodConfideceRegions_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co"># any non-integral responses?</span></span>
<span id="cb120-2"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb120-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-3"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb120-3" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(fir, <span class="fu">table</span>(cones <span class="sc">==</span> <span class="fu">round</span>(cones)))  <span class="co"># illustrate the use of &#39;with&#39;</span></span></code></pre></div>
<pre><code>## 
## FALSE  TRUE 
##     6   236</code></pre>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co"># round the non-integral values</span></span>
<span id="cb122-2"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb122-2" aria-hidden="true" tabindex="-1"></a>fir<span class="sc">$</span>cones <span class="ot">&lt;-</span> <span class="fu">round</span>(fir<span class="sc">$</span>cones)</span>
<span id="cb122-3"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb122-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-4"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb122-4" aria-hidden="true" tabindex="-1"></a><span class="co"># check</span></span>
<span id="cb122-5"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb122-5" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(fir, <span class="fu">table</span>(cones <span class="sc">==</span> <span class="fu">round</span>(cones)))</span></code></pre></div>
<pre><code>## 
## TRUE 
##  242</code></pre>
<p>Like Bolker, we will assume that the average number of cones produced (<span class="math inline">\(\mu\)</span>) has a power-law relationship with tree dbh (<span class="math inline">\(x\)</span>). We will also assume that the actual number of cones produced (<span class="math inline">\(Y\)</span>) takes a negative binomial distribution with size-dependent mean and overdispersion parameter <span class="math inline">\(k\)</span>. That is, our model is
<span class="math display">\[\begin{align*}
\mu(x) &amp; = a x ^ b \\
Y &amp; \sim \mbox{NB}(\mu(x), k)
\end{align*}\]</span></p>
<p>To head in a slightly different direction from Bolker, we will compare two models. In the first, or reduced, model the same parameters will prevail for both wave and non-wave populations. Thus this model has three parameters: <span class="math inline">\(a\)</span>, <span class="math inline">\(b\)</span>, and <span class="math inline">\(k\)</span>. In the second, or full, model, we will allow the <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> parameters to differ between the wave and non-wave populations. (We will continue to assume a common <span class="math inline">\(k\)</span> for both population types.) Using subscripts on <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> to distinguish population types, the full model then has 5 parameters: <span class="math inline">\(a_w\)</span>, <span class="math inline">\(a_n\)</span>, <span class="math inline">\(b_w\)</span>, <span class="math inline">\(b_n\)</span>, and <span class="math inline">\(k\)</span>. We’ll fit the reduced model first. To do so, we’ll use the <code>dnbinom</code> function in R, in which the <span class="math inline">\(k\)</span> parameter is located in the formal argument “size”.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb124-1" aria-hidden="true" tabindex="-1"></a>fir.neg.ll <span class="ot">&lt;-</span> <span class="cf">function</span>(parms, x, y){</span>
<span id="cb124-2"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb124-2" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb124-3"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb124-3" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;-</span> parms[<span class="dv">1</span>]</span>
<span id="cb124-4"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb124-4" aria-hidden="true" tabindex="-1"></a>  b <span class="ot">&lt;-</span> parms[<span class="dv">2</span>]</span>
<span id="cb124-5"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb124-5" aria-hidden="true" tabindex="-1"></a>  k <span class="ot">&lt;-</span> parms[<span class="dv">3</span>]</span>
<span id="cb124-6"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb124-6" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb124-7"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb124-7" aria-hidden="true" tabindex="-1"></a>  my.mu <span class="ot">&lt;-</span> a <span class="sc">*</span> x<span class="sc">^</span>b</span>
<span id="cb124-8"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb124-8" aria-hidden="true" tabindex="-1"></a>  ll.values <span class="ot">&lt;-</span> <span class="fu">dnbinom</span>(y, <span class="at">size =</span> k, <span class="at">mu =</span> my.mu, <span class="at">log =</span> <span class="cn">TRUE</span>)</span>
<span id="cb124-9"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb124-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb124-10"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb124-10" aria-hidden="true" tabindex="-1"></a>  neg.ll <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> <span class="fu">sum</span>(ll.values)</span>
<span id="cb124-11"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb124-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(neg.ll)</span>
<span id="cb124-12"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb124-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Note a subtle difference here. In preparation for fitting this same model to different subsets of the data, the function <code>fir.neg.ll</code> has formal arguments that receive the values of the <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> variables. In the call to <code>optim</code>, we can supply those additional values as subsequent arguments in the <code>optim</code> function, as illustrated below.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fit reduced model</span></span>
<span id="cb125-2"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb125-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-3"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb125-3" aria-hidden="true" tabindex="-1"></a>(fir.reduced <span class="ot">&lt;-</span> <span class="fu">optim</span>(<span class="at">f   =</span> fir.neg.ll,</span>
<span id="cb125-4"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb125-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">par =</span> <span class="fu">c</span>(<span class="at">a =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">1</span>, <span class="at">k =</span> <span class="dv">1</span>),</span>
<span id="cb125-5"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb125-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">x   =</span> fir<span class="sc">$</span>dbh,</span>
<span id="cb125-6"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb125-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">y   =</span> fir<span class="sc">$</span>cones))</span></code></pre></div>
<pre><code>## $par
##         a         b         k 
## 0.3041425 2.3190142 1.5033525 
## 
## $value
## [1] 1136.015
## 
## $counts
## function gradient 
##      134       NA 
## 
## $convergence
## [1] 0
## 
## $message
## NULL</code></pre>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb127-1" aria-hidden="true" tabindex="-1"></a>a.mle <span class="ot">&lt;-</span> fir.reduced<span class="sc">$</span>par[<span class="dv">1</span>]</span>
<span id="cb127-2"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb127-2" aria-hidden="true" tabindex="-1"></a>b.mle <span class="ot">&lt;-</span> fir.reduced<span class="sc">$</span>par[<span class="dv">2</span>]</span>
<span id="cb127-3"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb127-3" aria-hidden="true" tabindex="-1"></a>k.mle <span class="ot">&lt;-</span> fir.reduced<span class="sc">$</span>par[<span class="dv">3</span>]</span></code></pre></div>
<p>Make a plot of the reduced model fit, with both populations pooled together:</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb128-1" aria-hidden="true" tabindex="-1"></a>dbh.vals <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(fir<span class="sc">$</span>dbh), <span class="at">to =</span> <span class="fu">max</span>(fir<span class="sc">$</span>dbh), <span class="at">length =</span> <span class="dv">100</span>)</span>
<span id="cb128-2"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb128-2" aria-hidden="true" tabindex="-1"></a>fit.vals <span class="ot">&lt;-</span> <span class="fu">double</span>(<span class="at">length =</span> <span class="fu">length</span>(dbh.vals))</span>
<span id="cb128-3"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb128-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-4"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb128-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq</span>(<span class="at">along =</span> dbh.vals)) {</span>
<span id="cb128-5"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb128-5" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb128-6"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb128-6" aria-hidden="true" tabindex="-1"></a>  fit.vals[i] <span class="ot">&lt;-</span> a.mle <span class="sc">*</span> dbh.vals[i] <span class="sc">^</span> b.mle  </span>
<span id="cb128-7"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb128-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb128-8"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb128-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-9"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb128-9" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))  <span class="co"># don&#39;t break the next figure into two panels</span></span>
<span id="cb128-10"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb128-10" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(fir, <span class="fu">plot</span>(cones <span class="sc">~</span> dbh))  <span class="co"># plot the data points</span></span>
<span id="cb128-11"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb128-11" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(fit.vals <span class="sc">~</span> dbh.vals, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)  </span></code></pre></div>
<p><img src="02-LikelihoodConfideceRegions_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<p>Now fit the full model with separate values of <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> for each population:</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb129-1" aria-hidden="true" tabindex="-1"></a>fir.neg.ll.full <span class="ot">&lt;-</span> <span class="cf">function</span>(parms) {</span>
<span id="cb129-2"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb129-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb129-3"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb129-3" aria-hidden="true" tabindex="-1"></a>  a.w <span class="ot">&lt;-</span> parms[<span class="dv">1</span>]</span>
<span id="cb129-4"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb129-4" aria-hidden="true" tabindex="-1"></a>  b.w <span class="ot">&lt;-</span> parms[<span class="dv">2</span>]</span>
<span id="cb129-5"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb129-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb129-6"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb129-6" aria-hidden="true" tabindex="-1"></a>  a.n <span class="ot">&lt;-</span> parms[<span class="dv">3</span>]</span>
<span id="cb129-7"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb129-7" aria-hidden="true" tabindex="-1"></a>  b.n <span class="ot">&lt;-</span> parms[<span class="dv">4</span>]</span>
<span id="cb129-8"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb129-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb129-9"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb129-9" aria-hidden="true" tabindex="-1"></a>  k   <span class="ot">&lt;-</span> parms[<span class="dv">5</span>]</span>
<span id="cb129-10"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb129-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb129-11"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb129-11" aria-hidden="true" tabindex="-1"></a>  wave    <span class="ot">&lt;-</span> <span class="fu">subset</span>(fir, wave <span class="sc">==</span> <span class="st">&quot;w&quot;</span>)</span>
<span id="cb129-12"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb129-12" aria-hidden="true" tabindex="-1"></a>  nonwave <span class="ot">&lt;-</span> <span class="fu">subset</span>(fir, wave <span class="sc">==</span> <span class="st">&quot;n&quot;</span>) </span>
<span id="cb129-13"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb129-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb129-14"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb129-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># note how we call fir.neg.ll here, but each time only</span></span>
<span id="cb129-15"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb129-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># passing a subset of the data</span></span>
<span id="cb129-16"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb129-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb129-17"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb129-17" aria-hidden="true" tabindex="-1"></a>  neg.ll.wave     <span class="ot">&lt;-</span> <span class="fu">fir.neg.ll</span>(<span class="at">parms =</span> <span class="fu">c</span>(<span class="at">a =</span> a.w, <span class="at">b =</span> b.w, <span class="at">k =</span> k),</span>
<span id="cb129-18"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb129-18" aria-hidden="true" tabindex="-1"></a>                                <span class="at">x     =</span> wave<span class="sc">$</span>dbh,</span>
<span id="cb129-19"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb129-19" aria-hidden="true" tabindex="-1"></a>                                <span class="at">y     =</span> wave<span class="sc">$</span>cones)</span>
<span id="cb129-20"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb129-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb129-21"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb129-21" aria-hidden="true" tabindex="-1"></a>  neg.ll.nonwave  <span class="ot">&lt;-</span> <span class="fu">fir.neg.ll</span>(<span class="at">parms =</span> <span class="fu">c</span>(<span class="at">a =</span> a.n, <span class="at">b =</span> b.n, <span class="at">k =</span> k),</span>
<span id="cb129-22"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb129-22" aria-hidden="true" tabindex="-1"></a>                                <span class="at">x     =</span> nonwave<span class="sc">$</span>dbh,</span>
<span id="cb129-23"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb129-23" aria-hidden="true" tabindex="-1"></a>                                <span class="at">y     =</span> nonwave<span class="sc">$</span>cones)</span>
<span id="cb129-24"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb129-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb129-25"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb129-25" aria-hidden="true" tabindex="-1"></a>  total.ll <span class="ot">&lt;-</span> neg.ll.wave <span class="sc">+</span> neg.ll.nonwave</span>
<span id="cb129-26"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb129-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb129-27"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb129-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(total.ll)</span>
<span id="cb129-28"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb129-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb129-29"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb129-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-30"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb129-30" aria-hidden="true" tabindex="-1"></a>(fir.full <span class="ot">&lt;-</span> <span class="fu">optim</span>(<span class="at">f      =</span> fir.neg.ll.full,</span>
<span id="cb129-31"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb129-31" aria-hidden="true" tabindex="-1"></a>                  <span class="at">par    =</span> <span class="fu">c</span>(<span class="at">a.w =</span> <span class="dv">1</span>, <span class="at">b.w =</span> <span class="dv">1</span>, <span class="at">a.n =</span> <span class="dv">1</span>, <span class="at">b.n =</span> <span class="dv">1</span>, <span class="at">k =</span> <span class="dv">1</span>)))</span></code></pre></div>
<pre><code>## $par
##       a.w       b.w       a.n       b.n         k 
## 0.4136414 2.1417941 0.2874122 2.3550753 1.5083974 
## 
## $value
## [1] 1135.677
## 
## $counts
## function gradient 
##      502       NA 
## 
## $convergence
## [1] 1
## 
## $message
## NULL</code></pre>
<p>Let’s make a plot to show the different fits.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb131-1" aria-hidden="true" tabindex="-1"></a>a.w.mle <span class="ot">&lt;-</span> fir.full<span class="sc">$</span>par[<span class="dv">1</span>]</span>
<span id="cb131-2"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb131-2" aria-hidden="true" tabindex="-1"></a>b.w.mle <span class="ot">&lt;-</span> fir.full<span class="sc">$</span>par[<span class="dv">2</span>]</span>
<span id="cb131-3"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb131-3" aria-hidden="true" tabindex="-1"></a>a.n.mle <span class="ot">&lt;-</span> fir.full<span class="sc">$</span>par[<span class="dv">3</span>]</span>
<span id="cb131-4"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb131-4" aria-hidden="true" tabindex="-1"></a>b.n.mle <span class="ot">&lt;-</span> fir.full<span class="sc">$</span>par[<span class="dv">4</span>]</span>
<span id="cb131-5"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb131-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-6"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb131-6" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb131-7"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb131-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-8"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb131-8" aria-hidden="true" tabindex="-1"></a><span class="co"># wave populations</span></span>
<span id="cb131-9"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb131-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-10"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb131-10" aria-hidden="true" tabindex="-1"></a>fit.vals.wave <span class="ot">&lt;-</span> fit.vals.non <span class="ot">&lt;-</span> <span class="fu">double</span>(<span class="at">length =</span> <span class="fu">length</span>(dbh.vals))</span>
<span id="cb131-11"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb131-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-12"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb131-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cones <span class="sc">~</span> dbh, <span class="at">data =</span> fir, <span class="at">type =</span> <span class="st">&quot;n&quot;</span>, <span class="at">main =</span> <span class="st">&quot;wave&quot;</span>)</span>
<span id="cb131-13"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb131-13" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(cones <span class="sc">~</span> dbh, <span class="at">data =</span> <span class="fu">subset</span>(fir, wave <span class="sc">==</span> <span class="st">&quot;w&quot;</span>))</span>
<span id="cb131-14"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb131-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-15"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb131-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq</span>(<span class="at">along =</span> dbh.vals)) {</span>
<span id="cb131-16"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb131-16" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb131-17"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb131-17" aria-hidden="true" tabindex="-1"></a>  fit.vals.wave[i] <span class="ot">&lt;-</span> a.w.mle <span class="sc">*</span> dbh.vals[i] <span class="sc">^</span> b.w.mle  </span>
<span id="cb131-18"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb131-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb131-19"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb131-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-20"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb131-20" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(fit.vals.wave <span class="sc">~</span> dbh.vals, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)  </span>
<span id="cb131-21"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb131-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-22"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb131-22" aria-hidden="true" tabindex="-1"></a><span class="co"># non-wave populations</span></span>
<span id="cb131-23"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb131-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-24"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb131-24" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cones <span class="sc">~</span> dbh, <span class="at">data =</span> fir, <span class="at">type =</span> <span class="st">&quot;n&quot;</span>, <span class="at">main =</span> <span class="st">&quot;non-wave&quot;</span>)</span>
<span id="cb131-25"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb131-25" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(cones <span class="sc">~</span> dbh, <span class="at">data =</span> <span class="fu">subset</span>(fir, wave <span class="sc">==</span> <span class="st">&quot;n&quot;</span>))</span>
<span id="cb131-26"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb131-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-27"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb131-27" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq</span>(<span class="at">along =</span> dbh.vals)) {</span>
<span id="cb131-28"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb131-28" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb131-29"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb131-29" aria-hidden="true" tabindex="-1"></a>  fit.vals.non[i] <span class="ot">&lt;-</span> a.n.mle <span class="sc">*</span> dbh.vals[i] <span class="sc">^</span> b.n.mle  </span>
<span id="cb131-30"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb131-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb131-31"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb131-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-32"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb131-32" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(fit.vals.non <span class="sc">~</span> dbh.vals, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)  </span></code></pre></div>
<p><img src="02-LikelihoodConfideceRegions_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<p>Note that to compute the negative log likelihood for the full model, we compute the negative log likelihood for each population separately, and then sum the two negative log likelihoods. We can see the justification for doing so by writing out the log likelihood function explicitly:
<span class="math display">\[\begin{eqnarray*}
\ln L(a_w, a_n, b_w, b_n, k; \mathbf{y}) &amp; = &amp; \ln \prod_{i \in \left\{w, n \right\}} \prod_{j=1}^{n_i} f(y_{ij}; a_w, a_n, b_w, b_n, k) \\
&amp; = &amp; \sum_{i \in \left\{w, n \right\}} \sum_{j=1}^{n_i} \ln  f(y_{ij}; a_w, a_n, b_w, b_n, k) \\
&amp; = &amp; \sum_{j=1}^{n_w} \ln  f(y_{w,j}; a_w, b_w, k) + \sum_{j=1}^{n_n} \ln  f(y_{2, n}; a_n, b_n, k)
\end{eqnarray*}\]</span></p>
<p>Now conduct the likelihood ratio test:</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb132-1" aria-hidden="true" tabindex="-1"></a>(lrt.stat <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> (fir.reduced<span class="sc">$</span>value <span class="sc">-</span> fir.full<span class="sc">$</span>value))  <span class="co"># compute the likelihood ratio test statistic</span></span></code></pre></div>
<pre><code>## [1] 0.6762567</code></pre>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb134-1" aria-hidden="true" tabindex="-1"></a>(lrt.pvalue <span class="ot">&lt;-</span> <span class="fu">pchisq</span>(<span class="at">q =</span> lrt.stat, <span class="at">df =</span> <span class="dv">2</span>, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>))  <span class="co"># calculate the p-vlaue</span></span></code></pre></div>
<pre><code>## [1] 0.7131037</code></pre>
<p>The LRT suggests that the full model does not provide a significantly better fit than the reduced model (<span class="math inline">\(\chi^2_2 = 0.676\)</span>, <span class="math inline">\(p=0.71\)</span>). In other words, there is no evidence that the two population types have different relationships between tree size and avearage fecundity.</p>
<p>Now compare AIC values for the two models. Because we have already done the LRT, this AIC comparison is for illustration.</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb136-1" aria-hidden="true" tabindex="-1"></a>(aic.reduced <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> fir.reduced<span class="sc">$</span>value <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] 2278.03</code></pre>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb138-1" aria-hidden="true" tabindex="-1"></a>(aic.full    <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> fir.full<span class="sc">$</span>value    <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> <span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] 2281.354</code></pre>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb140-1" aria-hidden="true" tabindex="-1"></a>(delta.aic   <span class="ot">&lt;-</span> aic.full <span class="sc">-</span> aic.reduced) </span></code></pre></div>
<pre><code>## [1] 3.323743</code></pre>
<p>The reduced model is AIC-best, although the <span class="math inline">\(\Delta AIC\)</span> is only moderately large.</p>
<p>We can also fit a Poisson model to these data. Because we have ruled out the need for different models for the two population type, we fit a Poisson model to the data with the two populations pooled together.</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb142-1" aria-hidden="true" tabindex="-1"></a>fir.neg.ll.pois <span class="ot">&lt;-</span> <span class="cf">function</span>(parms, x, y){</span>
<span id="cb142-2"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb142-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb142-3"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb142-3" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;-</span> parms[<span class="dv">1</span>]</span>
<span id="cb142-4"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb142-4" aria-hidden="true" tabindex="-1"></a>  b <span class="ot">&lt;-</span> parms[<span class="dv">2</span>]</span>
<span id="cb142-5"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb142-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb142-6"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb142-6" aria-hidden="true" tabindex="-1"></a>  my.mu <span class="ot">&lt;-</span> a <span class="sc">*</span> x<span class="sc">^</span>b</span>
<span id="cb142-7"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb142-7" aria-hidden="true" tabindex="-1"></a>  ll.values <span class="ot">&lt;-</span> <span class="fu">dpois</span>(y, <span class="at">lambda =</span> my.mu, <span class="at">log =</span> <span class="cn">TRUE</span>)</span>
<span id="cb142-8"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb142-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb142-9"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb142-9" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> <span class="fu">sum</span>(ll.values)</span>
<span id="cb142-10"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb142-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb142-11"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb142-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-12"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb142-12" aria-hidden="true" tabindex="-1"></a>(fir.pois <span class="ot">&lt;-</span> <span class="fu">optim</span>(<span class="at">f   =</span> fir.neg.ll.pois,</span>
<span id="cb142-13"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb142-13" aria-hidden="true" tabindex="-1"></a>                  <span class="at">par =</span> <span class="fu">c</span>(<span class="at">a =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">1</span>),</span>
<span id="cb142-14"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb142-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">x   =</span> fir<span class="sc">$</span>dbh,</span>
<span id="cb142-15"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb142-15" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y   =</span> fir<span class="sc">$</span>cones))</span></code></pre></div>
<pre><code>## $par
##         a         b 
## 0.2613297 2.3883860 
## 
## $value
## [1] 3161.832
## 
## $counts
## function gradient 
##      115       NA 
## 
## $convergence
## [1] 0
## 
## $message
## NULL</code></pre>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb144-1" aria-hidden="true" tabindex="-1"></a>a.mle.pois <span class="ot">&lt;-</span> fir.pois<span class="sc">$</span>par[<span class="dv">1</span>]</span>
<span id="cb144-2"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb144-2" aria-hidden="true" tabindex="-1"></a>b.mle.pois <span class="ot">&lt;-</span> fir.pois<span class="sc">$</span>par[<span class="dv">2</span>]</span></code></pre></div>
<p>Calculate the AIC for this model:</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate AIC</span></span>
<span id="cb145-2"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb145-2" aria-hidden="true" tabindex="-1"></a>(aic.pois <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> fir.pois<span class="sc">$</span>value <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 6327.664</code></pre>
<p>Whoa! The AIC suggests the negative binomial model is an overwhelmingly better fit.</p>
<p>Finally, make a plot to compare the two fits:</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(fir, <span class="fu">plot</span>(cones <span class="sc">~</span> dbh))</span>
<span id="cb147-2"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb147-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-3"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb147-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(fit.vals <span class="sc">~</span> dbh.vals, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)  <span class="co"># plot the fit from the NegBin model</span></span>
<span id="cb147-4"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb147-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-5"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb147-5" aria-hidden="true" tabindex="-1"></a><span class="do">## calculate and plot the fit for the Poisson model</span></span>
<span id="cb147-6"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb147-6" aria-hidden="true" tabindex="-1"></a>fit.vals.pois <span class="ot">&lt;-</span> <span class="fu">double</span>(<span class="at">length =</span> <span class="fu">length</span>(dbh.vals))</span>
<span id="cb147-7"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb147-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-8"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb147-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq</span>(<span class="at">along =</span> dbh.vals)) {</span>
<span id="cb147-9"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb147-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb147-10"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb147-10" aria-hidden="true" tabindex="-1"></a>  fit.vals.pois[i] <span class="ot">&lt;-</span> a.mle.pois <span class="sc">*</span> dbh.vals[i] <span class="sc">^</span> b.mle.pois  </span>
<span id="cb147-11"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb147-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb147-12"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb147-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-13"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb147-13" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(fit.vals.pois <span class="sc">~</span> dbh.vals, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb147-14"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb147-14" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="at">x =</span> <span class="dv">4</span>, <span class="at">y =</span> <span class="dv">280</span>, </span>
<span id="cb147-15"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb147-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">leg =</span> <span class="fu">c</span>(<span class="st">&quot;Neg Bin&quot;</span>, <span class="st">&quot;Poisson&quot;</span>),</span>
<span id="cb147-16"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb147-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>),</span>
<span id="cb147-17"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb147-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">16</span>,</span>
<span id="cb147-18"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb147-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span></code></pre></div>
<p><img src="02-LikelihoodConfideceRegions_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
</div>
<div id="transformable-constraints" class="section level2 hasAnchor" number="2.5">
<h2><span class="header-section-number">2.5</span> Transformable constraints<a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#transformable-constraints" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>So far, we have not thought much about the numerical optimization routines that R uses to find MLEs. If time allowed, we really should think more deeply about how these routines work. Indeed, Bolker devotes an entire chapter (his chapter 7) to numerical optimization. Because time is short, we won’t go that deeply into understanding these methods now, although Bolker’s chapter is worth a read if you are so inclined.</p>
<p>There is one topic that deserves more of our attention, which is the issue of constriants on the allowable parameter space. (Bolker touches on this in his <span class="math inline">\(\S\)</span> 7.4.5.) Many times, we write down models with parameters that only make biological sense in a certain range. For example, in the fir data, we know that the parameter <span class="math inline">\(a\)</span> (the average cone production for trees of size <span class="math inline">\(x = 1\)</span>) must be positive. We also know that <span class="math inline">\(k\)</span>, the overdispersion parameter in the negative binomial model, must also be positive. However, most numerical optimization routines are not terribly well suited to optimizing over a constrained space. (The presence of constraints is one of the reasons why it is important to initiate numerical optimization routines with reasonalbe starting values.) One exception is the “L-BFGS-B” method, available in <code>optim</code>, which will permit so-called rectangular constraints. An alternative approach that will work with any numerical optimization scheme is to transform the constraints away. That is, transform the parameterization to a new scale that is unconstrained. Because of the invariance principle of MLEs, these transformations won’t change the MLEs that we eventually find, as long as the MLEs are not on the edge of the original, constrained space.</p>
<p>To illustrate, consider the fir data again, and consider the negative-binomial model fit to the entire data set, ignoring differences between wave vs. non-wave populations. To transform away the constraints on <span class="math inline">\(a\)</span> and <span class="math inline">\(k\)</span>, re-parameterize the model in terms of the logs of both parameters. That is, define
<span class="math display">\[\begin{align*}
a^* &amp; = \ln (a) \\
k^* &amp; = \ln (k) \\
\end{align*}\]</span>
so that the model is now
<span class="math display">\[\begin{align*}
\mu(x) &amp; = \exp(a^*) \times x ^ b \\
Y &amp; \sim \mbox{NB}(\mu(x), \exp(k^*))
\end{align*}\]</span>
Fitting proceeds in the usual way:</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb148-1" aria-hidden="true" tabindex="-1"></a>fir.neg.ll <span class="ot">&lt;-</span> <span class="cf">function</span>(parms, x, y){</span>
<span id="cb148-2"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb148-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb148-3"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb148-3" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;-</span> <span class="fu">exp</span>(parms[<span class="dv">1</span>])</span>
<span id="cb148-4"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb148-4" aria-hidden="true" tabindex="-1"></a>  b <span class="ot">&lt;-</span> parms[<span class="dv">2</span>]</span>
<span id="cb148-5"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb148-5" aria-hidden="true" tabindex="-1"></a>  k <span class="ot">&lt;-</span> <span class="fu">exp</span>(parms[<span class="dv">3</span>])</span>
<span id="cb148-6"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb148-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb148-7"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb148-7" aria-hidden="true" tabindex="-1"></a>  my.mu <span class="ot">&lt;-</span> a <span class="sc">*</span> x<span class="sc">^</span>b</span>
<span id="cb148-8"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb148-8" aria-hidden="true" tabindex="-1"></a>  ll.values <span class="ot">&lt;-</span> <span class="fu">dnbinom</span>(y, <span class="at">size =</span> k, <span class="at">mu =</span> my.mu, <span class="at">log =</span> <span class="cn">TRUE</span>)</span>
<span id="cb148-9"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb148-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb148-10"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb148-10" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> <span class="fu">sum</span>(ll.values)</span>
<span id="cb148-11"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb148-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb148-12"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb148-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-13"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb148-13" aria-hidden="true" tabindex="-1"></a>(fir.reduced <span class="ot">&lt;-</span> <span class="fu">optim</span>(<span class="at">f   =</span> fir.neg.ll,</span>
<span id="cb148-14"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb148-14" aria-hidden="true" tabindex="-1"></a>                      <span class="at">par =</span> <span class="fu">c</span>(<span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">1</span>, <span class="at">k =</span> <span class="dv">0</span>),</span>
<span id="cb148-15"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb148-15" aria-hidden="true" tabindex="-1"></a>                      <span class="at">x   =</span> fir<span class="sc">$</span>dbh,</span>
<span id="cb148-16"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb148-16" aria-hidden="true" tabindex="-1"></a>                      <span class="at">y   =</span> fir<span class="sc">$</span>cones))</span></code></pre></div>
<pre><code>## $par
##          a          b          k 
## -1.1914367  2.3195050  0.4074672 
## 
## $value
## [1] 1136.015
## 
## $counts
## function gradient 
##      158       NA 
## 
## $convergence
## [1] 0
## 
## $message
## NULL</code></pre>
<p>Back-transforming to the original scale recovers the previous MLEs:</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb150-1" aria-hidden="true" tabindex="-1"></a>(a.mle <span class="ot">&lt;-</span> <span class="fu">exp</span>(fir.reduced<span class="sc">$</span>par[<span class="dv">1</span>]))</span></code></pre></div>
<pre><code>##         a 
## 0.3037845</code></pre>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb152-1" aria-hidden="true" tabindex="-1"></a>(b.mle <span class="ot">&lt;-</span> fir.reduced<span class="sc">$</span>par[<span class="dv">2</span>])</span></code></pre></div>
<pre><code>##        b 
## 2.319505</code></pre>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb154-1" aria-hidden="true" tabindex="-1"></a>(k.mle <span class="ot">&lt;-</span> <span class="fu">exp</span>(fir.reduced<span class="sc">$</span>par[<span class="dv">3</span>]))</span></code></pre></div>
<pre><code>##        k 
## 1.503006</code></pre>
<p>The constraint issue also explains why we received warnings from R when we first found the MLEs for the tadpole predation data in Section <a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#two-param-mle">2.2</a>.</p>
<p>Another example that one frequently encounters in ecology are parameters that are constrained to lie between 0 and 1, such as a survival probability. A logit (or log odds) transformation will eliminate the constraints on a parameter that lies between 0 and 1.</p>
<!-- Finally, one might also encounter parameters whose sum must lie between 0 and 1.  For example, in size-based demographic modeling, it is common to describe the demographic fates of individuals in a particular age or size class by two parameters --- survival without growth (say) and survival with growth.  Writing these two parameters as  -->
</div>
<div id="the-negative-binomial-distriution-revisited" class="section level2 hasAnchor" number="2.6">
<h2><span class="header-section-number">2.6</span> The negative binomial distriution, revisited<a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#the-negative-binomial-distriution-revisited" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The negative binomial distribution is a funny distribution that is frequently misunderstood by ecologists. In ecology, the negative binomial distribution is typically parameterized by the distribution’s mean (which we typically write as <span class="math inline">\(\mu\)</span>) and the “overdispersion parameter”, almost always written as <span class="math inline">\(k\)</span>. In this parameterization, if <span class="math inline">\(X\)</span> has a negative binomial distribution with mean <span class="math inline">\(\mu\)</span> and overdispersion parameter <span class="math inline">\(k\)</span>, then the variance of <span class="math inline">\(X\)</span> is
<span class="math display">\[
Var(X) = \mu + \frac{\mu^2}{k}
\]</span>
Thus, for fixed <span class="math inline">\(\mu\)</span>, the variance increases as <span class="math inline">\(k\)</span> decreases. As <span class="math inline">\(k\)</span> gets large, the variance approaches <span class="math inline">\(\mu\)</span>, and the negative binomial distribution approaches a Poisson distribution.</p>
<p>There are a few occasions in ecology where the overdispersion parameter <span class="math inline">\(k\)</span> has a mechanistic interpretation. In all other cases, though, <span class="math inline">\(k\)</span> is merely a phenomenological descriptor that captures the relationship between the mean and variance for one particular value of <span class="math inline">\(\mu\)</span>. The error that most ecologists make is to assume that a single value of <span class="math inline">\(k\)</span> should prevail across several values of <span class="math inline">\(\mu\)</span>. If <span class="math inline">\(k\)</span> is phenomenological, there is no reason that <span class="math inline">\(k\)</span> should remain fixed as <span class="math inline">\(\mu\)</span> changes. The fit to the fir data exemplifies this error, as so far we have assumed that one value of <span class="math inline">\(k\)</span> must prevail across all sizes of trees. By assuming that <span class="math inline">\(k\)</span> is fixed, we impose a relationship on the data where the variance must increase quadratically as the mean increases. This may be a reasonable model for the relationship between the variance and the mean, or it may not be.</p>
<p>Instead of assuming <span class="math inline">\(k\)</span> constant, another equally viable approach might be to assume that <span class="math inline">\(k\)</span> is a linear function of <span class="math inline">\(\mu\)</span>. In other words, We might set <span class="math inline">\(k = \kappa \mu\)</span> for some value of <span class="math inline">\(\kappa\)</span>. In this case, for a given mean <span class="math inline">\(\mu\)</span>, the variance would be <span class="math inline">\(\mu + \frac{\mu^2}{\kappa \mu} = \mu \left(1 + \frac{1}{\kappa}\right)\)</span>, so that the variance would increase linearly as the mean increases. We can try fitting this alternative model to the fir tree data, again pooling wave and non-wave populations together.</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb156-1" aria-hidden="true" tabindex="-1"></a>fir.alt.neg.ll <span class="ot">&lt;-</span> <span class="cf">function</span>(parms, x, y){</span>
<span id="cb156-2"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb156-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb156-3"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb156-3" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;-</span> <span class="fu">exp</span>(parms[<span class="dv">1</span>])</span>
<span id="cb156-4"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb156-4" aria-hidden="true" tabindex="-1"></a>  b <span class="ot">&lt;-</span> parms[<span class="dv">2</span>]</span>
<span id="cb156-5"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb156-5" aria-hidden="true" tabindex="-1"></a>  k <span class="ot">&lt;-</span> <span class="fu">exp</span>(parms[<span class="dv">3</span>])</span>
<span id="cb156-6"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb156-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb156-7"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb156-7" aria-hidden="true" tabindex="-1"></a>  my.mu <span class="ot">&lt;-</span> a <span class="sc">*</span> x<span class="sc">^</span>b</span>
<span id="cb156-8"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb156-8" aria-hidden="true" tabindex="-1"></a>  ll.values <span class="ot">&lt;-</span> <span class="fu">dnbinom</span>(y, <span class="at">size =</span> k <span class="sc">*</span> my.mu, <span class="at">mu =</span> my.mu, <span class="at">log =</span> <span class="cn">TRUE</span>)</span>
<span id="cb156-9"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb156-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb156-10"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb156-10" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> <span class="fu">sum</span>(ll.values)</span>
<span id="cb156-11"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb156-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb156-12"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb156-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-13"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb156-13" aria-hidden="true" tabindex="-1"></a>(fir.alt <span class="ot">&lt;-</span> <span class="fu">optim</span>(<span class="at">f   =</span> fir.alt.neg.ll,</span>
<span id="cb156-14"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb156-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">par =</span> <span class="fu">c</span>(<span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">1</span>, <span class="at">k =</span> <span class="dv">0</span>),</span>
<span id="cb156-15"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb156-15" aria-hidden="true" tabindex="-1"></a>                  <span class="at">x   =</span> fir<span class="sc">$</span>dbh,</span>
<span id="cb156-16"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb156-16" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y   =</span> fir<span class="sc">$</span>cones))</span></code></pre></div>
<pre><code>## $par
##         a         b         k 
## -1.008373  2.243545 -3.278311 
## 
## $value
## [1] 1128.403
## 
## $counts
## function gradient 
##      182       NA 
## 
## $convergence
## [1] 0
## 
## $message
## NULL</code></pre>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb158-1" aria-hidden="true" tabindex="-1"></a>(a.mle.alt <span class="ot">&lt;-</span> <span class="fu">exp</span>(fir.alt<span class="sc">$</span>par[<span class="dv">1</span>]))</span></code></pre></div>
<pre><code>##         a 
## 0.3648121</code></pre>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb160-1" aria-hidden="true" tabindex="-1"></a>(b.mle.alt <span class="ot">&lt;-</span> fir.alt<span class="sc">$</span>par[<span class="dv">2</span>])</span></code></pre></div>
<pre><code>##        b 
## 2.243545</code></pre>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb162-1" aria-hidden="true" tabindex="-1"></a>(k.mle.alt <span class="ot">&lt;-</span> <span class="fu">exp</span>(fir.alt<span class="sc">$</span>par[<span class="dv">3</span>]))</span></code></pre></div>
<pre><code>##          k 
## 0.03769186</code></pre>
<p>If we compare the fits graphically, the alternative model doesn’t generate a dramatically different fit for the relationship between the average cone production and tree size:</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb164-1" aria-hidden="true" tabindex="-1"></a>fit.vals.alt <span class="ot">&lt;-</span> <span class="fu">double</span>(<span class="at">length =</span> <span class="fu">length</span>(dbh.vals))</span>
<span id="cb164-2"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb164-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-3"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb164-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq</span>(<span class="at">along =</span> dbh.vals)) {</span>
<span id="cb164-4"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb164-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb164-5"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb164-5" aria-hidden="true" tabindex="-1"></a>  fit.vals.alt[i] <span class="ot">&lt;-</span> a.mle.alt <span class="sc">*</span> dbh.vals[i] <span class="sc">^</span> b.mle.alt  </span>
<span id="cb164-6"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb164-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb164-7"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb164-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-8"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb164-8" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(fir, <span class="fu">plot</span>(cones <span class="sc">~</span> dbh))</span>
<span id="cb164-9"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb164-9" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(fit.vals <span class="sc">~</span> dbh.vals, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb164-10"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb164-10" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(fit.vals.alt <span class="sc">~</span> dbh.vals, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb164-11"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb164-11" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">leg =</span> <span class="fu">c</span>(<span class="st">&quot;original&quot;</span>, <span class="st">&quot;alternate&quot;</span>))</span></code></pre></div>
<p><img src="02-LikelihoodConfideceRegions_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
<p>However, the two models imply very different relationships between the variance in cone production and tree size. Let’s look at the implied relationship between the standard deviation of cone production and tree size:</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb165-1" aria-hidden="true" tabindex="-1"></a>mu.vals <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="fu">max</span>(fit.vals), <span class="at">length =</span> <span class="dv">100</span>)</span>
<span id="cb165-2"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb165-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-3"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb165-3" aria-hidden="true" tabindex="-1"></a>sd.vals.nb1 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(mu.vals <span class="sc">+</span> mu.vals <span class="sc">^</span> <span class="dv">2</span> <span class="sc">/</span> k.mle)</span>
<span id="cb165-4"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb165-4" aria-hidden="true" tabindex="-1"></a>sd.vals.nb2 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(mu.vals <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">/</span> k.mle.alt))</span>
<span id="cb165-5"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb165-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-6"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb165-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mu.vals, sd.vals.nb1, <span class="at">xlab =</span> <span class="st">&quot;mean&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;SD&quot;</span>, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb165-7"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb165-7" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(mu.vals, sd.vals.nb2, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb165-8"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb165-8" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">leg =</span> <span class="fu">c</span>(<span class="st">&quot;original&quot;</span>, <span class="st">&quot;alternate&quot;</span>))</span></code></pre></div>
<p><img src="02-LikelihoodConfideceRegions_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
<p>We can calculate the AIC for this alternate parameterization as well:</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#cb166-1" aria-hidden="true" tabindex="-1"></a>(aic.alt <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> fir.alt<span class="sc">$</span>value <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] 2262.805</code></pre>
<p>Recall that the AIC value for the original fit was 2278.0. Thus the model with the alternative parameterization is considerably better by AIC.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="bayesian-computation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "serif",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
