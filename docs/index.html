<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>BMA / ST 590 computing companion</title>
  <meta name="description" content="This is a proto-textbook for BMA / ST 590, Statistical Modeling in Ecology, taught at NCSU in Fall 2023." />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="BMA / ST 590 computing companion" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is a proto-textbook for BMA / ST 590, Statistical Modeling in Ecology, taught at NCSU in Fall 2023." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="BMA / ST 590 computing companion" />
  
  <meta name="twitter:description" content="This is a proto-textbook for BMA / ST 590, Statistical Modeling in Ecology, taught at NCSU in Fall 2023." />
  

<meta name="author" content="Kevin Gross" />


<meta name="date" content="2023-09-04" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  

<link rel="next" href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.10.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Maximum likelihood estimation</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#mathematical-basics"><i class="fa fa-check"></i><b>1.1</b> Mathematical basics</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#horse-kick-data"><i class="fa fa-check"></i><b>1.2</b> Horse-kick data</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="index.html"><a href="index.html#calculate-and-plot-the-log-likelihood-function"><i class="fa fa-check"></i><b>1.2.1</b> Calculate and plot the log-likelihood function</a></li>
<li class="chapter" data-level="1.2.2" data-path="index.html"><a href="index.html#find-the-mle-numerically-using-optimize"><i class="fa fa-check"></i><b>1.2.2</b> Find the MLE numerically using ‘optimize’</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#pulse-rate-data"><i class="fa fa-check"></i><b>1.3</b> Pulse rate data</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#tadpole-data"><i class="fa fa-check"></i><b>1.4</b> Tadpole data</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#transformable-constraints"><i class="fa fa-check"></i><b>1.5</b> Transformable constraints</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html"><i class="fa fa-check"></i><b>2</b> Beyond the MLE: Confidence regions and hypothesis tests using the likelihood function</a>
<ul>
<li class="chapter" data-level="2.1" data-path="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#confidence-intervals-for-single-parameters"><i class="fa fa-check"></i><b>2.1</b> Confidence intervals for single parameters</a></li>
<li class="chapter" data-level="2.2" data-path="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#two-param-mle"><i class="fa fa-check"></i><b>2.2</b> Confidence regions, profile likelihoods, and associated univariate intervals</a></li>
<li class="chapter" data-level="2.3" data-path="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#locally-quadratic-approximations-to-confidence-intervals-and-regions"><i class="fa fa-check"></i><b>2.3</b> Locally quadratic approximations to confidence intervals and regions</a></li>
<li class="chapter" data-level="2.4" data-path="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#comparing-models-likelihood-ratio-test-and-aic"><i class="fa fa-check"></i><b>2.4</b> Comparing models: Likelihood ratio test and AIC</a></li>
<li class="chapter" data-level="2.5" data-path="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html"><a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html#the-negative-binomial-distriution-revisited"><i class="fa fa-check"></i><b>2.5</b> The negative binomial distriution, revisited</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="bayesian-computation.html"><a href="bayesian-computation.html"><i class="fa fa-check"></i><b>3</b> Bayesian computation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="bayesian-computation.html"><a href="bayesian-computation.html#computations-with-conjugate-priors"><i class="fa fa-check"></i><b>3.1</b> Computations with conjugate priors</a></li>
<li class="chapter" data-level="3.2" data-path="bayesian-computation.html"><a href="bayesian-computation.html#jags-in-r"><i class="fa fa-check"></i><b>3.2</b> JAGS in R</a></li>
<li class="chapter" data-level="3.3" data-path="bayesian-computation.html"><a href="bayesian-computation.html#rstanarm"><i class="fa fa-check"></i><b>3.3</b> rstanarm</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="smooth-regression.html"><a href="smooth-regression.html"><i class="fa fa-check"></i><b>4</b> Smooth regression</a>
<ul>
<li class="chapter" data-level="4.1" data-path="smooth-regression.html"><a href="smooth-regression.html#loess-smoothers"><i class="fa fa-check"></i><b>4.1</b> Loess smoothers</a></li>
<li class="chapter" data-level="4.2" data-path="smooth-regression.html"><a href="smooth-regression.html#splines"><i class="fa fa-check"></i><b>4.2</b> Splines</a></li>
<li class="chapter" data-level="4.3" data-path="smooth-regression.html"><a href="smooth-regression.html#generalized-additive-models-gams"><i class="fa fa-check"></i><b>4.3</b> Generalized additive models (GAMs)</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="generalized-least-squares.html"><a href="generalized-least-squares.html"><i class="fa fa-check"></i><b>5</b> Generalized Least Squares</a>
<ul>
<li class="chapter" data-level="5.1" data-path="generalized-least-squares.html"><a href="generalized-least-squares.html#heterogeneous-variance"><i class="fa fa-check"></i><b>5.1</b> Heterogeneous variance</a></li>
<li class="chapter" data-level="5.2" data-path="generalized-least-squares.html"><a href="generalized-least-squares.html#temporal-serial-correlation"><i class="fa fa-check"></i><b>5.2</b> Temporal (serial) correlation</a></li>
<li class="chapter" data-level="5.3" data-path="generalized-least-squares.html"><a href="generalized-least-squares.html#spatial-data"><i class="fa fa-check"></i><b>5.3</b> Spatial data</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="hierarchical-mixed-models.html"><a href="hierarchical-mixed-models.html"><i class="fa fa-check"></i><b>6</b> Hierarchical (mixed) models</a>
<ul>
<li class="chapter" data-level="6.1" data-path="hierarchical-mixed-models.html"><a href="hierarchical-mixed-models.html#one-factor-layout-dyestuff-data"><i class="fa fa-check"></i><b>6.1</b> One-factor layout: Dyestuff data</a></li>
<li class="chapter" data-level="6.2" data-path="hierarchical-mixed-models.html"><a href="hierarchical-mixed-models.html#bayesian-analysis"><i class="fa fa-check"></i><b>6.2</b> Bayesian analysis</a></li>
<li class="chapter" data-level="6.3" data-path="hierarchical-mixed-models.html"><a href="hierarchical-mixed-models.html#negative-within-group-correlations"><i class="fa fa-check"></i><b>6.3</b> Negative within-group correlations</a></li>
<li class="chapter" data-level="6.4" data-path="hierarchical-mixed-models.html"><a href="hierarchical-mixed-models.html#random-coefficient-models-rikz-data"><i class="fa fa-check"></i><b>6.4</b> Random coefficient models: RIKZ data</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="hierarchical-mixed-models.html"><a href="hierarchical-mixed-models.html#analysis-without-beach-level-covariate"><i class="fa fa-check"></i><b>6.4.1</b> Analysis without beach-level covariate</a></li>
<li class="chapter" data-level="6.4.2" data-path="hierarchical-mixed-models.html"><a href="hierarchical-mixed-models.html#adding-a-beach-level-covariate"><i class="fa fa-check"></i><b>6.4.2</b> Adding a beach-level covariate</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="hierarchical-mixed-models.html"><a href="hierarchical-mixed-models.html#nested-and-crossed-random-effects"><i class="fa fa-check"></i><b>6.5</b> Nested and crossed random effects</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="hierarchical-mixed-models.html"><a href="hierarchical-mixed-models.html#nested-random-effects"><i class="fa fa-check"></i><b>6.5.1</b> Nested random effects</a></li>
<li class="chapter" data-level="6.5.2" data-path="hierarchical-mixed-models.html"><a href="hierarchical-mixed-models.html#crossed-random-effects"><i class="fa fa-check"></i><b>6.5.2</b> Crossed random effects</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html"><i class="fa fa-check"></i><b>7</b> Generalized linear models</a>
<ul>
<li class="chapter" data-level="7.1" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#poisson-regression"><i class="fa fa-check"></i><b>7.1</b> Poisson regression</a></li>
<li class="chapter" data-level="7.2" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#bayesian-interlude"><i class="fa fa-check"></i><b>7.2</b> Bayesian interlude</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#rstanarm-1"><i class="fa fa-check"></i><b>7.2.1</b> rstanarm</a></li>
<li class="chapter" data-level="7.2.2" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#posterior-predictive-checks"><i class="fa fa-check"></i><b>7.2.2</b> Posterior predictive checks</a></li>
<li class="chapter" data-level="7.2.3" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#jags"><i class="fa fa-check"></i><b>7.2.3</b> JAGS</a></li>
<li class="chapter" data-level="7.2.4" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#observation-level-random-effects"><i class="fa fa-check"></i><b>7.2.4</b> Observation-level random effects</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#binary-responses"><i class="fa fa-check"></i><b>7.3</b> Binary responses</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#individual-binary-responses-tb-in-boar"><i class="fa fa-check"></i><b>7.3.1</b> Individual binary responses: TB in boar</a></li>
<li class="chapter" data-level="7.3.2" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#grouped-binary-data-industrial-melanism"><i class="fa fa-check"></i><b>7.3.2</b> Grouped binary data: Industrial melanism</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#zero-adjusted-models-for-count-data"><i class="fa fa-check"></i><b>7.4</b> Zero-adjusted models for count data</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#zero-truncated-models"><i class="fa fa-check"></i><b>7.4.1</b> Zero-truncated models</a></li>
<li class="chapter" data-level="7.4.2" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#zero-inflated-models"><i class="fa fa-check"></i><b>7.4.2</b> Zero-inflated models</a></li>
<li class="chapter" data-level="7.4.3" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#zero-altered-or-hurdle-models"><i class="fa fa-check"></i><b>7.4.3</b> Zero-altered, or “hurdle”, models</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#generalized-additive-models-gams-1"><i class="fa fa-check"></i><b>7.5</b> Generalized additive models (GAMs)</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="generalized-linear-mixed-models.html"><a href="generalized-linear-mixed-models.html"><i class="fa fa-check"></i><b>8</b> Generalized linear mixed models</a>
<ul>
<li class="chapter" data-level="8.1" data-path="generalized-linear-mixed-models.html"><a href="generalized-linear-mixed-models.html#example-1-industrial-melanism-data"><i class="fa fa-check"></i><b>8.1</b> Example 1: Industrial melanism data</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="generalized-linear-mixed-models.html"><a href="generalized-linear-mixed-models.html#gees"><i class="fa fa-check"></i><b>8.1.1</b> GEEs</a></li>
<li class="chapter" data-level="8.1.2" data-path="generalized-linear-mixed-models.html"><a href="generalized-linear-mixed-models.html#glmms"><i class="fa fa-check"></i><b>8.1.2</b> GLMMs</a></li>
<li class="chapter" data-level="8.1.3" data-path="generalized-linear-mixed-models.html"><a href="generalized-linear-mixed-models.html#bayesian-fit"><i class="fa fa-check"></i><b>8.1.3</b> Bayesian fit</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="generalized-linear-mixed-models.html"><a href="generalized-linear-mixed-models.html#example-2-ticks-on-red-grouse"><i class="fa fa-check"></i><b>8.2</b> Example 2: Ticks on red grouse</a></li>
<li class="chapter" data-level="8.3" data-path="generalized-linear-mixed-models.html"><a href="generalized-linear-mixed-models.html#gamms"><i class="fa fa-check"></i><b>8.3</b> GAMMs</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="bibliography.html"><a href="bibliography.html"><i class="fa fa-check"></i>Bibliography</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">BMA / ST 590 computing companion</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="header">
<h1 class="title">BMA / ST 590 computing companion</h1>
<p class="author"><em>Kevin Gross</em></p>
<p class="date"><em>2023-09-04</em></p>
</div>
<div id="maximum-likelihood-estimation" class="section level1 hasAnchor" number="1">
<h1><span class="header-section-number">Chapter 1</span> Maximum likelihood estimation<a href="index.html#maximum-likelihood-estimation" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>The <em>likelihood function</em> is the mathematical object that underlies many of the methods that we will study in this course. In this chapter, we will study the properties of the likelihood function for some simple models and data sets. We will see that the likelihood can be used to generate parameter estimates and associated measures of uncertainty (e.g., standard errors and confidence intervals). For most of the methods that we study later in this course, we will use software in which someone else has written code to analyze the likelihood function; thus we won’t have to worry about coding the likelihood function ourselves. However, it is helpful to know how to derive and analyze a likelihood function when needed, because likelihood analysis is flexible and can often be applied in specialized situations where code for a specific analysis may not already exist.</p>
<div id="mathematical-basics" class="section level2 hasAnchor" number="1.1">
<h2><span class="header-section-number">1.1</span> Mathematical basics<a href="index.html#mathematical-basics" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The mathematical expression for a likelihood function is identical to the mathematical expression that one would use to find the probability mass or density associated with a particular value of a random variable. For example, suppose that we have a very simple data set that consists of only one observation from a Poisson distribution. Let <span class="math inline">\(X\)</span> denote the value of the single data point, and let <span class="math inline">\(\lambda\)</span> denote the parameter of the Poisson distribution. In a probability class, we learn that we can find the probability mass associated with any particular value of <span class="math inline">\(X\)</span> using the formula
<span class="math display">\[
\mathrm{Pr}\!\left\{X=x; \lambda\right\} = \dfrac{e^{-\lambda} \lambda^x}{x!}.
\]</span>
In R, we can access this probability mass function using the <code>dpois</code> function. For example, if we wanted to find the probability mass associated with <span class="math inline">\(X=1\)</span> when <span class="math inline">\(\lambda = 1.5\)</span>, we could use</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="index.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dpois</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">lambda =</span> <span class="fl">1.5</span>)</span></code></pre></div>
<pre><code>## [1] 0.3346952</code></pre>
<p>In likelihood analysis, we use the same mathematical expression for the probability mass function (pmf) of a data set, but we change our perspective. Instead of regarding the parameter as a known quantity and computing the probability associated with various possible values for the data, in likelihood analysis we regard the data as the known quantity and evaluate the same mathematical expression for different parameter values. In notation, this logic translates into an expression that we can write as
<span class="math display">\[
\ell\!\left(\lambda; x\right) = \mathrm{Pr}\!\left\{X=x; \lambda\right\}.
\]</span>
where we have used <span class="math inline">\(\ell\!\left(\lambda; x\right)\)</span> to denote the likelihood function for <span class="math inline">\(\lambda\)</span> when we have a data set with value <span class="math inline">\(x\)</span>. The expression above seems strange, because nothing seems to be happening; we are simply taking the same mathematical expression and calling it two different things depending on the context. But that is all there is to it, at least with regard to constructing the likelihood function.</p>
<p>Because a likelihood function uses the same mathematical formulas as a probability mass function, we can use the same functions that <code>R</code> provides for computing probability masses for discretely valued data (or probability densities for continuously valued data) to compute the a likelihood function. Let’s return to our simple example of observing a single observation from a Poisson distribution. Suppose that observation is <span class="math inline">\(X=2\)</span>. We can use the <code>dpois</code> function to evaluate the likelihood for this single observation. For example, we can evaluate the likelihood at <span class="math inline">\(\lambda = 1.5\)</span>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="index.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dpois</span>(<span class="at">x =</span> <span class="dv">2</span>, <span class="at">lambda =</span> <span class="fl">1.5</span>)</span></code></pre></div>
<pre><code>## [1] 0.2510214</code></pre>
<p>Or we could evaluate the likelihood at <span class="math inline">\(\lambda = 2\)</span> or <span class="math inline">\(\lambda = 2.5\)</span>:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="index.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dpois</span>(<span class="at">x =</span> <span class="dv">2</span>, <span class="at">lambda =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="fl">2.5</span>))</span></code></pre></div>
<pre><code>## [1] 0.2706706 0.2565156</code></pre>
<p>Now let’s evaluate the likelihood at a sequence of <span class="math inline">\(\lambda\)</span> values:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="index.html#cb7-1" aria-hidden="true" tabindex="-1"></a>my.lhood <span class="ot">&lt;-</span> <span class="cf">function</span>(lambda) <span class="fu">dpois</span>(<span class="at">x =</span> <span class="dv">2</span>, <span class="at">lambda =</span> lambda)</span>
<span id="cb7-2"><a href="index.html#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="index.html#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(my.lhood, <span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">5</span>,</span>
<span id="cb7-4"><a href="index.html#cb7-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="fu">expression</span>(lambda), </span>
<span id="cb7-5"><a href="index.html#cb7-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">ylab =</span> <span class="st">&quot;Likelihood&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>We might guess that the likelihood is maximized at <span class="math inline">\(\lambda = 2\)</span>. We’d be right, as the plot below suggests.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="index.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(my.lhood, <span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">5</span>,</span>
<span id="cb8-2"><a href="index.html#cb8-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="fu">expression</span>(lambda), </span>
<span id="cb8-3"><a href="index.html#cb8-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">ylab =</span> <span class="st">&quot;Likelihood&quot;</span>)</span>
<span id="cb8-4"><a href="index.html#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="index.html#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
</div>
<div id="horse-kick-data" class="section level2 hasAnchor" number="1.2">
<h2><span class="header-section-number">1.2</span> Horse-kick data<a href="index.html#horse-kick-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Most real data sets contain more than a single observation. Here is a data set that we can use to illustrate maximum likelihood estimation with a single parameter. Famously, Ladislaus van Bortkewitsch (1868 – 1931) published how many members of the Prussian army were killed by horse kicks in each of 20 years, for each of 14 army corps. In this analysis, we will ignore both the temporal structure and the grouping among corps and treat the data as just a simple random sample<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> from a Poisson distribution with <span class="math inline">\(n=280\)</span> data points. As a caveat, these data are often used to illustrate the Poisson distribution, as we will use them. They match the Poisson distribution more neatly than we might expect for most data sets.</p>
<p>First import the data. Note that the path name used here is specific to the file directory that was used to create this file. The path name that you use will likely differ.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="index.html#cb9-1" aria-hidden="true" tabindex="-1"></a>horse <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;data/horse.txt&quot;</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>Ask for a <code>summary</code> of the data to make sure the data have been imported correctly.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="index.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(horse)</span></code></pre></div>
<pre><code>##       year         corps               deaths   
##  Min.   :1875   Length:280         Min.   :0.0  
##  1st Qu.:1880   Class :character   1st Qu.:0.0  
##  Median :1884   Mode  :character   Median :0.0  
##  Mean   :1884                      Mean   :0.7  
##  3rd Qu.:1889                      3rd Qu.:1.0  
##  Max.   :1894                      Max.   :4.0</code></pre>
<p>We can also learn about the data by asking to see the first few records using the <code>head</code> command</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="index.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(horse)</span></code></pre></div>
<pre><code>##   year corps deaths
## 1 1875    GC      0
## 2 1876    GC      2
## 3 1877    GC      2
## 4 1878    GC      1
## 5 1879    GC      0
## 6 1880    GC      0</code></pre>
<p>or we can see the last few records using the <code>tail</code> command:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="index.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(horse)</span></code></pre></div>
<pre><code>##     year corps deaths
## 275 1889   C15      2
## 276 1890   C15      2
## 277 1891   C15      0
## 278 1892   C15      0
## 279 1893   C15      0
## 280 1894   C15      0</code></pre>
<p>Another useful function to keep in mind is the <code>str</code> function which tells you about the [str]ucture of an R object:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="index.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(horse)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    280 obs. of  3 variables:
##  $ year  : int  1875 1876 1877 1878 1879 1880 1881 1882 1883 1884 ...
##  $ corps : chr  &quot;GC&quot; &quot;GC&quot; &quot;GC&quot; &quot;GC&quot; ...
##  $ deaths: int  0 2 2 1 0 0 1 1 0 3 ...</code></pre>
<p>Let’s plot a histogram of the values:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="index.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(horse<span class="sc">$</span>deaths,</span>
<span id="cb18-2"><a href="index.html#cb18-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(horse<span class="sc">$</span>deaths) <span class="sc">-</span> <span class="fl">0.5</span>, </span>
<span id="cb18-3"><a href="index.html#cb18-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">to =</span> <span class="fu">max</span>(horse<span class="sc">$</span>deaths) <span class="sc">+</span> <span class="fl">0.5</span>, </span>
<span id="cb18-4"><a href="index.html#cb18-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">by =</span> <span class="dv">1</span>))</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<div id="calculate-and-plot-the-log-likelihood-function" class="section level3 hasAnchor" number="1.2.1">
<h3><span class="header-section-number">1.2.1</span> Calculate and plot the log-likelihood function<a href="index.html#calculate-and-plot-the-log-likelihood-function" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The first step in likelihood analysis is to construct the likelihood function. The likelihood function is given by the same mathematical expression as the expression for the joint probability mass function of the data. This joint pmf should follow from our probability model for the data.</p>
<p>In this case, we will assume that the data are an iid sample from a Poisson distribution with parameter <span class="math inline">\(\lambda\)</span>. Denoting the random sample as <span class="math inline">\(X_1, X_2, \ldots, X_n\)</span>, we might write this model as
<span class="math display">\[
X_i \stackrel{\text{iid}}{\sim} \mathrm{Pois}(\lambda).
\]</span>
To make the notation a bit easier, we’ll write the entire data set as a vector <span class="math inline">\(\mathbf{X} = \left[ X_1 \; X_2 \; \cdots \; X_n\right]^T\)</span>, where we use uppercase <span class="math inline">\(\mathbf{X}\)</span> to denote the unobserved random vector and lowercase <span class="math inline">\(\mathbf{x}\)</span> to denote a single realization of <span class="math inline">\(\mathbf{X}\)</span>. The likelihood function is then given by
<span class="math display">\[\begin{align*}
\ell(\lambda; \mathbf{x}) &amp; = \mathrm{Pr}\!\left\{\mathbf{X} = \mathbf{x}; \lambda\right\} \\
&amp; = \mathrm{Pr}\!\left\{X_1 = x_1, X_2 = x_2, \ldots X_n = x_n; \lambda\right\} \\
&amp; = \mathrm{Pr}\!\left\{X_1 = x_1; \lambda\right\} \times \mathrm{Pr}\!\left\{X_2 = x_2; \lambda\right\} \times \cdots \times \mathrm{Pr}\!\left\{X_n = x_n; \lambda\right\} \\
&amp; = \prod_{i=1}^n \mathrm{Pr}\!\left\{X_i = x_i; \lambda\right\}.
\end{align*}\]</span>
The third equality above follows from the independence of the data points.</p>
<p>To prevent numerical underflow, we’ll work on the log-likelihood instead of the likelihood itself. Throughout these notes, we’ll use lowercase <span class="math inline">\(\ell = \ln \ell\)</span> to denote the log likelihood. Note that when we use the log likelihood, the product of the marginal pmfs above becomes a sum:
<span class="math display">\[\begin{align*}
\ell(\lambda; \mathbf{x}) &amp; = \ln \prod_{i=1}^n \mathrm{Pr}\!\left\{X_i = x_i; \lambda\right\} \\
&amp; = \sum_{i=1}^n \ln \mathrm{Pr}\!\left\{X_i = x_i; \lambda\right\}
\end{align*}\]</span></p>
<p>Let’s create a function that calculates the log-likelihood for a value of <span class="math inline">\(\lambda\)</span>:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="index.html#cb19-1" aria-hidden="true" tabindex="-1"></a>horse.ll <span class="ot">&lt;-</span> <span class="cf">function</span>(my.lambda){</span>
<span id="cb19-2"><a href="index.html#cb19-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-3"><a href="index.html#cb19-3" aria-hidden="true" tabindex="-1"></a>  ll.vals <span class="ot">&lt;-</span> <span class="fu">dpois</span>(<span class="at">x =</span> horse<span class="sc">$</span>deaths, <span class="at">lambda =</span> my.lambda, <span class="at">log =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-4"><a href="index.html#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(ll.vals)</span>
<span id="cb19-5"><a href="index.html#cb19-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>We can use this function to calculate the log-likelihood for any value of <span class="math inline">\(\lambda\)</span>, such as <span class="math inline">\(\lambda = 1\)</span>:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="index.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">horse.ll</span>(<span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] -328.2462</code></pre>
<p>Let’s calculate the log-likelihood for many values of <span class="math inline">\(\lambda\)</span>, in preparation for making a plot. We’ll use a loop here, and not worry about vectorization.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="index.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a vector of lambda values using the &#39;seq&#39;uence command</span></span>
<span id="cb22-2"><a href="index.html#cb22-2" aria-hidden="true" tabindex="-1"></a>lambda.vals <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.01</span>, <span class="at">to =</span> <span class="fl">2.0</span>, <span class="at">by =</span> <span class="fl">0.01</span>)  </span>
<span id="cb22-3"><a href="index.html#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="index.html#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"># create an empty vector to store the values of the log-likelihood</span></span>
<span id="cb22-5"><a href="index.html#cb22-5" aria-hidden="true" tabindex="-1"></a>ll.vals <span class="ot">&lt;-</span> <span class="fu">double</span>(<span class="at">length =</span> <span class="fu">length</span>(lambda.vals))  </span>
<span id="cb22-6"><a href="index.html#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="index.html#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co"># use a loop to find the log-likelihood for each value in lambda.vals</span></span>
<span id="cb22-8"><a href="index.html#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i.lambda <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(lambda.vals)) {</span>
<span id="cb22-9"><a href="index.html#cb22-9" aria-hidden="true" tabindex="-1"></a>  ll.vals[i.lambda] <span class="ot">&lt;-</span> <span class="fu">horse.ll</span>(lambda.vals[i.lambda])</span>
<span id="cb22-10"><a href="index.html#cb22-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Now plot the log-likelihood values vs. the values of <span class="math inline">\(\lambda\)</span>:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="index.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ll.vals <span class="sc">~</span> lambda.vals, <span class="at">xlab =</span> <span class="st">&quot;lambda&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;log likelihood&quot;</span>, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>)</span>
<span id="cb23-2"><a href="index.html#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="fl">0.7</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
</div>
<div id="find-the-mle-numerically-using-optimize" class="section level3 hasAnchor" number="1.2.2">
<h3><span class="header-section-number">1.2.2</span> Find the MLE numerically using ‘optimize’<a href="index.html#find-the-mle-numerically-using-optimize" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Bolker’s book illustrates numerical optimization using the <code>optim</code> function. The R documentation recommends using <code>optimize</code> for one-dimensional optimization, and <code>optim</code> for optimizing a function in several dimensions. So, we will use <code>optimize</code> here. We will enclose the entire call to <code>optimize</code> in parentheses so that the output is dumped to the command line in addition to being stored as <code>horse.mle</code>.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="index.html#cb24-1" aria-hidden="true" tabindex="-1"></a>(horse.mle <span class="ot">&lt;-</span> <span class="fu">optimize</span>(<span class="at">f =</span> horse.ll, <span class="at">interval =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">2</span>), <span class="at">maximum =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>## $maximum
## [1] 0.7000088
## 
## $objective
## [1] -314.1545</code></pre>
<p>The <code>optimize</code> function returns a ‘list’. A list is an R object that contains components of different types. The numerically calculated MLE is <span class="math inline">\(\hat{\lambda} \approx 0.7\)</span>. The ‘objective’ component of gives the value of the log-likelihood at that point.</p>
</div>
</div>
<div id="pulse-rate-data" class="section level2 hasAnchor" number="1.3">
<h2><span class="header-section-number">1.3</span> Pulse rate data<a href="index.html#pulse-rate-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The data set <code>pulse.csv</code> contains the heights (in cm) and resting pulse rates (in beats per minute) of 43 graduate students at NCSU. We will use the pulse-rate data as an example to illustrate estimating the mean and variance of a Gaussian distribution from a simple random sample. The purpose of this example is two-fold: first, to illustrate maximum-likelihood estimation with more than one parameter, and second, to illustrate an important result about the MLE of the variance for normally distributed data.</p>
<!-- The myxomatosis data are in Bolker's library `emdbook`.  First load the library.  If the library is not found, you will first have to download and install the library on your computer, using the Packages tab in RStudio.  The call to `data` loads the particular myxomatosis data set that we want into memory. -->
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="index.html#cb26-1" aria-hidden="true" tabindex="-1"></a>pulse <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/pulse.csv&quot;</span>, <span class="at">head =</span> T)</span></code></pre></div>
<p>Inspect the data to make sure they have been imported correctly.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="index.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pulse)</span></code></pre></div>
<pre><code>##      height           rate    
##  Min.   :152.0   Min.   : 52  
##  1st Qu.:163.0   1st Qu.: 66  
##  Median :168.0   Median : 72  
##  Mean   :168.2   Mean   : 72  
##  3rd Qu.:173.0   3rd Qu.: 78  
##  Max.   :185.0   Max.   :100</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="index.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pulse)</span></code></pre></div>
<pre><code>##   height rate
## 1    152   68
## 2    173   68
## 3    165   82
## 4    160   60
## 5    168   74
## 6    170   80</code></pre>
<p>For the sake of illustration, we will estimate the mean and variance of the normal distribution using the <code>optim</code> function in R.</p>
<p>First, we write a function to calculate the log likelihood.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="index.html#cb31-1" aria-hidden="true" tabindex="-1"></a>pulse.ll <span class="ot">&lt;-</span> <span class="cf">function</span>(m, v){</span>
<span id="cb31-2"><a href="index.html#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="index.html#cb31-3" aria-hidden="true" tabindex="-1"></a>  ll.vals <span class="ot">&lt;-</span> <span class="fu">dnorm</span>(pulse<span class="sc">$</span>rate, <span class="at">mean =</span> m, <span class="at">sd =</span> <span class="fu">sqrt</span>(v), <span class="at">log =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-4"><a href="index.html#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(ll.vals)</span>
<span id="cb31-5"><a href="index.html#cb31-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Note that R’s function for the pdf of a normal distribution — <code>dnorm</code> — is parameterized by the mean and standard deviation (SD) of the normal distribution. Although it would be just as easy to find the MLE of the standard deviation <span class="math inline">\(\sigma\)</span>, for the sake of illustration, we will seek the MLE of the variance, <span class="math inline">\(\sigma^2\)</span>. (It turns out that, if we write the MLE of the standard deviation as <span class="math inline">\(\hat{\sigma}\)</span> and the MLE of the variance as <span class="math inline">\(\hat{\sigma}^2\)</span>, then <span class="math inline">\(\hat{\sigma} = \sqrt{\hat{\sigma}^2}\)</span>. This is an example of the {} of MLEs.)</p>
<p>We can use our function to calculate the likelihood for any choice of mean and variance. For example, let’s try <span class="math inline">\(\mu = 60\)</span> and <span class="math inline">\(\sigma^2 = 100\)</span>.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="index.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pulse.ll</span>(<span class="at">m =</span> <span class="dv">60</span>, <span class="at">v =</span> <span class="dv">100</span>)</span></code></pre></div>
<pre><code>## [1] -189.6155</code></pre>
<p>We want to maximize the likelihood using <code>optim</code>. Unfortuantely, <code>optim</code> is a little finicky. To use <code>optim</code>, we have to re-write our function <code>pulse.ll</code> so that the parameters to be estimated are passed to the function as a single vector. Also, by default, <code>optim</code> performs minimization instead of maximization. We can change this behavior when we call <code>optim</code>. Alternatively, we can just re-define the function to return the negative log likelihood.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="index.html#cb34-1" aria-hidden="true" tabindex="-1"></a>pulse.neg.ll <span class="ot">&lt;-</span> <span class="cf">function</span>(pars){</span>
<span id="cb34-2"><a href="index.html#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="index.html#cb34-3" aria-hidden="true" tabindex="-1"></a>  m <span class="ot">&lt;-</span> pars[<span class="dv">1</span>]</span>
<span id="cb34-4"><a href="index.html#cb34-4" aria-hidden="true" tabindex="-1"></a>  v <span class="ot">&lt;-</span> pars[<span class="dv">2</span>]</span>
<span id="cb34-5"><a href="index.html#cb34-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-6"><a href="index.html#cb34-6" aria-hidden="true" tabindex="-1"></a>  ll.vals <span class="ot">&lt;-</span> <span class="fu">dnorm</span>(pulse<span class="sc">$</span>rate, <span class="at">mean =</span> m, <span class="at">sd =</span> <span class="fu">sqrt</span>(v), <span class="at">log =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-7"><a href="index.html#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="fu">sum</span>(ll.vals)</span>
<span id="cb34-8"><a href="index.html#cb34-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Now we can use <code>optim</code>:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="index.html#cb35-1" aria-hidden="true" tabindex="-1"></a>(pulse.mle <span class="ot">&lt;-</span> <span class="fu">optim</span>(<span class="at">par =</span> <span class="fu">c</span>(<span class="dv">60</span>, <span class="dv">100</span>),  <span class="co"># starting values, just a ballpark guess </span></span>
<span id="cb35-2"><a href="index.html#cb35-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fn  =</span> pulse.neg.ll))</span></code></pre></div>
<pre><code>## $par
## [1] 71.99897 93.65332
## 
## $value
## [1] 158.6099
## 
## $counts
## function gradient 
##       51       NA 
## 
## $convergence
## [1] 0
## 
## $message
## NULL</code></pre>
<p>Note that the MLE of the variance is
<span class="math display">\[
\hat{\sigma}^2 = \frac{\sum_i (x_i - \bar{x})}{n}.
\]</span>
Let’s verify this by calculating the same quantity at the command line:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="index.html#cb37-1" aria-hidden="true" tabindex="-1"></a>residuals <span class="ot">&lt;-</span> <span class="fu">with</span>(pulse, rate <span class="sc">-</span> <span class="fu">mean</span>(rate))</span>
<span id="cb37-2"><a href="index.html#cb37-2" aria-hidden="true" tabindex="-1"></a>ss <span class="ot">&lt;-</span> <span class="fu">sum</span>(residuals<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb37-3"><a href="index.html#cb37-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(pulse)</span>
<span id="cb37-4"><a href="index.html#cb37-4" aria-hidden="true" tabindex="-1"></a>ss <span class="sc">/</span> n</span></code></pre></div>
<pre><code>## [1] 93.62791</code></pre>
<p>Compare this to the answer given by <code>var</code>, and to the more usual calculation of the variance as
<span class="math display">\[
s^2 = \frac{\sum_i (x_i - \bar{x})}{n-1}.
\]</span></p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="index.html#cb39-1" aria-hidden="true" tabindex="-1"></a>(var.usual <span class="ot">&lt;-</span> ss <span class="sc">/</span> (n <span class="sc">-</span> <span class="dv">1</span>))</span></code></pre></div>
<pre><code>## [1] 95.85714</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="index.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(pulse<span class="sc">$</span>rate)</span></code></pre></div>
<pre><code>## [1] 95.85714</code></pre>
<p>One main take-home of this example is that when we use maximum likelihood to estimate variances for normally distributed data, the MLE is biased low. In other words, it underestimates the true variance. When we study hierarchical models later in the semester, we will regularly find ourselves estimating variances for normally distributed effects, and will have to deal with the consequences of the fact that the MLEs of these variances are biased low.</p>
<p>For models with 2 parameters, we can visualize the likelihood surface with a contour plot. To do so, the first step is to define a lattice of values at which we want to calculate the log-likelihood. We’ll do so by defining vectors for <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma^2\)</span>:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="index.html#cb43-1" aria-hidden="true" tabindex="-1"></a>m.vals <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">60</span>, <span class="at">to =</span> <span class="dv">80</span>, <span class="at">by =</span> <span class="fl">0.5</span>)</span>
<span id="cb43-2"><a href="index.html#cb43-2" aria-hidden="true" tabindex="-1"></a>v.vals <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">70</span>, <span class="at">to =</span> <span class="dv">125</span>, <span class="at">by =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<!-- Here is some fancy R code that shows this lattice.  Don't worry about how this plot is created, as it isn't critical for what follows. -->
<!-- ```{r} -->
<!-- plot(rep(m.vals, length(v.vals)), rep(v.vals, rep(length(m.vals), length(v.vals))), -->
<!--      xlab = expression(mu), -->
<!--      ylab = expression(sigma^2)) -->
<!-- ``` -->
<p>Now we will define the matrix that will store the values of the log-likelihood for each combination of <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma^2\)</span> in the lattice shown above.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="index.html#cb44-1" aria-hidden="true" tabindex="-1"></a>ll.vals <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="fu">length</span>(m.vals), <span class="at">ncol =</span> <span class="fu">length</span>(v.vals))</span></code></pre></div>
<p>Next, we will write a nested loop that cycles through the lattice points, calculates the log-likelihood for each, and stores the value of the log likelihood in the matrix <code>ll.vals</code> that we just created.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="index.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i.m <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(m.vals)) {</span>
<span id="cb45-2"><a href="index.html#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i.v <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(v.vals)) {</span>
<span id="cb45-3"><a href="index.html#cb45-3" aria-hidden="true" tabindex="-1"></a>    ll.vals[i.m, i.v] <span class="ot">&lt;-</span> <span class="fu">pulse.ll</span>(<span class="at">m =</span> m.vals[i.m], <span class="at">v =</span> v.vals[i.v])</span>
<span id="cb45-4"><a href="index.html#cb45-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb45-5"><a href="index.html#cb45-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Now we will use the <code>contour</code> function to build the contour plot, and then add a red dot for the MLE.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="index.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">contour</span>(<span class="at">x =</span> m.vals, <span class="at">y =</span> v.vals, <span class="at">z =</span> ll.vals, <span class="at">nlevels =</span> <span class="dv">100</span>,</span>
<span id="cb46-2"><a href="index.html#cb46-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="fu">expression</span>(mu), <span class="at">ylab =</span> <span class="fu">expression</span>(sigma<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb46-3"><a href="index.html#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="index.html#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="co"># show the MLE</span></span>
<span id="cb46-5"><a href="index.html#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="at">x =</span> pulse.mle<span class="sc">$</span>par[<span class="dv">1</span>], <span class="at">y =</span> pulse.mle<span class="sc">$</span>par[<span class="dv">2</span>], <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
</div>
<div id="tadpole-data" class="section level2 hasAnchor" number="1.4">
<h2><span class="header-section-number">1.4</span> Tadpole data<a href="index.html#tadpole-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Finally, we’ll take a look at the data from the functional response experiment of <span class="citation">Vonesh and Bolker (<a href="#ref-vonesh2005compensatory" role="doc-biblioref">2005</a>)</span>, described in section 6.3.1.1 of Bolker’s book. This is another example of using likelihood to estimate parameters in a two-parameter model. This example differs from the previous two examples because we won’t assume that the data constitute a simple random sample from some known distribution like the Gaussian or Poisson distribution. Instead, we’ll build a somewhat more customized model for these data that incorporates some ecological ideas. This process of building a customized model is more typical of how one would analyze a “real” data set. We’ll start by using the <code>rm</code> command to clean up the workspace.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="index.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span></code></pre></div>
<p>First, we’ll read in the data and explore them in various ways.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="index.html#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emdbook)</span>
<span id="cb48-2"><a href="index.html#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;ReedfrogFuncresp&quot;</span>)</span>
<span id="cb48-3"><a href="index.html#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="index.html#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="co"># rename something shorter</span></span>
<span id="cb48-5"><a href="index.html#cb48-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-6"><a href="index.html#cb48-6" aria-hidden="true" tabindex="-1"></a>frog <span class="ot">&lt;-</span> ReedfrogFuncresp</span>
<span id="cb48-7"><a href="index.html#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(ReedfrogFuncresp)</span>
<span id="cb48-8"><a href="index.html#cb48-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-9"><a href="index.html#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(frog)</span></code></pre></div>
<pre><code>##     Initial           Killed     
##  Min.   :  5.00   Min.   : 1.00  
##  1st Qu.: 13.75   1st Qu.: 5.75  
##  Median : 25.00   Median :10.00  
##  Mean   : 38.12   Mean   :13.25  
##  3rd Qu.: 56.25   3rd Qu.:18.75  
##  Max.   :100.00   Max.   :35.00</code></pre>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="index.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(frog)</span></code></pre></div>
<pre><code>##   Initial Killed
## 1       5      1
## 2       5      2
## 3      10      5
## 4      10      6
## 5      15     10
## 6      15      9</code></pre>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="index.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Killed <span class="sc">~</span> Initial, <span class="at">data =</span> frog)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<p>Following Bolker, we’ll assume that the number of individuals killed takes a binomial distribution, where the number of trials equals the initial tadpole density, and the probability that a tadpole is killed is given by the expression
<span class="math display">\[
p_i = \dfrac{a}{1 + a h N_i}.
\]</span>
The two parameters to estimate are <span class="math inline">\(a\)</span>, which we interpret as the attack rate when the prey density is low, and <span class="math inline">\(h\)</span>, which is the handling time. This model is motivated by the so-called “Type II” functional response of predator-prey ecology, in which the prey consumption rate saturates as prey density grows. In this case, using the Type II functional curve for these data is a pedagogical simplification; as <span class="citation">Vonesh and Bolker (<a href="#ref-vonesh2005compensatory" role="doc-biblioref">2005</a>)</span> observe, Holling’s functional responses give the predation rate when the prey density is constant. However, this experiment ran for two weeks and prey densities declined over the course of the experiment. A more appropriate analysis, and one that <span class="citation">Vonesh and Bolker (<a href="#ref-vonesh2005compensatory" role="doc-biblioref">2005</a>)</span> pursue in their paper, takes account of the declining prey densities. For the purposes of this example, though, we’ll ignore this aspect of the analysis (as <span class="citation">Bolker (<a href="#ref-bolker2008" role="doc-biblioref">2008</a>)</span> does) and fit the data assuming that the probability of predation is given by the Type II functional response.</p>
<p>If we write the number of individuals killed in each trial as <span class="math inline">\(Y_i\)</span>, The full model can then be written as
<span class="math display">\[\begin{align*}
Y_i &amp; \sim \mathrm{Binom}\left(p_i, N_i \right) \\
p_i &amp; = \dfrac{a}{1 + a h N_i}.
\end{align*}\]</span></p>
<p>We’ll first construct the negative log-likelihood function.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="index.html#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># negative log-likelihood, for use with optim</span></span>
<span id="cb53-2"><a href="index.html#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="index.html#cb53-3" aria-hidden="true" tabindex="-1"></a>frog.neg.ll <span class="ot">&lt;-</span> <span class="cf">function</span>(params){</span>
<span id="cb53-4"><a href="index.html#cb53-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb53-5"><a href="index.html#cb53-5" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;-</span> params[<span class="dv">1</span>]</span>
<span id="cb53-6"><a href="index.html#cb53-6" aria-hidden="true" tabindex="-1"></a>  h <span class="ot">&lt;-</span> params[<span class="dv">2</span>]</span>
<span id="cb53-7"><a href="index.html#cb53-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb53-8"><a href="index.html#cb53-8" aria-hidden="true" tabindex="-1"></a>  prob.vals <span class="ot">&lt;-</span> a <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> a <span class="sc">*</span> h <span class="sc">*</span> frog<span class="sc">$</span>Initial)</span>
<span id="cb53-9"><a href="index.html#cb53-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb53-10"><a href="index.html#cb53-10" aria-hidden="true" tabindex="-1"></a>  ll.vals <span class="ot">&lt;-</span> <span class="fu">dbinom</span>(frog<span class="sc">$</span>Killed, <span class="at">size =</span> frog<span class="sc">$</span>Initial, <span class="at">prob =</span> prob.vals, <span class="at">log =</span> <span class="cn">TRUE</span>)</span>
<span id="cb53-11"><a href="index.html#cb53-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb53-12"><a href="index.html#cb53-12" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> <span class="fu">sum</span>(ll.vals)</span>
<span id="cb53-13"><a href="index.html#cb53-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Now we’ll find the MLE using <code>optim</code></p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="index.html#cb54-1" aria-hidden="true" tabindex="-1"></a>(frog.mle <span class="ot">&lt;-</span> <span class="fu">optim</span>(<span class="at">par =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">40</span>),</span>
<span id="cb54-2"><a href="index.html#cb54-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">fn  =</span> frog.neg.ll))</span></code></pre></div>
<pre><code>## Warning in dbinom(frog$Killed, size = frog$Initial, prob = prob.vals, log =
## TRUE): NaNs produced</code></pre>
<pre><code>## $par
## [1] 0.52592567 0.01660454
## 
## $value
## [1] 46.72136
## 
## $counts
## function gradient 
##       59       NA 
## 
## $convergence
## [1] 0
## 
## $message
## NULL</code></pre>
<p>Why did this code produce warnings? Should we care? See section <a href="index.html#transformable-constraints">1.5</a> below.</p>
<p>Let’s extract the MLEs and add a fitted to our data plot.</p>
<p>We’ll plot the data and overlay a fitted line.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="index.html#cb57-1" aria-hidden="true" tabindex="-1"></a>a.mle <span class="ot">&lt;-</span> frog.mle<span class="sc">$</span>par[<span class="dv">1</span>]</span>
<span id="cb57-2"><a href="index.html#cb57-2" aria-hidden="true" tabindex="-1"></a>h.mle <span class="ot">&lt;-</span> frog.mle<span class="sc">$</span>par[<span class="dv">2</span>]</span>
<span id="cb57-3"><a href="index.html#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="index.html#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="co"># add a line to our plot to show the fitted curve</span></span>
<span id="cb57-5"><a href="index.html#cb57-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-6"><a href="index.html#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Killed <span class="sc">~</span> Initial, <span class="at">data =</span> frog)</span>
<span id="cb57-7"><a href="index.html#cb57-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-8"><a href="index.html#cb57-8" aria-hidden="true" tabindex="-1"></a>init.values <span class="ot">&lt;-</span> <span class="fu">with</span>(frog, <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(Initial), <span class="at">to =</span> <span class="fu">max</span>(Initial), <span class="at">length =</span> <span class="dv">100</span>))</span>
<span id="cb57-9"><a href="index.html#cb57-9" aria-hidden="true" tabindex="-1"></a>pred.values <span class="ot">&lt;-</span> a.mle <span class="sc">*</span> init.values <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> a.mle <span class="sc">*</span> h.mle <span class="sc">*</span> init.values)</span>
<span id="cb57-10"><a href="index.html#cb57-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-11"><a href="index.html#cb57-11" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> init.values, <span class="at">y =</span> pred.values, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
<p>Finally, we’ll plot the likelihood contours.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="index.html#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot negative likelihood contours</span></span>
<span id="cb58-2"><a href="index.html#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="index.html#cb58-3" aria-hidden="true" tabindex="-1"></a>a.vals <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.3</span>, <span class="at">to =</span> <span class="fl">0.75</span>, <span class="at">by =</span> <span class="fl">0.01</span>)</span>
<span id="cb58-4"><a href="index.html#cb58-4" aria-hidden="true" tabindex="-1"></a>h.vals <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.001</span>, <span class="at">to =</span> <span class="fl">0.03</span>, <span class="at">by =</span> <span class="fl">0.001</span>)</span>
<span id="cb58-5"><a href="index.html#cb58-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-6"><a href="index.html#cb58-6" aria-hidden="true" tabindex="-1"></a>ll.vals <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="fu">length</span>(a.vals), <span class="at">ncol =</span> <span class="fu">length</span>(h.vals))</span>
<span id="cb58-7"><a href="index.html#cb58-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-8"><a href="index.html#cb58-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i.a <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(a.vals)) {</span>
<span id="cb58-9"><a href="index.html#cb58-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i.h <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(h.vals)) {</span>
<span id="cb58-10"><a href="index.html#cb58-10" aria-hidden="true" tabindex="-1"></a>    ll.vals[i.a, i.h] <span class="ot">&lt;-</span> <span class="fu">frog.neg.ll</span>(<span class="fu">c</span>(a.vals[i.a], h.vals[i.h]))</span>
<span id="cb58-11"><a href="index.html#cb58-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb58-12"><a href="index.html#cb58-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb58-13"><a href="index.html#cb58-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-14"><a href="index.html#cb58-14" aria-hidden="true" tabindex="-1"></a><span class="fu">contour</span>(<span class="at">x =</span> a.vals, <span class="at">y =</span> h.vals, <span class="at">z =</span> ll.vals, <span class="at">nlevels =</span> <span class="dv">100</span>,</span>
<span id="cb58-15"><a href="index.html#cb58-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">&quot;a&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;h&quot;</span>)</span>
<span id="cb58-16"><a href="index.html#cb58-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-17"><a href="index.html#cb58-17" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="at">x =</span> a.mle, <span class="at">y =</span> h.mle, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
<p>Note that, in contrast to the pulse-rate data, here the likelihood contours form regions whose major axes are not parallel to the parameter axes. We’ll reflect on the implications of this shape in the next section.</p>
</div>
<div id="transformable-constraints" class="section level2 hasAnchor" number="1.5">
<h2><span class="header-section-number">1.5</span> Transformable constraints<a href="index.html#transformable-constraints" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>So far, we have not thought much about the numerical optimization routines that R uses to find MLEs. If time allowed, we really should think more deeply about how these routines work. Indeed, Bolker devotes an entire chapter (his chapter 7) to numerical optimization. Because time is short, we won’t go that deeply into understanding these methods now, although Bolker’s chapter is worth a read if you are so inclined.</p>
<p>There is one topic that deserves more of our attention, which is the issue of constriants on the allowable parameter space. (Bolker touches on this in his <span class="math inline">\(\S\)</span> 7.4.5.) Many times, we write down models with parameters that only make biological sense in a certain range. For example, in the horse-kick data, we know that <span class="math inline">\(\lambda\)</span> must be positive. However, most numerical optimization routines are not terribly well suited to optimizing over a constrained space. (The presence of constraints is one of the reasons why it is important to initiate numerical optimization routines with reasonable starting values.) One exception is the <code>L-BFGS-B</code> method, available in <code>optim</code>, which will permit so-called rectangular constraints. An alternative approach that will work with any numerical optimization scheme is to transform the constraints away. That is, transform the parameterization to a new scale that is unconstrained. Because of the invariance principle of MLEs, these transformations won’t change the MLEs that we eventually find, as long as the MLEs are not on the edge of the original, constrained space.</p>
<p>To illustrate, consider the parameters in the tadpole predation data again. Clearly, both the parameters <span class="math inline">\(a\)</span> and <span class="math inline">\(h\)</span> must be positive. However, there is another constraint on <span class="math inline">\(a\)</span>. The probability that a tadpole is eaten must be <span class="math inline">\(\leq 1\)</span>, and thus we must have <span class="math inline">\(a \leq 1 +ahN\)</span> for all <span class="math inline">\(N\)</span>. A little algebra shows that this is equivalent to
<span class="math display">\[
a \leq \dfrac{1}{1-hN}.
\]</span>
The right-hand side above is increasing in <span class="math inline">\(N\)</span>, and thus if the above expression is to be true for all <span class="math inline">\(N&gt;0\)</span>, then we must have <span class="math inline">\(a \leq 1\)</span>.<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a></p>
<p>Thus we will illustrate two handy transformations here. For parameters that are constrained to lie on the unit interval, such as <span class="math inline">\(a\)</span> in this case, we can re-define the model in terms of the logit (or log-odds) of <span class="math inline">\(a\)</span>. In fact, the logit transformation will work for any parameter that is constrained to lie on an interval; we just have to rescale the transformation accordingly. For a parameter that is constrained to be positive, such as <span class="math inline">\(h\)</span>, we can use the log transformation. That is, define
<span class="math display">\[\begin{align*}
a^* &amp; = \ln \left(\dfrac{a}{1-a}\right) \\
k^* &amp; = \ln (k). \\
\end{align*}\]</span>
Fitting proceeds in the usual way; we just have to invert the transformation before evaluating the likelihood:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="index.html#cb59-1" aria-hidden="true" tabindex="-1"></a>logit <span class="ot">&lt;-</span> <span class="cf">function</span>(p) <span class="fu">log</span>(p <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> p))</span>
<span id="cb59-2"><a href="index.html#cb59-2" aria-hidden="true" tabindex="-1"></a>invLogit <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">exp</span>(x) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(x))</span>
<span id="cb59-3"><a href="index.html#cb59-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-4"><a href="index.html#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="co"># negative log-likelihood, for use with optim</span></span>
<span id="cb59-5"><a href="index.html#cb59-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-6"><a href="index.html#cb59-6" aria-hidden="true" tabindex="-1"></a>frog.neg.ll <span class="ot">&lt;-</span> <span class="cf">function</span>(params){</span>
<span id="cb59-7"><a href="index.html#cb59-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-8"><a href="index.html#cb59-8" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;-</span> <span class="fu">invLogit</span>(params[<span class="dv">1</span>])</span>
<span id="cb59-9"><a href="index.html#cb59-9" aria-hidden="true" tabindex="-1"></a>  h <span class="ot">&lt;-</span> <span class="fu">exp</span>(params[<span class="dv">2</span>])</span>
<span id="cb59-10"><a href="index.html#cb59-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-11"><a href="index.html#cb59-11" aria-hidden="true" tabindex="-1"></a>  prob.vals <span class="ot">&lt;-</span> a <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> a <span class="sc">*</span> h <span class="sc">*</span> frog<span class="sc">$</span>Initial)</span>
<span id="cb59-12"><a href="index.html#cb59-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-13"><a href="index.html#cb59-13" aria-hidden="true" tabindex="-1"></a>  ll.vals <span class="ot">&lt;-</span> <span class="fu">with</span>(frog, <span class="fu">dbinom</span>(Killed, </span>
<span id="cb59-14"><a href="index.html#cb59-14" aria-hidden="true" tabindex="-1"></a>                               <span class="at">size =</span> Initial, </span>
<span id="cb59-15"><a href="index.html#cb59-15" aria-hidden="true" tabindex="-1"></a>                               <span class="at">prob =</span> prob.vals, </span>
<span id="cb59-16"><a href="index.html#cb59-16" aria-hidden="true" tabindex="-1"></a>                               <span class="at">log  =</span> <span class="cn">TRUE</span>))</span>
<span id="cb59-17"><a href="index.html#cb59-17" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> <span class="fu">sum</span>(ll.vals)</span>
<span id="cb59-18"><a href="index.html#cb59-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb59-19"><a href="index.html#cb59-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-20"><a href="index.html#cb59-20" aria-hidden="true" tabindex="-1"></a>(frog.mle <span class="ot">&lt;-</span> <span class="fu">optim</span>(<span class="at">par =</span> <span class="fu">c</span>(<span class="fu">logit</span>(<span class="fl">0.5</span>), <span class="fu">log</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">60</span>)),</span>
<span id="cb59-21"><a href="index.html#cb59-21" aria-hidden="true" tabindex="-1"></a>                   <span class="at">fn  =</span> frog.neg.ll))</span></code></pre></div>
<pre><code>## $par
## [1]  0.1038349 -4.0981694
## 
## $value
## [1] 46.72136
## 
## $counts
## function gradient 
##       43       NA 
## 
## $convergence
## [1] 0
## 
## $message
## NULL</code></pre>
<p>Back-transforming to the original scale recovers the previous MLEs:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="index.html#cb61-1" aria-hidden="true" tabindex="-1"></a>(a.mle <span class="ot">&lt;-</span> <span class="fu">invLogit</span>(frog.mle<span class="sc">$</span>par[<span class="dv">1</span>]))</span></code></pre></div>
<pre><code>## [1] 0.5259354</code></pre>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="index.html#cb63-1" aria-hidden="true" tabindex="-1"></a>(h.mle <span class="ot">&lt;-</span> <span class="fu">exp</span>(frog.mle<span class="sc">$</span>par[<span class="dv">2</span>]))</span></code></pre></div>
<pre><code>## [1] 0.01660304</code></pre>
<!-- Finally, one might also encounter parameters whose sum must lie between 0 and 1.  For example, in size-based demographic modeling, it is common to describe the demographic fates of individuals in a particular age or size class by two parameters --- survival without growth (say) and survival with growth.  Writing these two parameters as  -->

</div>
</div>
<h3>Bibliography<a href="bibliography.html#bibliography" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-bolker2008" class="csl-entry">
Bolker, Benjamin M. 2008. <em>Ecological Models and Data in <span>R</span></em>. Princeton University Press.
</div>
<div id="ref-vonesh2005compensatory" class="csl-entry">
Vonesh, James R, and Benjamin M Bolker. 2005. <span>“Compensatory Larval Responses Shift Trade-Offs Associated with Predator-Induced Hatching Plasticity.”</span> <em>Ecology</em> 86 (6): 1580–91.
</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>Recall that when we refer to a data set as a “simple random sample”, we mean that the data are independent and identically distributed. That is, they are independent draws from the same underlying probability distribution.<a href="index.html#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>The upper bound on <span class="math inline">\(a\)</span> is odd and possibly confusing. In standard predation models, there is no upper bound on <span class="math inline">\(a\)</span>. The reason why we have an upper bound on <span class="math inline">\(a\)</span> in this case is because we’ve taken the usual functional expression for Type II predation — which gives a predation <em>rate</em> — and re-interpreted it as the <em>number</em> of tadpoles eaten over a finite time interval. This was probably never a great idea to begin with, and now we are seeing the cost. The <span class="math inline">\(a \leq 1\)</span> constraint arises in this case because the number of tadpoles eaten in this experiment can’t exceed the number that were originally placed in the experimental mesocosm. This emphasizes that if we’re really only using the Type II functional response here for pedagogical convenience. If we really wanted to learn something about the underlying predation <em>rate</em>, then we have to account for the prey depletion over the course of the experiment, as <span class="citation">Vonesh and Bolker (<a href="#ref-vonesh2005compensatory" role="doc-biblioref">2005</a>)</span> do in their study.<a href="index.html#fnref2" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>

<a href="beyond-the-mle-confidence-regions-and-hypothesis-tests-using-the-likelihood-function.html" class="navigation navigation-next navigation-unique" aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "serif",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
