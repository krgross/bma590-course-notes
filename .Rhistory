fm3 <- lmerTest::lmer(sqrt(Richness) ~ 1 + NAP + (1 | fBeach) + (0 + NAP | fBeach), data = rikz)
summary(fm3)
anova(fm1, fm3, fm2)
(conditional.modes  <- data.frame(beach     = 1:9,
intercept = fixef(fm3)["(Intercept)"] + ranef(fm3)$fBeach$`(Intercept)`,
slope     = fixef(fm3)["NAP"] + ranef(fm3)$fBeach$`NAP`))
par(mfrow = c(1, 2))
with(fixed.params, plot(slope ~ intercept, main = "fixed-effects fit", pch = 1:9))
with(fixed.params, plot(slope ~ intercept, main = "conditional modes", type = "n"))
with(conditional.modes, points(slope ~ intercept, pch = 1:9))
points(fixef(fm3)[1], fixef(fm3)[2], pch = 16, col = "red", cex = 2)
par(mfrow = c(1, 1))
with(rikz, plot(sqrt(Richness) ~ NAP, pch = Beach, main = "Random-coefficients fit"))
legend("topright", leg = 1:9, pch = 1:9)
for(i in 1:9){
abline(a = conditional.modes$intercept[i], b = conditional.modes$slope[i],
col = "red", lty = "dotted")
}
abline(a = fixef(fm3)[1], b = fixef(fm3)[2], col = "red", lwd = 2)
# create an 'exposure' factor, with two levels: low and high
with(rikz, table(fBeach, Exposure))
rikz$fExp <- rikz$Exposure  # make a new variable so that we can leave the original alone
rikz$fExp[rikz$Exposure == 8] <- 10  # assign a value of 10 to the lone beach with exposure = 8
rikz$fExp <- as.factor(rikz$fExp)  # make the new variable into a factor
summary(rikz)
fm4 <- lmerTest::lmer(sqrt(Richness) ~ fExp * NAP + (1 | fBeach), data = rikz)
summary(fm4)
fm5 <- lmerTest::lmer(sqrt(Richness) ~ fExp * NAP + (1 | fBeach) + (0 + NAP | fBeach),
data = rikz)
summary(fm5)
fm6 <- lmerTest::lmer(sqrt(Richness) ~ fExp * NAP + (1 + NAP| fBeach), data = rikz)
summary(fm6)
anova(fm4, fm5, fm6)
summary(fm4)
a0 <- fixef(fm4)[1]  # mean intercept for low-exposure beaches
b0 <- fixef(fm4)[2]  # mean slope for low-exposure beaches
a1 <- fixef(fm4)[3]  # difference in mean intercepts for high vs low
b1 <- fixef(fm4)[4]  # difference in mean slopes for high vs low
c.mode <- ranef(fm4)$fBeach
low.beaches <- c(1, 2, 5, 8, 9) # indices of the low-exposure beaches
high.beaches <- c(3, 4, 6, 7) # indices of the high-exposure beacues
par(mfrow = c(1, 2))  # split the plot region
with(rikz, plot(sqrt(Richness) ~ NAP,
type     = "n",
main     = "Exposure = 8 or 10"))  # set up the axes
with(subset(rikz, fExp == "10"), points(sqrt(Richness) ~ NAP, pch = Beach))  # plot points for low exposure beaches
abline(a = a0, b = b0, col = "red", lwd = 2)  # add the average line for low-exposure beaches
for (i in 1:length(low.beaches)) {
abline(a = a0 + c.mode[low.beaches[i], 1], b = b0, col = "red", lty = "dotted")
}
# Repeat for high exposure beaches
with(rikz, plot(sqrt(Richness) ~ NAP,
type     = "n",
main     = "Exposure = 11"))  # set up the axes
with(subset(rikz, fExp == "11"), points(sqrt(Richness) ~ NAP, pch = Beach))  # plot points for low exposure beaches
abline(a = a0 + a1, b = b0 + b1, col = "blue", lwd = 2)  # add the average line for low-exposure beaches
for (i in 1:length(high.beaches)) {
abline(a = a0 + a1 + c.mode[high.beaches[i], 1], b = b0 + b1, col = "blue", lty = "dotted")
}
rm(list = ls())
library(MASS)
require(lme4)
require(lmerTest)
data(oats)
summary(oats)
fm1 <- lmerTest::lmer(Y ~ V * N + (1 | B) + (1 | B : V), data = oats)
# for nested random effects, lmer provides the coding shortcut
fm1a <- lmerTest::lmer(Y ~ V * N + (1 | B / V), data = oats)
summary(fm1)
anova(fm1)
contrasts(oats$N) <- contr.poly(n = 4)
fm1 <- lmerTest::lmer(Y ~ V * N +  (1 | B) + (1 | B : V), data = oats)
summary(fm1)
with(oats, plot(Y ~ N))
rm(list = ls())
golf <- read.table("data/golf.txt", head = T)
fm1 <- lmerTest::lmer(score ~ 1 + (1 | player) + (1 | round), data = golf)
summary(fm1)  # comparison of the std devs of the random effects is interesting
pp.golf <- profile(fm1)
confint(pp.golf)
lattice::xyplot(pp.golf, absVal = TRUE)
player.modes <- ranef(fm1)$player
head(player.modes)
(round.modes <- ranef(fm1)$round)
player.stats <- data.frame(name = row.names(player.modes),
mode = player.modes[, 1],
rds  = with(golf, as.numeric(table(player))))
with(player.stats, stripchart(mode ~ as.factor(rds), method = "jitter", ylab = "rounds played",
xlab = "conditional mode", pch = 1))
knitr::include_graphics("images/sports-comic.png", dpi = 100)
rm(list = ls())
ant <- read.csv("data/ant.csv", head = T, stringsAsFactors = T)
ant_s <- droplevels(subset(ant, genus_species != "Brachyponera chinensis"))  # exclude the generalist
ant_s <- ant_s[, c(2, 3, 5, 6, 8)]  # remove irrelevant variables
names(ant_s) <- c("site", "tree", "habitat", "species", "ct_max")
summary(ant_s)
with(ant_s, table(species, site))
s_data <- with(ant_s, aggregate(ct_max, list(habitat, species), FUN = mean))  # note the rows are sorted alphabetically by species
names(s_data) <- c("habitat", "species", "avg")
with(s_data, stripchart(avg ~ habitat, pch = 16))
fm1 <- lme4::lmer(ct_max ~ habitat + (1 | site) + (1 | site:tree) + (1 | species),
data = ant_s)
summary(fm1)
s_data$blup <- ranef(fm1)$genus_species[, 1] + coef(summary(fm1))[1, 1] + ifelse(s_data$stratum == "terrestrial", coef(summary(fm1))[2, 1], 0)
s_data$blup <- ranef(fm1)$species[, 1] + coef(summary(fm1))[1, 1] + ifelse(s_data$habitat == "terrestrial", coef(summary(fm1))[2, 1], 0)
with(s_data, stripchart(blup ~ stratum, pch = 16))
s_data$blup <- ranef(fm1)$species[, 1] + coef(summary(fm1))[1, 1] + ifelse(s_data$habitat == "terrestrial", coef(summary(fm1))[2, 1], 0)
with(s_data, stripchart(blup ~ habitat, pch = 16))
bookdown::preview_chapter("06-HierarchicalModels.Rmd", "bookdown::gitbook")
bookdown::preview_chapter("06-HierarchicalModels.Rmd", "bookdown::gitbook")
bookdown::render_book("index.Rmd", "bookdown::gitbook")
bookdown::render_book("index.Rmd", "bookdown::gitbook")
elephant <- read.table("C:/Users/krgross/Documents/Teaching/bma590/bma590-fall21/data/elephant.txt", head = T)
with(elephant, plot(matings ~ age, pch = 16))
fm1 <- glm(matings ~ age,
family = poisson(link = "log"),
data   = elephant)  # log link is the default
summary(fm1)
(pseudo.R2 <- 1 - 51.012 / 75.372)
new.data <- data.frame(age = seq(from = min(elephant$age),
to   = max(elephant$age),
length = 100))
predict.fm1 <- predict(fm1, newdata = new.data, type = "response", se.fit = TRUE)
with(elephant, plot(matings ~ age))
lines(x = new.data$age, y = predict.fm1$fit, col = "red")
lines(x   = new.data$age,
y   = predict.fm1$fit - 1.96 * predict.fm1$se.fit,
col = "red",
lty = "dashed")
lines(x   = new.data$age,
y   = predict.fm1$fit + 1.96 * predict.fm1$se.fit,
col = "red",
lty = "dashed")
fm0 <- glm(matings ~ 1,
family = poisson(link = "log"),
data   = elephant)  # log link is the default
summary(fm0)
anova(fm0, fm1, test = "Chisq")
fm2 <- glm(matings ~ age,
family = poisson(link = "identity"),
data = elephant)
fm2a <- glm(matings ~ age + I(age^2),
family = poisson(link = "identity"),
data   = elephant)  # log link is the default
anova(fm2, fm2a, test = "Chisq")
summary(fm2a)
predict.fm2 <- predict(fm2, newdata = new.data, type = "response", se.fit = TRUE)
with(elephant, plot(matings ~ age))
lines(x = new.data$age, y = predict.fm2$fit, col = "blue")
lines(x   = new.data$age,
y   = predict.fm2$fit - 1.96 * predict.fm2$se.fit,
col = "blue",
lty = "dashed")
lines(x   = new.data$age,
y   = predict.fm2$fit + 1.96 * predict.fm2$se.fit,
col = "blue",
lty = "dashed")
plot(x = elephant$age,
y = residuals(fm2, type = "deviance"),
xlab = "age",
ylab = "Deviance residuals")
abline(h = 0, lty = "dashed")
plot(x = elephant$age,
y = residuals(fm2, type = "pearson"),
xlab = "age",
ylab = "Pearson residuals")
abline(h = 0, lty = "dashed")
boar <- read.table("C:/Users/krgross/Documents/Teaching/bma590/general/ZuurDataMixedModelling/Boar.txt", head = T)
# remove incomplete records
boar <- na.omit(boar)
# convert sex to a factor
boar$SEX <- as.factor(boar$SEX)
names(boar) <- c("tb", "sex", "age", "length")
summary(boar)
fm1 <- glm(tb ~ length,
family = binomial(link = "logit"),
data = boar)
summary(fm1)
with(boar, plot(tb ~ length))
new.data <- data.frame(length = seq(from = min(boar$length),
to   = max(boar$length),
length = 100))
predict.fm1 <- predict(fm1, newdata = new.data, type = "response", se.fit = TRUE)
lines(x = new.data$length, y = predict.fm1$fit, col = "red")
lines(x   = new.data$length,
y   = predict.fm1$fit - 1.96 * predict.fm1$se.fit,
col = "red",
lty = "dashed")
lines(x   = new.data$length,
y   = predict.fm1$fit + 1.96 * predict.fm1$se.fit,
col = "red",
lty = "dashed")
pchisq(641.23, df = 492, lower.tail = FALSE)
fm1a <- glm(tb ~ length, family = binomial(link = "probit"), data = boar)
AIC(fm1, fm1a)
fm1b <- glm(tb ~ length, family = binomial(link = "cloglog"), data = boar)
AIC(fm1, fm1a, fm1b)
predict.fm1a <- predict(fm1a, newdata = new.data, type = "response", se.fit = TRUE)
predict.fm1b <- predict(fm1b, newdata = new.data, type = "response", se.fit = TRUE)
with(boar, plot(tb ~ length))
lines(x = new.data$length, y = predict.fm1$fit, col = "red", lwd = 2)
lines(x = new.data$length, y = predict.fm1a$fit, col = "blue", lwd = 2)
lines(x = new.data$length, y = predict.fm1b$fit, col = "forestgreen", lwd = 2)
legend("left",
leg = c("logit", "probit", "cloglog"),
col = c("red", "blue", "forestgreen"),
pch = 16)
fm2 <- glm(tb ~ sex * as.factor(age),
family = binomial,
data = boar)
summary(fm2)
with(boar, table(tb, age, sex))
elephant <- read.table("C:/Users/krgross/Documents/Teaching/bma590/bma590-fall21/data/elephant.txt", head = T)
with(elephant, plot(matings ~ age, pch = 16))
fm1 <- glm(matings ~ age,
family = poisson(link = "log"),
data   = elephant)  # log link is the default
summary(fm1)
(pseudo.R2 <- 1 - 51.012 / 75.372)
new.data <- data.frame(age = seq(from = min(elephant$age),
to   = max(elephant$age),
length = 100))
predict.fm1 <- predict(fm1, newdata = new.data, type = "response", se.fit = TRUE)
with(elephant, plot(matings ~ age))
lines(x = new.data$age, y = predict.fm1$fit, col = "red")
lines(x   = new.data$age,
y   = predict.fm1$fit - 1.96 * predict.fm1$se.fit,
col = "red",
lty = "dashed")
lines(x   = new.data$age,
y   = predict.fm1$fit + 1.96 * predict.fm1$se.fit,
col = "red",
lty = "dashed")
fm0 <- glm(matings ~ 1,
family = poisson(link = "log"),
data   = elephant)  # log link is the default
summary(fm0)
anova(fm0, fm1, test = "Chisq")
fm1a <- glm(matings ~ age + I(age^2),
family = poisson(link = "log"),
data   = elephant)  # log link is the default
summary(fm1a)
anova(fm0, fm1, fm1a)
fm2 <- glm(matings ~ age,
family = poisson(link = "identity"),
data = elephant)
fm2a <- glm(matings ~ age + I(age^2),
family = poisson(link = "identity"),
data   = elephant)  # log link is the default
anova(fm2, fm2a, test = "Chisq")
summary(fm2a)
predict.fm2 <- predict(fm2, newdata = new.data, type = "response", se.fit = TRUE)
with(elephant, plot(matings ~ age))
lines(x = new.data$age, y = predict.fm2$fit, col = "blue")
lines(x   = new.data$age,
y   = predict.fm2$fit - 1.96 * predict.fm2$se.fit,
col = "blue",
lty = "dashed")
lines(x   = new.data$age,
y   = predict.fm2$fit + 1.96 * predict.fm2$se.fit,
col = "blue",
lty = "dashed")
plot(x = elephant$age,
y = residuals(fm2, type = "deviance"),
xlab = "age",
ylab = "Deviance residuals")
abline(h = 0, lty = "dashed")
plot(x = elephant$age,
y = residuals(fm2, type = "pearson"),
xlab = "age",
ylab = "Pearson residuals")
abline(h = 0, lty = "dashed")
fm3 <- glm(matings ~ age, family = quasipoisson(link = "identity"), data = elephant)
?glm
summary(fm3)
summary(fm2)
50.058/39
sqrt(50.058/39)
predict.fm3 <- predict(fm3, newdata = new.data, type = "response", se.fit = TRUE)
with(elephant, plot(matings ~ age))
lines(x = new.data$age, y = predict.fm3$fit, col = "blue")
lines(x   = new.data$age,
y   = predict.fm3$fit + qt(0.025, df = 39) * predict.fm3$se.fit,
col = "blue",
lty = "dashed")
lines(x   = new.data$age,
y   = predict.fm3$fit + qt(0.975, df = 39) * predict.fm3$se.fit,
col = "blue",
lty = "dashed")
require(MASS)
fm4 <- glm.nb(matings ~ age, link = identity, data = elephant)
summary(fm4)
predict.fm4 <- predict(fm4, newdata = new.data, type = "response", se.fit = TRUE)
with(elephant, plot(matings ~ age))
lines(x = new.data$age, y = predict.fm4$fit, col = "blue")
lines(x   = new.data$age,
y   = predict.fm4$fit + 1.96 * predict.fm4$se.fit,
col = "blue",
lty = "dashed")
lines(x   = new.data$age,
y   = predict.fm4$fit - 1.96 * predict.fm4$se.fit,
col = "blue",
lty = "dashed")
knitr::opts_chunk$set(echo = TRUE)
require(lme4)
require(lmerTest)
rikz <- read.table("data/RIKZ.txt", head = T)
with(rikz, plot(Richness ~ NAP, pch = Beach))  # raw response; note the non-constant variance
with(rikz, plot(sqrt(Richness) ~ NAP, pch = Beach))  # transformation stabilizes the variance
legend("topright", leg = 1:9, pch = 1:9)
# change the Beach variable to a factor
# would have been better to code the beaches as b1, b2, ...
rikz$fBeach <- as.factor(rikz$Beach)
fm0 <- lm(sqrt(Richness) ~ fBeach + NAP, data = rikz)
summary(fm0)
confint(fm0, level = 0.95)
anova(fm0)
fm0.temp <- lm(sqrt(Richness) ~ fBeach + NAP - 1, data = rikz)
coef(fm0.temp)
with(rikz, plot(sqrt(Richness) ~ NAP, pch = Beach, main = "Fixed-effects fit, additive model"))
legend("topright", leg = 1:9, pch = 1:9)
# add a line for each beach
b <- coef(fm0)["NAP"]
for(i in 1:9){
abline(a = coef(fm0.temp)[i], b = b, col = "red", lty = "dotted")
}
rm(fm0.temp)
fm0b <- lm(sqrt(Richness) ~ fBeach * NAP, data = rikz)
summary(fm0b)
anova(fm0, fm0b)
fm0b.temp <- lm(sqrt(Richness) ~ fBeach + fBeach:NAP - 1, data = rikz)
(fixed.params <- data.frame(beach     = 1:9,
intercept = coef(fm0b.temp)[1:9],
slope     = coef(fm0b.temp)[10:18]))
row.names(fixed.params) <- NULL
with(rikz, plot(sqrt(Richness) ~ NAP, pch = Beach, main = "Fixed-effects fit, with beach-NAP interaction"))
legend("topright", leg = 1:9, pch = 1:9)
for(i in 1:9){
abline(a = fixed.params$intercept[i], b = fixed.params$slope[i],
col = "red", lty = "dotted")
}
rm(fm0b.temp)
fm1 <- lmerTest::lmer(sqrt(Richness) ~ 1 + NAP + (1 | fBeach), data = rikz)
summary(fm1)
(beach.conditional.modes <- (fixef(fm1)["(Intercept)"] + ranef(fm1)$fBeach$`(Intercept)`))
with(rikz, plot(sqrt(Richness) ~ NAP, pch = Beach, main = "Random intercepts fit"))
legend("topright", leg = 1:9, pch = 1:9)
a <- coef(summary(fm1))[1, 1]
b <- coef(summary(fm1))[2, 1]
abline(a = a, b = b, col = "red", lwd = 2)
# make a plot with a line for each beach
for(i in 1:9){
abline(a = beach.conditional.modes[i], b = b, col = "red", lty = "dotted")
}
fm2 <- lmerTest::lmer(sqrt(Richness) ~ 1 + NAP + (1 + NAP | fBeach), data = rikz)
summary(fm2)
anova(fm1, fm2)
fm3 <- lmerTest::lmer(sqrt(Richness) ~ 1 + NAP + (1 | fBeach) + (0 + NAP | fBeach), data = rikz)
summary(fm3)
anova(fm1, fm3, fm2)
(conditional.modes  <- data.frame(beach     = 1:9,
intercept = fixef(fm3)["(Intercept)"] + ranef(fm3)$fBeach$`(Intercept)`,
slope     = fixef(fm3)["NAP"] + ranef(fm3)$fBeach$`NAP`))
par(mfrow = c(1, 2))
with(fixed.params, plot(slope ~ intercept, main = "fixed-effects fit", pch = 1:9))
with(fixed.params, plot(slope ~ intercept, main = "conditional modes", type = "n"))
with(conditional.modes, points(slope ~ intercept, pch = 1:9))
points(fixef(fm3)[1], fixef(fm3)[2], pch = 16, col = "red", cex = 2)
par(mfrow = c(1, 1))
with(rikz, plot(sqrt(Richness) ~ NAP, pch = Beach, main = "Random-coefficients fit"))
legend("topright", leg = 1:9, pch = 1:9)
for(i in 1:9){
abline(a = conditional.modes$intercept[i], b = conditional.modes$slope[i],
col = "red", lty = "dotted")
}
abline(a = fixef(fm3)[1], b = fixef(fm3)[2], col = "red", lwd = 2)
# create an 'exposure' factor, with two levels: low and high
with(rikz, table(fBeach, Exposure))
rikz$fExp <- rikz$Exposure  # make a new variable so that we can leave the original alone
rikz$fExp[rikz$Exposure == 8] <- 10  # assign a value of 10 to the lone beach with exposure = 8
rikz$fExp <- as.factor(rikz$fExp)  # make the new variable into a factor
summary(rikz)
fm4 <- lmerTest::lmer(sqrt(Richness) ~ fExp * NAP + (1 | fBeach), data = rikz)
summary(fm4)
fm5 <- lmerTest::lmer(sqrt(Richness) ~ fExp * NAP + (1 | fBeach) + (0 + NAP | fBeach),
data = rikz)
summary(fm5)
fm6 <- lmerTest::lmer(sqrt(Richness) ~ fExp * NAP + (1 + NAP| fBeach), data = rikz)
summary(fm6)
anova(fm4, fm5, fm6)
summary(fm4)
a0 <- fixef(fm4)[1]  # mean intercept for low-exposure beaches
b0 <- fixef(fm4)[2]  # mean slope for low-exposure beaches
a1 <- fixef(fm4)[3]  # difference in mean intercepts for high vs low
b1 <- fixef(fm4)[4]  # difference in mean slopes for high vs low
c.mode <- ranef(fm4)$fBeach
low.beaches <- c(1, 2, 5, 8, 9) # indices of the low-exposure beaches
high.beaches <- c(3, 4, 6, 7) # indices of the high-exposure beacues
par(mfrow = c(1, 2))  # split the plot region
with(rikz, plot(sqrt(Richness) ~ NAP,
type     = "n",
main     = "Exposure = 8 or 10"))  # set up the axes
with(subset(rikz, fExp == "10"), points(sqrt(Richness) ~ NAP, pch = Beach))  # plot points for low exposure beaches
abline(a = a0, b = b0, col = "red", lwd = 2)  # add the average line for low-exposure beaches
for (i in 1:length(low.beaches)) {
abline(a = a0 + c.mode[low.beaches[i], 1], b = b0, col = "red", lty = "dotted")
}
# Repeat for high exposure beaches
with(rikz, plot(sqrt(Richness) ~ NAP,
type     = "n",
main     = "Exposure = 11"))  # set up the axes
with(subset(rikz, fExp == "11"), points(sqrt(Richness) ~ NAP, pch = Beach))  # plot points for low exposure beaches
abline(a = a0 + a1, b = b0 + b1, col = "blue", lwd = 2)  # add the average line for low-exposure beaches
for (i in 1:length(high.beaches)) {
abline(a = a0 + a1 + c.mode[high.beaches[i], 1], b = b0 + b1, col = "blue", lty = "dotted")
}
with(fixed.params, plot(slope ~ intercept, main = "fixed-effects fit", type = "n"))
head(fixed.params)
with(fixed.params[low.beaches, ], points(slope ~ intercept, pch = low.beaches))
with(fixed.params[low.beaches, ], points(slope ~ intercept, pch = low.beaches, col = "red"))
with(fixed.params[high.beaches, ], points(slope ~ intercept, pch = high.beaches, col = "blue"))
with(fixed.params, plot(slope ~ intercept, main = "conditional modes", type = "n"))
fixef(fm5)
ranef(fm5)
conditional.modes.low <- data.frame(beach = low.beaches, intercept = fixef(fm5)["(Intercept)"] + ranef(fm5)$fBeach$`(Intercept)`[low.beaches], slope     = fixef(fm5)["NAP"] + ranef(fm5)$fBeach$`NAP`[low.beaches]))
conditional.modes.low <- data.frame(beach = low.beaches, intercept = fixef(fm5)["(Intercept)"] + ranef(fm5)$fBeach$`(Intercept)`[low.beaches])
conditional.modes.low <- data.frame(beach = low.beaches, intercept = fixef(fm5)["(Intercept)"] + ranef(fm5)$fBeach$`(Intercept)`[low.beaches], slope     = fixef(fm5)["NAP"] + ranef(fm5)$fBeach$`NAP`[low.beaches])
conditional.modes.low
conditional.modes.high <- data.frame(beach = high.beaches, intercept = fixef(fm5)["(Intercept)"] + fixef(fm5)["fExp11"] + ranef(fm5)$fBeach$`(Intercept)`[low.beaches], slope = fixef(fm5)["NAP"] + fixef(fm5)["fExp11:NAP"] + ranef(fm5)$fBeach$`NAP`[low.beaches])
conditional.modes.high <- data.frame(beach = high.beaches, intercept = fixef(fm5)["(Intercept)"] + fixef(fm5)["fExp11"] + ranef(fm5)$fBeach$`(Intercept)`[high.beaches], slope = fixef(fm5)["NAP"] + fixef(fm5)["fExp11:NAP"] + ranef(fm5)$fBeach$`NAP`[high.beaches])
conditional.modes.high
par(mfrow = c(1, 2))
with(fixed.params, plot(slope ~ intercept, main = "fixed-effects fit", type = "n"))
with(fixed.params[low.beaches, ], points(slope ~ intercept, pch = low.beaches, col = "red"))
with(fixed.params[high.beaches, ], points(slope ~ intercept, pch = high.beaches, col = "blue"))
with(fixed.params, plot(slope ~ intercept, main = "conditional modes", type = "n"))
conditional.modes.low <- data.frame(beach = low.beaches,
intercept = fixef(fm5)["(Intercept)"] + ranef(fm5)$fBeach$`(Intercept)`[low.beaches],
slope     = fixef(fm5)["NAP"] + ranef(fm5)$fBeach$`NAP`[low.beaches])
conditional.modes.high <- data.frame(beach = high.beaches,
intercept = fixef(fm5)["(Intercept)"] + fixef(fm5)["fExp11"] + ranef(fm5)$fBeach$`(Intercept)`[high.beaches],
slope = fixef(fm5)["NAP"] + fixef(fm5)["fExp11:NAP"] + ranef(fm5)$fBeach$`NAP`[high.beaches])
with(conditional.modes.low, points(slope ~ intercept, pch = low.beaches))
with(conditional.modes.high, points(slope ~ intercept, pch = high.beaches))
points(fixef(fm5)["(Intercept)"] + fixef(fm5)["fExp11"], fixef(fm5)["NAP"], pch = 16, col = "red", cex = 2)
points(fixef(fm5)["(Intercept)"] + fixef(fm5)["fExp11:NAP"] , fixef(fm5)["NAP"], pch = 16, col = "red", cex = 2)
par(mfrow = c(1, 2))
with(fixed.params, plot(slope ~ intercept, main = "fixed-effects fit", type = "n"))
with(fixed.params[low.beaches, ], points(slope ~ intercept, pch = low.beaches, col = "red"))
with(fixed.params[high.beaches, ], points(slope ~ intercept, pch = high.beaches, col = "blue"))
with(fixed.params, plot(slope ~ intercept, main = "conditional modes", type = "n"))
conditional.modes.low <- data.frame(beach = low.beaches,
intercept = fixef(fm5)["(Intercept)"] + ranef(fm5)$fBeach$`(Intercept)`[low.beaches],
slope     = fixef(fm5)["NAP"] + ranef(fm5)$fBeach$`NAP`[low.beaches])
conditional.modes.high <- data.frame(beach = high.beaches,
intercept = fixef(fm5)["(Intercept)"] + fixef(fm5)["fExp11"] + ranef(fm5)$fBeach$`(Intercept)`[high.beaches],
slope = fixef(fm5)["NAP"] + fixef(fm5)["fExp11:NAP"] + ranef(fm5)$fBeach$`NAP`[high.beaches])
with(conditional.modes.low, points(slope ~ intercept, pch = low.beaches))
with(conditional.modes.high, points(slope ~ intercept, pch = high.beaches))
points(fixef(fm5)["(Intercept)"] + fixef(fm5)["fExp11"], fixef(fm5)["NAP"], pch = 16, col = "red", cex = 2)
points(fixef(fm5)["(Intercept)"] + fixef(fm5)["fExp11:NAP"] , fixef(fm5)["NAP"], pch = 16, col = "red", cex = 2)
par(mfrow = c(1, 2))
with(fixed.params, plot(slope ~ intercept, main = "fixed-effects fit", type = "n"))
with(fixed.params[low.beaches, ], points(slope ~ intercept, pch = low.beaches, col = "red"))
with(fixed.params[high.beaches, ], points(slope ~ intercept, pch = high.beaches, col = "blue"))
with(fixed.params, plot(slope ~ intercept, main = "conditional modes", type = "n"))
conditional.modes.low <- data.frame(beach = low.beaches,
intercept = fixef(fm5)["(Intercept)"] + ranef(fm5)$fBeach$`(Intercept)`[low.beaches],
slope     = fixef(fm5)["NAP"] + ranef(fm5)$fBeach$`NAP`[low.beaches])
conditional.modes.high <- data.frame(beach = high.beaches,
intercept = fixef(fm5)["(Intercept)"] + fixef(fm5)["fExp11"] + ranef(fm5)$fBeach$`(Intercept)`[high.beaches],
slope = fixef(fm5)["NAP"] + fixef(fm5)["fExp11:NAP"] + ranef(fm5)$fBeach$`NAP`[high.beaches])
with(conditional.modes.low, points(slope ~ intercept, pch = low.beaches))
with(conditional.modes.high, points(slope ~ intercept, pch = high.beaches))
points(fixef(fm5)["(Intercept)"], fixef(fm5)["NAP"], pch = 16, col = "red", cex = 2)
points(fixef(fm5)["(Intercept)"] + fixef(fm5)["fExp11"],fixef(fm5)["NAP"] + fixef(fm5)["fExp11:NAP"], pch = 16, col = "blue", cex = 2)
par(mfrow = c(1, 2))
with(fixed.params, plot(slope ~ intercept, main = "fixed-effects fit", type = "n"))
with(fixed.params[low.beaches, ], points(slope ~ intercept, pch = low.beaches, col = "red"))
with(fixed.params[high.beaches, ], points(slope ~ intercept, pch = high.beaches, col = "blue"))
with(fixed.params, plot(slope ~ intercept, main = "conditional modes", type = "n"))
conditional.modes.low <- data.frame(beach = low.beaches,
intercept = fixef(fm5)["(Intercept)"] + ranef(fm5)$fBeach$`(Intercept)`[low.beaches],
slope     = fixef(fm5)["NAP"] + ranef(fm5)$fBeach$`NAP`[low.beaches])
conditional.modes.high <- data.frame(beach = high.beaches,
intercept = fixef(fm5)["(Intercept)"] + fixef(fm5)["fExp11"] + ranef(fm5)$fBeach$`(Intercept)`[high.beaches],
slope = fixef(fm5)["NAP"] + fixef(fm5)["fExp11:NAP"] + ranef(fm5)$fBeach$`NAP`[high.beaches])
with(conditional.modes.low, points(slope ~ intercept, pch = low.beaches, col = "red"))
with(conditional.modes.high, points(slope ~ intercept, pch = high.beaches, col = "blue"))
points(fixef(fm5)["(Intercept)"], fixef(fm5)["NAP"], pch = 16, col = "red", cex = 2)
points(fixef(fm5)["(Intercept)"] + fixef(fm5)["fExp11"],fixef(fm5)["NAP"] + fixef(fm5)["fExp11:NAP"], pch = 16, col = "blue", cex = 2)
par(mfrow = c(1, 2))
with(fixed.params, plot(slope ~ intercept, main = "fixed-effects fit", type = "n"))
with(fixed.params[low.beaches, ], points(slope ~ intercept, pch = low.beaches, col = "red"))
with(fixed.params[high.beaches, ], points(slope ~ intercept, pch = high.beaches, col = "blue"))
legend("bottomleft", col = c("red", "blue"), pch = 16, leg = c("low", "high"))
with(fixed.params, plot(slope ~ intercept, main = "conditional modes", type = "n"))
conditional.modes.low <- data.frame(beach = low.beaches,
intercept = fixef(fm5)["(Intercept)"] + ranef(fm5)$fBeach$`(Intercept)`[low.beaches],
slope     = fixef(fm5)["NAP"] + ranef(fm5)$fBeach$`NAP`[low.beaches])
conditional.modes.high <- data.frame(beach = high.beaches,
intercept = fixef(fm5)["(Intercept)"] + fixef(fm5)["fExp11"] + ranef(fm5)$fBeach$`(Intercept)`[high.beaches],
slope = fixef(fm5)["NAP"] + fixef(fm5)["fExp11:NAP"] + ranef(fm5)$fBeach$`NAP`[high.beaches])
with(conditional.modes.low, points(slope ~ intercept, pch = low.beaches, col = "red"))
with(conditional.modes.high, points(slope ~ intercept, pch = high.beaches, col = "blue"))
points(fixef(fm5)["(Intercept)"], fixef(fm5)["NAP"], pch = 16, col = "red", cex = 2)
points(fixef(fm5)["(Intercept)"] + fixef(fm5)["fExp11"],fixef(fm5)["NAP"] + fixef(fm5)["fExp11:NAP"], pch = 16, col = "blue", cex = 2)
getwd()
bookdown::preview_chapter("06-HierarchicalModels.Rmd", bookdown::gitbook
)
bookdown::preview_chapter("06-HierarchicalModels.Rmd", "bookdown::gitbook")
bookdown::render_book("index.Rmd", "bookdown::gitbook")
